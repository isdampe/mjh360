{"version":3,"sources":["../src/mjh360.js"],"names":["mjh360","element","sceneList","viewport","querySelector","goBackwardsInTime","goForwardsInTime","navigation","addEventListener","sceneGoToTime","e","scenes","viewer","Marzipano","Viewer","geometry","EquirectGeometry","width","limiter","RectilinearView","limit","traditional","Math","PI","view","yaw","sceneData","i","beforeSrc","ImageUrlSource","fromString","before","afterSrc","after","beforeScene","createScene","source","pinFirstLevel","hasOwnProperty","afterScene","navButton","document","createElement","className","img","src","thumb","pr","dynamicOnHook","preventDefault","sceneActivate","classList","add","appendChild","push","currentScene","currentTime","length","console","error","switchTo","time","warn","sceneSelector","sceneTimeToSelector","remove","scene","goToTime"],"mappings":"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","file":"mjh360.js","sourcesContent":["/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Creates a 360 virtual gallery, with before and after support.\n */\nclass mjh360 {\n\n  /**\n   * @param sceneList array An array of objects including name, thumb, before and after\n   * @return mjh360 The new mjh360 class\n   */\n  constructor(element,sceneList) {\n\n    //Hook the viewport container.\n    this.viewport = element.querySelector('.vr-viewport');\n\n    //Hook the time travelling buttons.\n    this.goBackwardsInTime = element.querySelector('.vr-before');\n    this.goForwardsInTime = element.querySelector('.vr-after');\n    this.navigation = element.querySelector('.vr-nav');\n\n    this.goBackwardsInTime.addEventListener('click', e => this.sceneGoToTime(e,'before'));\n    this.goForwardsInTime.addEventListener('click', e => this.sceneGoToTime(e,'after'));\n\n    //Create our scene container.\n    this.scenes = [];\n\n    // Create viewer.\n    this.viewer = new Marzipano.Viewer(this.viewport);\n\n    // Create geometry.\n    this.geometry = new Marzipano.EquirectGeometry([{ width: 4000 }]);\n\n    // Create view.\n    this.limiter = Marzipano.RectilinearView.limit.traditional(1024, 100*Math.PI/180);\n    this.view = new Marzipano.RectilinearView({ yaw: Math.PI }, this.limiter);\n\n    //Build the scenes.\n    for ( var i=0; i<sceneList.length; i++ ) {\n      let sceneData = sceneList[i];\n\n      sceneData.beforeSrc = Marzipano.ImageUrlSource.fromString( sceneData.before );\n      sceneData.afterSrc = Marzipano.ImageUrlSource.fromString( sceneData.after );\n      sceneData.beforeScene = this.viewer.createScene({\n        source: sceneData.beforeSrc,\n        geometry: this.geometry,\n        view: this.view,\n        pinFirstLevel: true\n      });\n\n      if ( sceneData.hasOwnProperty('after') ) {\n\n        sceneData.afterScene = this.viewer.createScene({\n          source: sceneData.afterSrc,\n          geometry: this.geometry,\n          view: this.view,\n          pinFirstLevel: true\n        });\n\n      } else {\n        sceneData.afterScene = false;\n      }\n\n      //Add nav item.\n      sceneData.navButton = document.createElement('a');\n      sceneData.navButton.className = 'nav-button';\n\n      let img = document.createElement('img');\n      img.src = sceneData.thumb;\n\n      var pr = this;\n      (function(i){\n        var dynamicOnHook = function(e) {\n          e.preventDefault();\n          pr.sceneActivate(false,i);\n          this.classList.add('active');\n        };\n\n        sceneData.navButton.addEventListener('click', dynamicOnHook);\n        sceneData.navButton.addEventListener('touchstart', dynamicOnHook);\n      })(i);\n\n      sceneData.navButton.appendChild(img);\n      this.navigation.appendChild(sceneData.navButton);\n\n      this.scenes.push(sceneData);\n\n      this.currentScene = 0;\n      this.currentTime = \"before\";\n\n    }\n\n\n  }\n\n  /**\n   * Renders the view\n   * @return void\n   */\n  render() {\n\n    // Display scene.\n    if ( this.scenes.length < 1 ) {\n      console.error('There are no scenes to view.');\n      return false;\n    }\n\n    this.navigation.classList.add('vr-nav-active');\n    this.scenes[0].navButton.classList.add('active');\n    this.scenes[0].beforeScene.switchTo();\n\n  }\n\n  /**\n   * Changes the current time of a scene to either before or after\n   * @param e event The event emitter from a handler\n   * @param time  string  Either \"before\" or \"after\"\n   */\n  sceneGoToTime(e,time) {\n    if ( typeof e !== 'undefined' && e ) e.preventDefault();\n\n    if ( this.currentTime === time ) {\n      console.warn('Already on ' + time + ', not changing.');\n      return false;\n    }\n\n    var sceneSelector = this.sceneTimeToSelector(time);\n\n    if ( time === \"after\" && this.scenes[this.currentScene][sceneSelector] === false ) {\n      //Auto change to before.\n      this.sceneGoToTime(false,'before');\n      return false;\n    }\n\n    if ( time === \"before\" ) {\n      this.goBackwardsInTime.classList.add('vr-button-active');\n      this.goForwardsInTime.classList.remove('vr-button-active');\n    } else if ( time === \"after\" ) {\n      this.goForwardsInTime.classList.add('vr-button-active');\n      this.goBackwardsInTime.classList.remove('vr-button-active');\n    }\n\n    this.scenes[this.currentScene][sceneSelector].switchTo();\n    this.currentTime = time;\n\n  }\n\n  /**\n   * Calculates a scene selector from a requested time\n   * @param time string Before or after\n   * @return string beforeScene or afterScene\n   */\n  sceneTimeToSelector(time) {\n\n    var sceneSelector;\n    if ( time === \"before\" ) {\n      sceneSelector = \"beforeScene\";\n      this.goBackwardsInTime.classList.add('vr-button-active');\n      this.goForwardsInTime.classList.remove('vr-button-active');\n    } else if ( time === \"after\" ) {\n      sceneSelector = \"afterScene\";\n      this.goForwardsInTime.classList.add('vr-button-active');\n      this.goBackwardsInTime.classList.remove('vr-button-active');\n    } else {\n      sceneSelector = \"before\";\n    }\n\n    return sceneSelector;\n\n  }\n\n  /**\n   * Activates a scene\n   * @param e event The event emitter from a handler\n   * @param scene int The scene number\n   */\n  sceneActivate(e,scene) {\n    if ( typeof e !== 'undefined' && e ) e.preventDefault();\n\n    var goToTime = this.currentTime;\n\n    if (! this.scenes[this.currentScene] ) {\n      console.warn('No scene found with this ID.');\n      return false;\n    }\n\n    this.scenes[this.currentScene].navButton.classList.remove('active');\n    this.currentScene = scene;\n    this.currentTime = false;\n\n    this.sceneGoToTime(false,goToTime);\n\n  }\n}\n"]}