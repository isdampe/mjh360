{"version":3,"sources":["../src/mjh360.js"],"names":["mjh360","element","sceneList","_this","this","_classCallCheck","viewport","querySelector","goBackwardsInTime","goForwardsInTime","navigation","addEventListener","e","sceneGoToTime","scenes","viewer","Marzipano","Viewer","geometry","EquirectGeometry","width","limiter","RectilinearView","limit","traditional","Math","PI","view","yaw","_loop","sceneData","i","beforeSrc","ImageUrlSource","fromString","before","afterSrc","after","beforeScene","createScene","source","pinFirstLevel","hasOwnProperty","afterScene","navButton","document","createElement","className","img","src","thumb","pr","dynamicOnHook","preventDefault","sceneActivate","classList","add","appendChild","push","currentScene","currentTime","length","console","error","switchTo","time","warn","sceneSelector","sceneTimeToSelector","remove","scene","goToTime","window","getElementById","name","setTimeout","render"],"mappings":"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","file":"mjh360.min.js","sourcesContent":["/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Creates a 360 virtual gallery, with before and after support.\n */\nclass mjh360 {\n\n  /**\n   * @param sceneList array An array of objects including name, thumb, before and after\n   * @return mjh360 The new mjh360 class\n   */\n  constructor(element,sceneList) {\n\n    //Hook the viewport container.\n    this.viewport = element.querySelector('.vr-viewport');\n\n    //Hook the time travelling buttons.\n    this.goBackwardsInTime = element.querySelector('.vr-before');\n    this.goForwardsInTime = element.querySelector('.vr-after');\n    this.navigation = element.querySelector('.vr-nav');\n\n    this.goBackwardsInTime.addEventListener('click', e => this.sceneGoToTime(e,'before'));\n    this.goForwardsInTime.addEventListener('click', e => this.sceneGoToTime(e,'after'));\n\n    //Create our scene container.\n    this.scenes = [];\n\n    // Create viewer.\n    this.viewer = new Marzipano.Viewer(this.viewport);\n\n    // Create geometry.\n    this.geometry = new Marzipano.EquirectGeometry([{ width: 4000 }]);\n\n    // Create view.\n    this.limiter = Marzipano.RectilinearView.limit.traditional(1024, 100*Math.PI/180);\n    this.view = new Marzipano.RectilinearView({ yaw: Math.PI }, this.limiter);\n\n    //Build the scenes.\n    for ( var i=0; i<sceneList.length; i++ ) {\n      let sceneData = sceneList[i];\n\n      sceneData.beforeSrc = Marzipano.ImageUrlSource.fromString( sceneData.before );\n      sceneData.afterSrc = Marzipano.ImageUrlSource.fromString( sceneData.after );\n      sceneData.beforeScene = this.viewer.createScene({\n        source: sceneData.beforeSrc,\n        geometry: this.geometry,\n        view: this.view,\n        pinFirstLevel: true\n      });\n\n      if ( sceneData.hasOwnProperty('after') ) {\n\n        sceneData.afterScene = this.viewer.createScene({\n          source: sceneData.afterSrc,\n          geometry: this.geometry,\n          view: this.view,\n          pinFirstLevel: true\n        });\n\n      } else {\n        sceneData.afterScene = false;\n      }\n\n      //Add nav item.\n      sceneData.navButton = document.createElement('a');\n      sceneData.navButton.className = 'nav-button';\n\n      let img = document.createElement('img');\n      img.src = sceneData.thumb;\n\n      var pr = this;\n      (function(i){\n        var dynamicOnHook = function(e) {\n          e.preventDefault();\n          pr.sceneActivate(false,i);\n          this.classList.add('active');\n        };\n\n        sceneData.navButton.addEventListener('click', dynamicOnHook);\n        sceneData.navButton.addEventListener('touchstart', dynamicOnHook);\n      })(i);\n\n      sceneData.navButton.appendChild(img);\n      this.navigation.appendChild(sceneData.navButton);\n\n      this.scenes.push(sceneData);\n\n      this.currentScene = 0;\n      this.currentTime = \"before\";\n\n    }\n\n\n  }\n\n  /**\n   * Renders the view\n   * @return void\n   */\n  render() {\n\n    // Display scene.\n    if ( this.scenes.length < 1 ) {\n      console.error('There are no scenes to view.');\n      return false;\n    }\n\n    this.navigation.classList.add('vr-nav-active');\n    this.scenes[0].navButton.classList.add('active');\n    this.scenes[0].beforeScene.switchTo();\n\n  }\n\n  /**\n   * Changes the current time of a scene to either before or after\n   * @param e event The event emitter from a handler\n   * @param time  string  Either \"before\" or \"after\"\n   */\n  sceneGoToTime(e,time) {\n    if ( typeof e !== 'undefined' && e ) e.preventDefault();\n\n    if ( this.currentTime === time ) {\n      console.warn('Already on ' + time + ', not changing.');\n      return false;\n    }\n\n    var sceneSelector = this.sceneTimeToSelector(time);\n\n    if ( time === \"after\" && this.scenes[this.currentScene][sceneSelector] === false ) {\n      //Auto change to before.\n      this.sceneGoToTime(false,'before');\n      return false;\n    }\n\n    if ( time === \"before\" ) {\n      this.goBackwardsInTime.classList.add('vr-button-inactive');\n      this.goForwardsInTime.classList.remove('vr-button-inactive');\n    } else if ( time === \"after\" ) {\n      this.goForwardsInTime.classList.add('vr-button-inactive');\n      this.goBackwardsInTime.classList.remove('vr-button-inactive');\n    }\n\n    this.scenes[this.currentScene][sceneSelector].switchTo();\n    this.currentTime = time;\n\n  }\n\n  /**\n   * Calculates a scene selector from a requested time\n   * @param time string Before or after\n   * @return string beforeScene or afterScene\n   */\n  sceneTimeToSelector(time) {\n\n    var sceneSelector;\n    if ( time === \"before\" ) {\n      sceneSelector = \"beforeScene\";\n      this.goBackwardsInTime.classList.add('vr-button-inactive');\n      this.goForwardsInTime.classList.remove('vr-button-inactive');\n    } else if ( time === \"after\" ) {\n      sceneSelector = \"afterScene\";\n      this.goForwardsInTime.classList.add('vr-button-inactive');\n      this.goBackwardsInTime.classList.remove('vr-button-inactive');\n    } else {\n      sceneSelector = \"before\";\n    }\n\n    return sceneSelector;\n\n  }\n\n  /**\n   * Activates a scene\n   * @param e event The event emitter from a handler\n   * @param scene int The scene number\n   */\n  sceneActivate(e,scene) {\n    if ( typeof e !== 'undefined' && e ) e.preventDefault();\n\n    var goToTime = this.currentTime;\n\n    if (! this.scenes[this.currentScene] ) {\n      console.warn('No scene found with this ID.');\n      return false;\n    }\n\n    this.scenes[this.currentScene].navButton.classList.remove('active');\n    this.currentScene = scene;\n    this.currentTime = false;\n\n    this.sceneGoToTime(false,goToTime);\n\n  }\n}\n\nwindow.viewer = new mjh360(document.getElementById('vr-pano'),[\n  {\n    \"name\": \"Bathroom\",\n    \"thumb\": \"/img/angra.jpg\",\n    \"before\": \"/img/angra.jpg\",\n    \"after\": \"/img/angra2.jpg\"\n  },\n  {\n    \"name\": \"Kitchen\",\n    \"thumb\": \"/img/angra.jpg\",\n    \"before\": \"/img/angra2.jpg\",\n    \"after\": \"/img/angra.jpg\"\n  },\n  {\n    \"name\": \"Winning\",\n    \"thumb\": \"/img/angra.jpg\",\n    \"before\": \"/img/angra.jpg\"\n  }\n]);\n\nsetTimeout(function(){\n  viewer.render();\n  viewer.sceneGoToTime(false,'after');\n},1000);\n"]}