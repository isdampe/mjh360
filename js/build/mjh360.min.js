function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}!function(a){"function"==typeof define?define(a):"function"==typeof YUI?YUI.add("es5",a):a()}(function(){function a(){}function b(a){return a=+a,a!==a?a=0:0!==a&&a!==1/0&&a!==-(1/0)&&(a=(a>0||-1)*Math.floor(Math.abs(a))),a}function c(a){var b=typeof a;return null===a||"undefined"===b||"boolean"===b||"number"===b||"string"===b}function d(a){var b,d,e;if(c(a))return a;if(d=a.valueOf,"function"==typeof d&&(b=d.call(a),c(b)))return b;if(e=a.toString,"function"==typeof e&&(b=e.call(a),c(b)))return b;throw new TypeError}Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if("function"!=typeof c)throw new TypeError("Function.prototype.bind called on incompatible "+c);var d=m.call(arguments,1),e=function(){if(this instanceof e){var a=c.apply(this,d.concat(m.call(arguments)));return Object(a)===a?a:this}return c.apply(b,d.concat(m.call(arguments)))};return c.prototype&&(a.prototype=c.prototype,e.prototype=new a,a.prototype=null),e});var e,f,g,h,i,j=Function.prototype.call,k=Array.prototype,l=Object.prototype,m=k.slice,n=j.bind(l.toString),o=j.bind(l.hasOwnProperty);if((i=o(l,"__defineGetter__"))&&(e=j.bind(l.__defineGetter__),f=j.bind(l.__defineSetter__),g=j.bind(l.__lookupGetter__),h=j.bind(l.__lookupSetter__)),2!=[1,2].splice(0).length){var p=Array.prototype.splice;!function(){function a(a){for(var b=[];a--;)b.unshift(a);return b}var b,c=[];if(c.splice.bind(c,0,0).apply(null,a(20)),c.splice.bind(c,0,0).apply(null,a(26)),b=c.length,c.splice(5,0,"XXX"),b+1==c.length)return!0}()?Array.prototype.splice=function(a,b){var c,d=m.call(arguments,2),e=d.length;if(!arguments.length)return[];if(void 0===a&&(a=0),void 0===b&&(b=this.length-a),e>0){if(b<=0){if(a==this.length)return this.push.apply(this,d),[];if(0==a)return this.unshift.apply(this,d),[]}return c=m.call(this,a,a+b),d.push.apply(d,m.call(this,a+b,this.length)),d.unshift.apply(d,m.call(this,0,a)),d.unshift(0,this.length),p.apply(this,d),c}return p.call(this,a,b)}:Array.prototype.splice=function(a,b){return arguments.length?p.apply(this,[void 0===a?0:a,void 0===b?this.length-a:b].concat(m.call(arguments,2))):[]}}if(1!=[].unshift(0)){var q=Array.prototype.unshift;Array.prototype.unshift=function(){return q.apply(this,arguments),this.length}}Array.isArray||(Array.isArray=function(a){return"[object Array]"==n(a)});var r=Object("a"),s="a"!=r[0]||!(0 in r);if(Array.prototype.forEach||(Array.prototype.forEach=function(a){var b=F(this),c=s&&"[object String]"==n(this)?this.split(""):b,d=arguments[1],e=-1,f=c.length>>>0;if("[object Function]"!=n(a))throw new TypeError;for(;++e<f;)e in c&&a.call(d,c[e],e,b)}),Array.prototype.map||(Array.prototype.map=function(a){var b=F(this),c=s&&"[object String]"==n(this)?this.split(""):b,d=c.length>>>0,e=Array(d),f=arguments[1];if("[object Function]"!=n(a))throw new TypeError(a+" is not a function");for(var g=0;g<d;g++)g in c&&(e[g]=a.call(f,c[g],g,b));return e}),Array.prototype.filter||(Array.prototype.filter=function(a){var b,c=F(this),d=s&&"[object String]"==n(this)?this.split(""):c,e=d.length>>>0,f=[],g=arguments[1];if("[object Function]"!=n(a))throw new TypeError(a+" is not a function");for(var h=0;h<e;h++)h in d&&(b=d[h],a.call(g,b,h,c)&&f.push(b));return f}),Array.prototype.every||(Array.prototype.every=function(a){var b=F(this),c=s&&"[object String]"==n(this)?this.split(""):b,d=c.length>>>0,e=arguments[1];if("[object Function]"!=n(a))throw new TypeError(a+" is not a function");for(var f=0;f<d;f++)if(f in c&&!a.call(e,c[f],f,b))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a){var b=F(this),c=s&&"[object String]"==n(this)?this.split(""):b,d=c.length>>>0,e=arguments[1];if("[object Function]"!=n(a))throw new TypeError(a+" is not a function");for(var f=0;f<d;f++)if(f in c&&a.call(e,c[f],f,b))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=F(this),c=s&&"[object String]"==n(this)?this.split(""):b,d=c.length>>>0;if("[object Function]"!=n(a))throw new TypeError(a+" is not a function");if(!d&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var e,f=0;if(arguments.length>=2)e=arguments[1];else for(;;){if(f in c){e=c[f++];break}if(++f>=d)throw new TypeError("reduce of empty array with no initial value")}for(;f<d;f++)f in c&&(e=a.call(void 0,e,c[f],f,b));return e}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(a){var b=F(this),c=s&&"[object String]"==n(this)?this.split(""):b,d=c.length>>>0;if("[object Function]"!=n(a))throw new TypeError(a+" is not a function");if(!d&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var e,f=d-1;if(arguments.length>=2)e=arguments[1];else for(;;){if(f in c){e=c[f--];break}if(--f<0)throw new TypeError("reduceRight of empty array with no initial value")}if(f<0)return e;do f in this&&(e=a.call(void 0,e,c[f],f,b));while(f--);return e}),Array.prototype.indexOf&&[0,1].indexOf(1,2)==-1||(Array.prototype.indexOf=function(a){var c=s&&"[object String]"==n(this)?this.split(""):F(this),d=c.length>>>0;if(!d)return-1;var e=0;for(arguments.length>1&&(e=b(arguments[1])),e=e>=0?e:Math.max(0,d+e);e<d;e++)if(e in c&&c[e]===a)return e;return-1}),Array.prototype.lastIndexOf&&[0,1].lastIndexOf(0,-3)==-1||(Array.prototype.lastIndexOf=function(a){var c=s&&"[object String]"==n(this)?this.split(""):F(this),d=c.length>>>0;if(!d)return-1;var e=d-1;for(arguments.length>1&&(e=Math.min(e,b(arguments[1]))),e=e>=0?e:d-Math.abs(e);e>=0;e--)if(e in c&&a===c[e])return e;return-1}),!Object.keys){var t=!0,u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],v=u.length;for(var w in{toString:null})t=!1;Object.keys=function a(b){if("object"!=typeof b&&"function"!=typeof b||null===b)throw new TypeError("Object.keys called on a non-object");var a=[];for(var c in b)o(b,c)&&a.push(c);if(t)for(var d=0,e=v;d<e;d++){var f=u[d];o(b,f)&&a.push(f)}return a}}var x=-621987552e5,y="-000001";Date.prototype.toISOString&&new Date(x).toISOString().indexOf(y)!==-1||(Date.prototype.toISOString=function(){var a,b,c,d,e;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(d=this.getUTCFullYear(),e=this.getUTCMonth(),d+=Math.floor(e/12),e=(e%12+12)%12,a=[e+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],d=(d<0?"-":d>9999?"+":"")+("00000"+Math.abs(d)).slice(0<=d&&d<=9999?-4:-6),b=a.length;b--;)c=a[b],c<10&&(a[b]="0"+c);return d+"-"+a.slice(0,2).join("-")+"T"+a.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"});var z=!1;try{z=Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&new Date(x).toJSON().indexOf(y)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(a){}z||(Date.prototype.toJSON=function(a){var b,c=Object(this),e=d(c);if("number"==typeof e&&!isFinite(e))return null;if(b=c.toISOString,"function"!=typeof b)throw new TypeError("toISOString property is not callable");return b.call(c)}),!Date.parse,Date=function(a){function b(c,d,e,f,g,h,i){var j=arguments.length;if(this instanceof a){var k=1==j&&String(c)===c?new a(b.parse(c)):j>=7?new a(c,d,e,f,g,h,i):j>=6?new a(c,d,e,f,g,h):j>=5?new a(c,d,e,f,g):j>=4?new a(c,d,e,f):j>=3?new a(c,d,e):j>=2?new a(c,d):j>=1?new a(c):new a;return k.constructor=b,k}return a.apply(this,arguments)}function c(a,b){var c=b>1?1:0;return e[b]+Math.floor((a-1969+c)/4)-Math.floor((a-1901+c)/100)+Math.floor((a-1601+c)/400)+365*(a-1970)}var d=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),e=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(var f in a)b[f]=a[f];return b.now=a.now,b.UTC=a.UTC,b.prototype=a.prototype,b.prototype.constructor=b,b.parse=function(b){var e=d.exec(b);if(e){var f,g=Number(e[1]),h=Number(e[2]||1)-1,i=Number(e[3]||1)-1,j=Number(e[4]||0),k=Number(e[5]||0),l=Number(e[6]||0),m=Math.floor(1e3*Number(e[7]||0)),n=!e[4]||e[8]?0:Number(new a(1970,0)),o="-"===e[9]?1:-1,p=Number(e[10]||0),q=Number(e[11]||0);return j<(k>0||l>0||m>0?24:25)&&k<60&&l<60&&m<1e3&&h>-1&&h<12&&p<24&&q<60&&i>-1&&i<c(g,h+1)-c(g,h)&&(f=60*(24*(c(g,h)+i)+j+p*o),f=1e3*(60*(f+k+q*o)+l)+m+n,-864e13<=f&&f<=864e13)?f:NaN}return a.parse.apply(this,arguments)},b}(Date),Date.now||(Date.now=function(){return(new Date).getTime()}),Number.prototype.toFixed&&"0.000"===8e-5.toFixed(3)&&"0"!==.9.toFixed(0)&&"1.25"===1.255.toFixed(2)&&"1000000000000000128"===(0xde0b6b3a7640080).toFixed(0)||!function(){function a(a,b){for(var c=-1;++c<g;)b+=a*h[c],h[c]=b%f,b=Math.floor(b/f)}function b(a){for(var b=g,c=0;--b>=0;)c+=h[b],h[b]=Math.floor(c/a),c=c%a*f}function c(){for(var a=g,b="";--a>=0;)if(""!==b||0===a||0!==h[a]){var c=String(h[a]);""===b?b=c:b+="0000000".slice(0,7-c.length)+c}return b}function d(a,b,c){return 0===b?c:b%2===1?d(a,b-1,c*a):d(a*a,b/2,c)}function e(a){for(var b=0;a>=4096;)b+=12,a/=4096;for(;a>=2;)b+=1,a/=2;return b}var f,g,h;f=1e7,g=6,h=[0,0,0,0,0,0],Number.prototype.toFixed=function(f){var g,h,i,j,k,l,m,n;if(g=Number(f),g=g!==g?0:Math.floor(g),g<0||g>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(h=Number(this),h!==h)return"NaN";if(h<=-1e21||h>=1e21)return String(h);if(i="",h<0&&(i="-",h=-h),j="0",h>1e-21)if(k=e(h*d(2,69,1))-69,l=k<0?h*d(2,-k,1):h/d(2,k,1),l*=4503599627370496,k=52-k,k>0){for(a(0,l),m=g;m>=7;)a(1e7,0),m-=7;for(a(d(10,m,1),0),m=k-1;m>=23;)b(1<<23),m-=23;b(1<<m),a(1,1),b(2),j=c()}else a(0,l),a(1<<-k,0),j=c()+"0.00000000000000000000".slice(2,2+g);return g>0?(n=j.length,j=n<=g?i+"0.0000000000000000000".slice(0,g-n+2)+j:i+j.slice(0,n-g)+"."+j.slice(n-g)):j=i+j,j}}();var A=String.prototype.split;if(2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||0==="".split(/.?/).length||".".split(/()()/).length>1?!function(){var a=void 0===/()??/.exec("")[1];String.prototype.split=function(b,c){var d=this;if(void 0===b&&0===c)return[];if("[object RegExp]"!==Object.prototype.toString.call(b))return A.apply(this,arguments);var e,f,g,h,i=[],j=(b.ignoreCase?"i":"")+(b.multiline?"m":"")+(b.extended?"x":"")+(b.sticky?"y":""),k=0,b=new RegExp(b.source,j+"g");for(d+="",a||(e=new RegExp("^"+b.source+"$(?!\\s)",j)),c=void 0===c?-1>>>0:c>>>0;(f=b.exec(d))&&(g=f.index+f[0].length,!(g>k&&(i.push(d.slice(k,f.index)),!a&&f.length>1&&f[0].replace(e,function(){for(var a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(f[a]=void 0)}),f.length>1&&f.index<d.length&&Array.prototype.push.apply(i,f.slice(1)),h=f[0].length,k=g,i.length>=c)));)b.lastIndex===f.index&&b.lastIndex++;return k===d.length?!h&&b.test("")||i.push(""):i.push(d.slice(k)),i.length>c?i.slice(0,c):i}}():"0".split(void 0,0).length&&(String.prototype.split=function(a,b){return void 0===a&&0===b?[]:A.apply(this,arguments)}),"".substr&&"b"!=="0b".substr(-1)){var B=String.prototype.substr;String.prototype.substr=function(a,b){return B.call(this,a<0&&(a=this.length+a)<0?0:a,b)}}var C="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff";if(!String.prototype.trim||C.trim()){C="["+C+"]";var D=new RegExp("^"+C+C+"*"),E=new RegExp(C+C+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(D,"").replace(E,"")}}var F=function(a){if(null==a)throw new TypeError("can't convert "+a+" to object");return Object(a)}}),function(){function a(){if(Element.prototype.addEventListener||!Object.defineProperty)return{loadedForBrowser:!1};var a=document.createEventObject().constructor.prototype;Object.defineProperty(a,"bubbles",{get:function(){for(var a=["select","scroll","click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","wheel","textinput","keydown","keypress","keyup"],b=this.type,c=0,d=a.length;c<d;c++)if(b===a[c])return!0;return!1}}),Object.defineProperty(a,"defaultPrevented",{get:function(){var a,b=this.returnValue;return!(b===a||b)}}),Object.defineProperty(a,"relatedTarget",{get:function(){var a=this.type;return"mouseover"===a||"mouseout"===a?"mouseover"===a?this.fromElement:this.toElement:null}}),Object.defineProperty(a,"target",{get:function(){return this.srcElement}}),a.preventDefault=function(){this.returnValue=!1},a.stopPropagation=function(){this.cancelBubble=!0};var b=function(a){return"function"!=typeof a&&"function"==typeof a.handleEvent},c="__eventShim__",d=function(a,d,e){var f=d;b(d)&&("function"!=typeof d[c]&&(d[c]=function(a){d.handleEvent(a)}),f=d[c]),this.attachEvent("on"+a,f)},e=function(a,d,e){var f=d;b(d)&&(f=d[c]),this.detachEvent("on"+a,f)};return HTMLDocument.prototype.addEventListener=d,HTMLDocument.prototype.removeEventListener=e,Element.prototype.addEventListener=d,Element.prototype.removeEventListener=e,window.addEventListener=d,window.removeEventListener=e,{loadedForBrowser:!0}}return"function"==typeof define&&define.amd?void define(a):a()}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Marzipano=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){!function(b,d){"undefined"!=typeof c&&c.exports?c.exports=d():"function"==typeof a&&a.amd?a(d):this[b]=d()}("bowser",function(){function a(a){function c(b){var c=a.match(b);return c&&c.length>1&&c[1]||""}function d(b){var c=a.match(b);return c&&c.length>1&&c[2]||""}var e,f=c(/(ipod|iphone|ipad)/i).toLowerCase(),g=/like android/i.test(a),h=!g&&/android/i.test(a),i=/CrOS/.test(a),j=c(/edge\/(\d+(\.\d+)?)/i),k=c(/version\/(\d+(\.\d+)?)/i),l=/tablet/i.test(a),m=!l&&/[^-]mobi/i.test(a);/opera|opr/i.test(a)?e={name:"Opera",opera:b,version:k||c(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(a)?e={name:"Yandex Browser",yandexbrowser:b,version:k||c(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(a)?(e={name:"Windows Phone",windowsphone:b},j?(e.msedge=b,e.version=j):(e.msie=b,e.version=c(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(a)?e={name:"Internet Explorer",msie:b,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:i?e={name:"Chrome",chromeBook:b,chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(a)?e={name:"Microsoft Edge",msedge:b,version:j}:/chrome|crios|crmo/i.test(a)?e={name:"Chrome",chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:f?(e={name:"iphone"==f?"iPhone":"ipad"==f?"iPad":"iPod"},k&&(e.version=k)):/sailfish/i.test(a)?e={name:"Sailfish",sailfish:b,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(a)?e={name:"SeaMonkey",seamonkey:b,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(a)?(e={name:"Firefox",firefox:b,version:c(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(a)&&(e.firefoxos=b)):/silk/i.test(a)?e={name:"Amazon Silk",silk:b,version:c(/silk\/(\d+(\.\d+)?)/i)}:h?e={name:"Android",version:k}:/phantom/i.test(a)?e={name:"PhantomJS",phantom:b,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(a)||/rim\stablet/i.test(a)?e={name:"BlackBerry",blackberry:b,version:k||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(a)?(e={name:"WebOS",webos:b,version:k||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(a)&&(e.touchpad=b)):e=/bada/i.test(a)?{name:"Bada",bada:b,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(a)?{name:"Tizen",tizen:b,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||k}:/safari/i.test(a)?{name:"Safari",safari:b,version:k}:{name:c(/^(.*)\/(.*) /),version:d(/^(.*)\/(.*) /)},!e.msedge&&/(apple)?webkit/i.test(a)?(e.name=e.name||"Webkit",e.webkit=b,!e.version&&k&&(e.version=k)):!e.opera&&/gecko\//i.test(a)&&(e.name=e.name||"Gecko",e.gecko=b,e.version=e.version||c(/gecko\/(\d+(\.\d+)?)/i)),e.msedge||!h&&!e.silk?f&&(e[f]=b,e.ios=b):e.android=b;var n="";e.windowsphone?n=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):f?(n=c(/os (\d+([_\s]\d+)*) like mac os x/i),n=n.replace(/[_\s]/g,".")):h?n=c(/android[ \/-](\d+(\.\d+)*)/i):e.webos?n=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):e.blackberry?n=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):e.bada?n=c(/bada\/(\d+(\.\d+)*)/i):e.tizen&&(n=c(/tizen[\/\s](\d+(\.\d+)*)/i)),n&&(e.osversion=n);var o=n.split(".")[0];return l||"ipad"==f||h&&(3==o||4==o&&!m)||e.silk?e.tablet=b:(m||"iphone"==f||"ipod"==f||h||e.blackberry||e.webos||e.bada)&&(e.mobile=b),e.msedge||e.msie&&e.version>=10||e.yandexbrowser&&e.version>=15||e.chrome&&e.version>=20||e.firefox&&e.version>=20||e.safari&&e.version>=6||e.opera&&e.version>=10||e.ios&&e.osversion&&e.osversion.split(".")[0]>=6||e.blackberry&&e.version>=10.1?e.a=b:e.msie&&e.version<10||e.chrome&&e.version<20||e.firefox&&e.version<20||e.safari&&e.version<6||e.opera&&e.version<10||e.ios&&e.osversion&&e.osversion.split(".")[0]<6?e.c=b:e.x=b,e}var b=!0,c=a("undefined"!=typeof navigator?navigator.userAgent:"");return c.test=function(a){for(var b=0;b<a.length;++b){var d=a[b];if("string"==typeof d&&d in c)return!0}return!1},c._detect=a,c})},{}],2:[function(a,b,c){c.glMatrix=a("./gl-matrix/common.js"),c.mat2=a("./gl-matrix/mat2.js"),c.mat2d=a("./gl-matrix/mat2d.js"),c.mat3=a("./gl-matrix/mat3.js"),c.mat4=a("./gl-matrix/mat4.js"),c.quat=a("./gl-matrix/quat.js"),c.vec2=a("./gl-matrix/vec2.js"),c.vec3=a("./gl-matrix/vec3.js"),c.vec4=a("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":3,"./gl-matrix/mat2.js":4,"./gl-matrix/mat2d.js":5,"./gl-matrix/mat3.js":6,"./gl-matrix/mat4.js":7,"./gl-matrix/quat.js":8,"./gl-matrix/vec2.js":9,"./gl-matrix/vec3.js":10,"./gl-matrix/vec4.js":11}],3:[function(a,b,c){var d={};d.EPSILON=1e-6,d.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,d.RANDOM=Math.random,d.ENABLE_SIMD=!1,d.SIMD_AVAILABLE=d.ARRAY_TYPE===Float32Array&&"SIMD"in this,d.USE_SIMD=d.ENABLE_SIMD&&d.SIMD_AVAILABLE,d.setMatrixArrayType=function(a){d.ARRAY_TYPE=a};var e=Math.PI/180;d.toRadian=function(a){return a*e},d.equals=function(a,b){return Math.abs(a-b)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))},b.exports=d},{}],4:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},e.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},e.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+f*i,a[1]=e*h+g*i,a[2]=d*j+f*k,a[3]=e*j+g*k,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a},e.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},e.LDU=function(a,b,c,d){return a[2]=d[2]/d[0],c[0]=d[0],c[1]=d[1],c[3]=d[3]-a[2]*c[1],[a,b,c]},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=b[0],i=b[1],j=b[2],k=b[3];return Math.abs(c-h)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(e-i)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(g-k)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))},e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},b.exports=e},{"./common.js":3}],5:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.fromValues=function(a,b,c,e,f,g){var h=new d.ARRAY_TYPE(6);return h[0]=a,h[1]=b,h[2]=c,h[3]=e,h[4]=f,h[5]=g,h},e.set=function(a,b,c,d,e,f,g){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},e.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+f*k,a[1]=e*j+g*k,a[2]=d*l+f*m,a[3]=e*l+g*m,a[4]=d*n+f*o+h,a[5]=e*n+g*o+i,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+f*j,a[1]=e*k+g*j,a[2]=d*-j+f*k,a[3]=e*-j+g*k,a[4]=h,a[5]=i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d*j,a[1]=e*j,a[2]=f*k,a[3]=g*k,a[4]=h,a[5]=i,a},e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=d*j+f*k+h,a[5]=e*j+g*k+i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a[4]=0,a[5]=0,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a[4]=0,a[5]=0,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=b[0],a[5]=b[1],a},e.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=b[0],k=b[1],l=b[2],m=b[3],n=b[4],o=b[5];return Math.abs(c-j)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(j))&&Math.abs(e-k)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(k))&&Math.abs(f-l)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(l))&&Math.abs(g-m)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(m))&&Math.abs(h-n)<=d.EPSILON*Math.max(1,Math.abs(h),Math.abs(n))&&Math.abs(i-o)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},b.exports=e},{"./common.js":3}],6:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new d.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromValues=function(a,b,c,e,f,g,h,i,j){var k=new d.ARRAY_TYPE(9);return k[0]=a,k[1]=b,k[2]=c,k[3]=e,k[4]=f,k[5]=g,k[6]=h,k[7]=i,k[8]=j,k},e.set=function(a,b,c,d,e,f,g,h,i,j){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},e.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=b[0],n=b[1],o=b[2],p=b[3],q=b[4],r=b[5],s=a[6],t=b[7],u=b[8];return Math.abs(c-m)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(e-n)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(f-o)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(o))&&Math.abs(g-p)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(p))&&Math.abs(h-q)<=d.EPSILON*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(i-r)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(j-s)<=d.EPSILON*Math.max(1,Math.abs(j),Math.abs(s))&&Math.abs(k-t)<=d.EPSILON*Math.max(1,Math.abs(k),Math.abs(t))&&Math.abs(l-u)<=d.EPSILON*Math.max(1,Math.abs(l),Math.abs(u))},b.exports=e},{"./common.js":3}],7:[function(a,b,c){var d=a("./common.js"),e={scalar:{},SIMD:{}};e.create=function(){var a=new d.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.fromValues=function(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=new d.ARRAY_TYPE(16);return r[0]=a,r[1]=b,r[2]=c,r[3]=e,r[4]=f,r[5]=g,r[6]=h,r[7]=i,r[8]=j,r[9]=k,r[10]=l,r[11]=m,r[12]=n,r[13]=o,r[14]=p,r[15]=q,r},e.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a[9]=k,a[10]=l,a[11]=m,a[12]=n,a[13]=o,a[14]=p,a[15]=q,a},
e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.scalar.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.SIMD.transpose=function(a,b){var c,d,e,f,g,h,i,j,k,l;return c=SIMD.Float32x4.load(b,0),d=SIMD.Float32x4.load(b,4),e=SIMD.Float32x4.load(b,8),f=SIMD.Float32x4.load(b,12),g=SIMD.Float32x4.shuffle(c,d,0,1,4,5),h=SIMD.Float32x4.shuffle(e,f,0,1,4,5),i=SIMD.Float32x4.shuffle(g,h,0,2,4,6),j=SIMD.Float32x4.shuffle(g,h,1,3,5,7),SIMD.Float32x4.store(a,0,i),SIMD.Float32x4.store(a,4,j),g=SIMD.Float32x4.shuffle(c,d,2,3,6,7),h=SIMD.Float32x4.shuffle(e,f,2,3,6,7),k=SIMD.Float32x4.shuffle(g,h,0,2,4,6),l=SIMD.Float32x4.shuffle(g,h,1,3,5,7),SIMD.Float32x4.store(a,8,k),SIMD.Float32x4.store(a,12,l),a},e.transpose=d.USE_SIMD?e.SIMD.transpose:e.scalar.transpose,e.scalar.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},e.SIMD.invert=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=SIMD.Float32x4.load(b,0),n=SIMD.Float32x4.load(b,4),o=SIMD.Float32x4.load(b,8),p=SIMD.Float32x4.load(b,12);return g=SIMD.Float32x4.shuffle(m,n,0,1,4,5),d=SIMD.Float32x4.shuffle(o,p,0,1,4,5),c=SIMD.Float32x4.shuffle(g,d,0,2,4,6),d=SIMD.Float32x4.shuffle(d,g,1,3,5,7),g=SIMD.Float32x4.shuffle(m,n,2,3,6,7),f=SIMD.Float32x4.shuffle(o,p,2,3,6,7),e=SIMD.Float32x4.shuffle(g,f,0,2,4,6),f=SIMD.Float32x4.shuffle(f,g,1,3,5,7),g=SIMD.Float32x4.mul(e,f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),h=SIMD.Float32x4.mul(d,g),i=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,g),h),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),g=SIMD.Float32x4.mul(d,e),g=SIMD.Float32x4.swizzle(g,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),h),k=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(f,g)),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),g=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),e=SIMD.Float32x4.swizzle(e,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,g),h),j=SIMD.Float32x4.mul(c,g),g=SIMD.Float32x4.swizzle(g,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(e,g)),j=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,g),j),j=SIMD.Float32x4.swizzle(j,2,3,0,1),g=SIMD.Float32x4.mul(c,d),g=SIMD.Float32x4.swizzle(g,1,0,3,2),j=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),j),k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,g),k),g=SIMD.Float32x4.swizzle(g,2,3,0,1),j=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,g),j),k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(e,g)),g=SIMD.Float32x4.mul(c,f),g=SIMD.Float32x4.swizzle(g,1,0,3,2),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(e,g)),j=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,g),j),g=SIMD.Float32x4.swizzle(g,2,3,0,1),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,g),i),j=SIMD.Float32x4.sub(j,SIMD.Float32x4.mul(d,g)),g=SIMD.Float32x4.mul(c,e),g=SIMD.Float32x4.swizzle(g,1,0,3,2),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,g),i),k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(d,g)),g=SIMD.Float32x4.swizzle(g,2,3,0,1),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(f,g)),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,g),k),l=SIMD.Float32x4.mul(c,h),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),g=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(g,g),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(g,g))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(l,i)),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(l,j)),SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(l,k)),a):null},e.invert=d.USE_SIMD?e.SIMD.invert:e.scalar.invert,e.scalar.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},e.SIMD.adjoint=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,c=SIMD.Float32x4.load(b,0),d=SIMD.Float32x4.load(b,4),e=SIMD.Float32x4.load(b,8),f=SIMD.Float32x4.load(b,12);return k=SIMD.Float32x4.shuffle(c,d,0,1,4,5),h=SIMD.Float32x4.shuffle(e,f,0,1,4,5),g=SIMD.Float32x4.shuffle(k,h,0,2,4,6),h=SIMD.Float32x4.shuffle(h,k,1,3,5,7),k=SIMD.Float32x4.shuffle(c,d,2,3,6,7),j=SIMD.Float32x4.shuffle(e,f,2,3,6,7),i=SIMD.Float32x4.shuffle(k,j,0,2,4,6),j=SIMD.Float32x4.shuffle(j,k,1,3,5,7),k=SIMD.Float32x4.mul(i,j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),l=SIMD.Float32x4.mul(h,k),m=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,k),l),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),k=SIMD.Float32x4.mul(h,i),k=SIMD.Float32x4.swizzle(k,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),l),o=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(j,k)),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),k=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,3,0,1),j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,k),l),n=SIMD.Float32x4.mul(g,k),k=SIMD.Float32x4.swizzle(k,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(i,k)),n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,k),n),n=SIMD.Float32x4.swizzle(n,2,3,0,1),k=SIMD.Float32x4.mul(g,h),k=SIMD.Float32x4.swizzle(k,1,0,3,2),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),n),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,k),o),k=SIMD.Float32x4.swizzle(k,2,3,0,1),n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(j,k),n),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(i,k)),k=SIMD.Float32x4.mul(g,j),k=SIMD.Float32x4.swizzle(k,1,0,3,2),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(i,k)),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),n),k=SIMD.Float32x4.swizzle(k,2,3,0,1),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,k),m),n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.mul(g,i),k=SIMD.Float32x4.swizzle(k,1,0,3,2),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(j,k),m),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(h,k)),k=SIMD.Float32x4.swizzle(k,2,3,0,1),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(j,k)),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,k),o),SIMD.Float32x4.store(a,0,l),SIMD.Float32x4.store(a,4,m),SIMD.Float32x4.store(a,8,n),SIMD.Float32x4.store(a,12,o),a},e.adjoint=d.USE_SIMD?e.SIMD.adjoint:e.scalar.adjoint,e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},e.SIMD.multiply=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4.load(c,0),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),g))));SIMD.Float32x4.store(a,0,i);var j=SIMD.Float32x4.load(c,4),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,3,3,3,3),g))));SIMD.Float32x4.store(a,4,k);var l=SIMD.Float32x4.load(c,8),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),g))));SIMD.Float32x4.store(a,8,m);var n=SIMD.Float32x4.load(c,12),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,3,3,3,3),g))));return SIMD.Float32x4.store(a,12,o),a},e.scalar.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.multiply=d.USE_SIMD?e.SIMD.multiply:e.scalar.multiply,e.mul=e.multiply,e.scalar.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},e.SIMD.translate=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4(c[0],c[1],c[2],0);b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]),d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(h,0,0,0,0)),e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(h,1,1,1,1)),f=SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(h,2,2,2,2));var i=SIMD.Float32x4.add(d,SIMD.Float32x4.add(e,SIMD.Float32x4.add(f,g)));return SIMD.Float32x4.store(a,12,i),a},e.translate=d.USE_SIMD?e.SIMD.translate:e.scalar.translate,e.scalar.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.SIMD.scale=function(a,b,c){var d,e,f,g=SIMD.Float32x4(c[0],c[1],c[2],0);return d=SIMD.Float32x4.load(b,0),SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(g,0,0,0,0))),e=SIMD.Float32x4.load(b,4),SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(g,1,1,1,1))),f=SIMD.Float32x4.load(b,8),SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(g,2,2,2,2))),a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.scale=d.USE_SIMD?e.SIMD.scale:e.scalar.scale,e.rotate=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<d.EPSILON?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(c),g=Math.cos(c),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.scalar.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},e.SIMD.rotateX=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,4),g=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),SIMD.Float32x4.mul(f,d))),a},e.rotateX=d.USE_SIMD?e.SIMD.rotateX:e.scalar.rotateX,e.scalar.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},e.SIMD.rotateY=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0),g=SIMD.Float32x4.load(b,8);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,d),SIMD.Float32x4.mul(g,e))),a},e.rotateY=d.USE_SIMD?e.SIMD.rotateY:e.scalar.rotateY,e.scalar.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},e.SIMD.rotateZ=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c)),e=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0),g=SIMD.Float32x4.load(b,4);return SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),SIMD.Float32x4.mul(g,d))),SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),SIMD.Float32x4.mul(f,d))),a},e.rotateZ=d.USE_SIMD?e.SIMD.rotateZ:e.scalar.rotateZ,e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var e,f,g,h=c[0],i=c[1],j=c[2],k=Math.sqrt(h*h+i*i+j*j);return Math.abs(k)<d.EPSILON?null:(k=1/k,h*=k,i*=k,j*=k,e=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=i*h*g+j*e,a[2]=j*h*g-i*e,a[3]=0,a[4]=h*i*g-j*e,a[5]=i*i*g+f,a[6]=j*i*g+h*e,a[7]=0,a[8]=h*j*g+i*e,a[9]=i*j*g-h*e,a[10]=j*j*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.getTranslation=function(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a},e.getRotation=function(a,b){var c=b[0]+b[5]+b[10],d=0;return c>0?(d=2*Math.sqrt(c+1),a[3]=.25*d,a[0]=(b[6]-b[9])/d,a[1]=(b[8]-b[2])/d,a[2]=(b[1]-b[4])/d):b[0]>b[5]&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/d,a[0]=.25*d,a[1]=(b[1]+b[4])/d,a[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/d,a[0]=(b[1]+b[4])/d,a[1]=.25*d,a[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/d,a[0]=(b[8]+b[2])/d,a[1]=(b[6]+b[9])/d,a[2]=.25*d),a},e.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},e.lookAt=function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=f[0],u=f[1],v=f[2],w=c[0],x=c[1],y=c[2];return Math.abs(q-w)<d.EPSILON&&Math.abs(r-x)<d.EPSILON&&Math.abs(s-y)<d.EPSILON?e.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,g=u*o-v*n,h=v*m-t*o,i=t*n-u*m,p=Math.sqrt(g*g+h*h+i*i),p?(p=1/p,g*=p,h*=p,i*=p):(g=0,h=0,i=0),j=n*i-o*h,k=o*g-m*i,l=m*h-n*g,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=g,a[1]=j,a[2]=m,a[3]=0,a[4]=h,a[5]=k,a[6]=n,a[7]=0,a[8]=i,a[9]=l,a[10]=o,a[11]=0,a[12]=-(g*q+h*r+i*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-c[14],a[15]=b[15]-c[15],a},e.sub=e.subtract,e.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12]*c,a[13]=b[13]*c,a[14]=b[14]*c,a[15]=b[15]*c,a},e.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a[9]=b[9]+c[9]*d,a[10]=b[10]+c[10]*d,a[11]=b[11]+c[11]*d,a[12]=b[12]+c[12]*d,a[13]=b[13]+c[13]*d,a[14]=b[14]+c[14]*d,a[15]=b[15]+c[15]*d,a},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];return Math.abs(c-t)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(t))&&Math.abs(e-u)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(f-v)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(g-w)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(h-x)<=d.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(i-y)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(j-z)<=d.EPSILON*Math.max(1,Math.abs(j),Math.abs(z))&&Math.abs(k-A)<=d.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(l-B)<=d.EPSILON*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(m-C)<=d.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(n-D)<=d.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(o-E)<=d.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(p-F)<=d.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(q-G)<=d.EPSILON*Math.max(1,Math.abs(q),Math.abs(G))&&Math.abs(r-H)<=d.EPSILON*Math.max(1,Math.abs(r),Math.abs(H))&&Math.abs(s-I)<=d.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))},b.exports=e},{"./common.js":3}],8:[function(a,b,c){var d=a("./common.js"),e=a("./mat3.js"),f=a("./vec3.js"),g=a("./vec4.js"),h={};h.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var i=f.dot(e,g);return-.999999>i?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),h.setAxisAngle(d,a,Math.PI),d):i>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+i,h.normalize(d,d))}}(),h.setAxes=function(){var a=e.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],h.normalize(b,h.fromMat3(b,a))}}(),h.clone=g.clone,h.fromValues=g.fromValues,h.copy=g.copy,h.set=g.set,h.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.setAxisAngle=function(a,b,c){c*=.5;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},h.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);return 0!=d?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0),c},h.add=g.add,h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},h.mul=h.multiply,h.scale=g.scale,h.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},h.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},h.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},h.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},h.dot=g.dot,h.lerp=g.lerp,h.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},h.sqlerp=function(){var a=h.create(),b=h.create();return function(c,d,e,f,g,i){return h.slerp(a,d,g,i),h.slerp(b,e,f,i),h.slerp(c,a,b,2*i*(1-i)),c}}(),h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},h.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},h.length=g.length,h.len=h.length,h.squaredLength=g.squaredLength,h.sqrLen=h.squaredLength,h.normalize=g.normalize,h.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},h.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},h.exactEquals=g.exactEquals,h.equals=g.equals,b.exports=h},{"./common.js":3,"./mat3.js":6,"./vec3.js":10,"./vec4.js":11}],9:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new d.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},e.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]},e.equals=function(a,b){var c=a[0],e=a[1],f=b[0],g=b[1];return Math.abs(c-f)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(e-g)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(g))},b.exports=e},{"./common.js":3}],10:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var e=new d.ARRAY_TYPE(3);return e[0]=a,e[1]=b,e[2]=c,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e;
},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},e.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},e.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI,e=2*d.RANDOM()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),e.angle=function(a,b){var c=e.fromValues(a[0],a[1],a[2]),d=e.fromValues(b[0],b[1],b[2]);e.normalize(c,c),e.normalize(d,d);var f=e.dot(c,d);return f>1?0:Math.acos(f)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=b[0],h=b[1],i=b[2];return Math.abs(c-g)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(e-h)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(f-i)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(i))},b.exports=e},{"./common.js":3}],11:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a[3]=Math.ceil(b[3]),a},e.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a[3]=Math.floor(b[3]),a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a[3]=Math.round(b[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.random=function(a,b){return b=b||1,a[0]=d.RANDOM(),a[1]=d.RANDOM(),a[2]=d.RANDOM(),a[3]=d.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},e.equals=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],h=b[0],i=b[1],j=b[2],k=b[3];return Math.abs(c-h)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(e-i)<=d.EPSILON*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=d.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(g-k)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))},b.exports=e},{"./common.js":3}],12:[function(b,c,d){!function(b,d,e,f){"use strict";function g(a,b,c){return setTimeout(n(a,c),b)}function h(a,b,c){return!!Array.isArray(a)&&(i(a,c[b],c),!0)}function i(a,b,c){var d;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==f)for(d=0;d<a.length;)b.call(c,a[d],d,a),d++;else for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function j(a,b,c){for(var d=Object.keys(b),e=0;e<d.length;)(!c||c&&a[d[e]]===f)&&(a[d[e]]=b[d[e]]),e++;return a}function k(a,b){return j(a,b,!0)}function l(a){if(Object.create)return Object.create(a);var b=function(){};b.prototype=a;var c=new b;return b.prototype=null,c}function m(a,b,c){var d,e=b.prototype;d=a.prototype=l(e),d.constructor=a,d._super=e,c&&j(d,c)}function n(a,b){return function(){return a.apply(b,arguments)}}function o(a,b){return typeof a==na?a.apply(b?b[0]||f:f,b):a}function p(a,b){return a===f?b:a}function q(a,b,c){i(u(b),function(b){a.addEventListener(b,c,!1)})}function r(a,b,c){i(u(b),function(b){a.removeEventListener(b,c,!1)})}function s(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function t(a,b){return a.indexOf(b)>-1}function u(a){return a.trim().split(/\s+/g)}function v(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function w(a){return Array.prototype.slice.call(a,0)}function x(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];v(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function y(a,b){for(var c,d,e=b[0].toUpperCase()+b.slice(1),g=0;g<la.length;){if(c=la[g],d=c?c+e:b,d in a)return d;g++}return f}function z(){return ra++}function A(a){var c=a.ownerDocument||a;return c.defaultView||c.parentWindow||b}function B(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){o(a.options.enable,[a])&&c.handler(b)},this.init()}function C(a){var b,c=a.options.inputClass;return new(b=c?c:ua?Q:va?T:ta?V:P)(a,D)}function D(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ba&&d-e===0,g=b&(Da|Ea)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,E(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function E(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=H(b)),e>1&&!c.firstMultiple?c.firstMultiple=H(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=I(d);b.timeStamp=qa(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=M(h,i),b.distance=L(h,i),F(c,b),b.offsetDirection=K(b.deltaX,b.deltaY),b.scale=g?O(g.pointers,d):1,b.rotation=g?N(g.pointers,d):0,G(c,b);var j=a.element;s(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function F(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ba&&f.eventType!==Da||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function G(a,b){var c,d,e,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ea&&(i>Aa||h.velocity===f)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=J(i,j,k);d=l.x,e=l.y,c=pa(l.x)>pa(l.y)?l.x:l.y,g=K(j,k),a.lastInterval=b}else c=h.velocity,d=h.velocityX,e=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=d,b.velocityY=e,b.direction=g}function H(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:oa(a.pointers[c].clientX),clientY:oa(a.pointers[c].clientY)},c++;return{timeStamp:qa(),pointers:b,center:I(b),deltaX:a.deltaX,deltaY:a.deltaY}}function I(a){var b=a.length;if(1===b)return{x:oa(a[0].clientX),y:oa(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:oa(c/b),y:oa(d/b)}}function J(a,b,c){return{x:b/a||0,y:c/a||0}}function K(a,b){return a===b?Fa:pa(a)>=pa(b)?a>0?Ga:Ha:b>0?Ia:Ja}function L(a,b,c){c||(c=Na);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function M(a,b,c){c||(c=Na);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function N(a,b){return M(b[1],b[0],Oa)-M(a[1],a[0],Oa)}function O(a,b){return L(b[0],b[1],Oa)/L(a[0],a[1],Oa)}function P(){this.evEl=Qa,Sa?this.evDoc=Ra:this.evWin=Ra,this.allow=!0,this.pressed=!1,B.apply(this,arguments)}function Q(){this.evEl=Va,this.evWin=Wa,B.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function R(){this.evTarget=Ya,this.evWin=Za,this.started=!1,B.apply(this,arguments)}function S(a,b){var c=w(a.touches),d=w(a.changedTouches);return b&(Da|Ea)&&(c=x(c.concat(d),"identifier",!0)),[c,d]}function T(){this.evTarget=_a,this.targetIds={},B.apply(this,arguments)}function U(a,b){var c=w(a.touches),d=this.targetIds;if(b&(Ba|Ca)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=w(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return s(a.target,i)}),b===Ba)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Da|Ea)&&delete d[g[e].identifier],e++;return h.length?[x(f.concat(h),"identifier",!0),h]:void 0}function V(){B.apply(this,arguments);var a=n(this.handler,this);this.touch=new T(this.manager,a),this.mouse=new P(this.manager,a)}function W(a,b){this.manager=a,this.set(b)}function X(a){if(t(a,fb))return fb;var b=t(a,gb),c=t(a,hb);return b&&c?gb+" "+hb:b||c?b?gb:hb:t(a,eb)?eb:db}function Y(a){this.id=z(),this.manager=null,this.options=k(a||{},this.defaults),this.options.enable=p(this.options.enable,!0),this.state=ib,this.simultaneous={},this.requireFail=[]}function Z(a){return a&nb?"cancel":a&lb?"end":a&kb?"move":a&jb?"start":""}function $(a){return a==Ja?"down":a==Ia?"up":a==Ga?"left":a==Ha?"right":""}function _(a,b){var c=b.manager;return c?c.get(a):a}function aa(){Y.apply(this,arguments)}function ba(){aa.apply(this,arguments),this.pX=null,this.pY=null}function ca(){aa.apply(this,arguments)}function da(){Y.apply(this,arguments),this._timer=null,this._input=null}function ea(){aa.apply(this,arguments)}function fa(){aa.apply(this,arguments)}function ga(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ha(a,b){return b=b||{},b.recognizers=p(b.recognizers,ha.defaults.preset),new ia(a,b)}function ia(a,b){b=b||{},this.options=k(b,ha.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=C(this),this.touchAction=new W(this,this.options.touchAction),ja(this,!0),i(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ja(a,b){var c=a.element;c.style&&i(a.options.cssProps,function(a,d){c.style[y(c.style,d)]=b?a:""})}function ka(a,b){var c=d.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b,b.target.dispatchEvent(c)}var la=["","webkit","moz","MS","ms","o"],ma=d.createElement("div"),na="function",oa=Math.round,pa=Math.abs,qa=Date.now,ra=1,sa=/mobile|tablet|ip(ad|hone|od)|android/i,ta="ontouchstart"in b,ua=y(b,"PointerEvent")!==f,va=ta&&sa.test(navigator.userAgent),wa="touch",xa="pen",ya="mouse",za="kinect",Aa=25,Ba=1,Ca=2,Da=4,Ea=8,Fa=1,Ga=2,Ha=4,Ia=8,Ja=16,Ka=Ga|Ha,La=Ia|Ja,Ma=Ka|La,Na=["x","y"],Oa=["clientX","clientY"];B.prototype={handler:function(){},init:function(){this.evEl&&q(this.element,this.evEl,this.domHandler),this.evTarget&&q(this.target,this.evTarget,this.domHandler),this.evWin&&q(A(this.element),this.evWin,this.domHandler),this.evDoc&&q(d,this.evDoc,this.domHandler),this.evBody&&q(d.body,this.evBody,this.domHandler)},destroy:function(){this.evEl&&r(this.element,this.evEl,this.domHandler),this.evTarget&&r(this.target,this.evTarget,this.domHandler),this.evWin&&r(A(this.element),this.evWin,this.domHandler),this.evDoc&&r(d,this.evDoc,this.domHandler),this.evBody&&r(d.body,this.evBody,this.domHandler)}};var Pa={mousedown:Ba,mousemove:Ca,mouseup:Da},Qa="mousedown",Ra="mousemove mouseup",Sa=b.navigator.userAgent.indexOf("MSIE 8")>0;m(P,B,{handler:function(a){var b=Pa[a.type],c=0;Sa&&(c=1),b&Ba&&a.button===c&&(this.pressed=!0),b&Ca&&a.button!==c&&(b=Da),this.pressed&&this.allow&&(b&Da&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:ya,srcEvent:a}))}});var Ta={pointerdown:Ba,pointermove:Ca,pointerup:Da,pointercancel:Ea,pointerout:Ea},Ua={2:wa,3:xa,4:ya,5:za},Va="pointerdown",Wa="pointermove pointerup pointercancel";b.MSPointerEvent&&(Va="MSPointerDown",Wa="MSPointerMove MSPointerUp MSPointerCancel"),m(Q,B,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Ta[d],f=Ua[a.pointerType]||a.pointerType,g=f==wa,h=v(b,a.pointerId,"pointerId");e&Ba&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Da|Ea)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Xa={touchstart:Ba,touchmove:Ca,touchend:Da,touchcancel:Ea},Ya="touchstart",Za="touchstart touchmove touchend touchcancel";m(R,B,{handler:function(a){var b=Xa[a.type];if(b===Ba&&(this.started=!0),this.started){var c=S.call(this,a,b);b&(Da|Ea)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:wa,srcEvent:a})}}});var $a={touchstart:Ba,touchmove:Ca,touchend:Da,touchcancel:Ea},_a="touchstart touchmove touchend touchcancel";m(T,B,{handler:function(a){var b=$a[a.type],c=U.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:wa,srcEvent:a})}}),m(V,B,{handler:function(a,b,c){var d=c.pointerType==wa,e=c.pointerType==ya;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Da|Ea)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ab=y(ma.style,"touchAction"),bb=ab!==f,cb="compute",db="auto",eb="manipulation",fb="none",gb="pan-x",hb="pan-y";W.prototype={set:function(a){a==cb&&(a=this.compute()),bb&&this.manager.element.style&&(this.manager.element.style[ab]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return i(this.manager.recognizers,function(b){o(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),X(a.join(" "))},preventDefaults:function(a){if(!bb){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=t(d,fb),f=t(d,hb),g=t(d,gb);return e||f&&c&Ka||g&&c&La?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var ib=1,jb=2,kb=4,lb=8,mb=lb,nb=16,ob=32;Y.prototype={defaults:{},set:function(a){return j(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(h(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=_(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return h(a,"dropRecognizeWith",this)?this:(a=_(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(h(a,"requireFailure",this))return this;var b=this.requireFail;return a=_(a,this),-1===v(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(h(a,"dropRequireFailure",this))return this;a=_(a,this);var b=v(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?Z(d):""),a)}var c=this,d=this.state;lb>d&&b(!0),b(),d>=lb&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=ob)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(ob|ib)))return!1;a++}return!0},recognize:function(a){var b=j({},a);return o(this.options.enable,[this,b])?(this.state&(mb|nb|ob)&&(this.state=ib),this.state=this.process(b),void(this.state&(jb|kb|lb|nb)&&this.tryEmit(b))):(this.reset(),void(this.state=ob))},process:function(a){},getTouchAction:function(){},reset:function(){}},m(aa,Y,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(jb|kb),e=this.attrTest(a);return d&&(c&Ea||!e)?b|nb:d||e?c&Da?b|lb:b&jb?b|kb:jb:ob}}),m(ba,aa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ma},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ka&&b.push(hb),a&La&&b.push(gb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ka?(e=0===f?Fa:0>f?Ga:Ha,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Fa:0>g?Ia:Ja,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return aa.prototype.attrTest.call(this,a)&&(this.state&jb||!(this.state&jb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=$(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),m(ca,aa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&jb)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),m(da,Y,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[db]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,e=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Da|Ea)&&!e)this.reset();else if(a.eventType&Ba)this.reset(),this._timer=g(function(){this.state=mb,this.tryEmit()},b.time,this);else if(a.eventType&Da)return mb;return ob},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===mb&&(a&&a.eventType&Da?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=qa(),this.manager.emit(this.options.event,this._input)))}}),m(ea,aa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&jb)}}),m(fa,aa,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ka|La,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ka|La)?b=a.velocity:c&Ka?b=a.velocityX:c&La&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&pa(b)>this.options.velocity&&a.eventType&Da},emit:function(a){var b=$(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),m(ga,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[eb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,e=a.deltaTime<b.time;if(this.reset(),a.eventType&Ba&&0===this.count)return this.failTimeout();if(d&&e&&c){if(a.eventType!=Da)return this.failTimeout();var f=!this.pTime||a.timeStamp-this.pTime<b.interval,h=!this.pCenter||L(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&f?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=g(function(){this.state=mb,this.tryEmit()},b.interval,this),jb):mb}return ob},failTimeout:function(){return this._timer=g(function(){this.state=ob},this.options.interval,this),ob},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==mb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ha.VERSION="2.0.4",ha.defaults={domEvents:!1,touchAction:cb,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[ca,{enable:!1},["rotate"]],[fa,{direction:Ka}],[ba,{direction:Ka},["swipe"]],[ga],[ga,{event:"doubletap",taps:2},["tap"]],[da]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var pb=1,qb=2;ia.prototype={set:function(a){return j(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?qb:pb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&mb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===qb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(jb|kb|lb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof Y)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(h(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(h(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(v(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return i(u(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return i(u(a),function(a){b?c[a].splice(v(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ka(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},j(ha,{INPUT_START:Ba,INPUT_MOVE:Ca,INPUT_END:Da,INPUT_CANCEL:Ea,STATE_POSSIBLE:ib,STATE_BEGAN:jb,STATE_CHANGED:kb,STATE_ENDED:lb,STATE_RECOGNIZED:mb,STATE_CANCELLED:nb,STATE_FAILED:ob,DIRECTION_NONE:Fa,DIRECTION_LEFT:Ga,DIRECTION_RIGHT:Ha,DIRECTION_UP:Ia,DIRECTION_DOWN:Ja,DIRECTION_HORIZONTAL:Ka,DIRECTION_VERTICAL:La,DIRECTION_ALL:Ma,Manager:ia,Input:B,TouchAction:W,TouchInput:T,MouseInput:P,PointerEventInput:Q,TouchMouseInput:V,SingleTouchInput:R,Recognizer:Y,AttrRecognizer:aa,Tap:ga,Pan:ba,Swipe:fa,Pinch:ca,Rotate:ea,Press:da,on:q,off:r,each:i,merge:k,extend:j,inherit:m,bindFn:n,prefixed:y}),typeof a==na&&a.amd?a(function(){return ha}):"undefined"!=typeof c&&c.exports?c.exports=ha:b[e]=ha}(window,document,"Hammer")},{}],13:[function(a,b,c){"use strict";function d(){}function e(a){for(var b in d.prototype)d.prototype.hasOwnProperty(b)&&(a.prototype[b]=d.prototype[b])}d.prototype.addEventListener=function(a,b){var c=this.__events=this.__events||{},d=c[a]=c[a]||[];d.push(b)},d.prototype.removeEventListener=function(a,b){var c=this.__events=this.__events||{},d=c[a];if(d){var e=d.indexOf(b);e>=0&&d.splice(e,1)}},d.prototype.emit=function(){var a=this.__events=this.__events||{},b=arguments[0],c=a[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];e.apply(this,arguments)}},b.exports=e},{}],14:[function(a,b,c){"use strict";function d(a,b){this._equals=a,this._hash=b,this._queue=[],this._visited=new e(a,b),this._neighborsFun=null,this._exploreFun=null}var e=a("./collections/Set");d.prototype.start=function(a,b,c){if(this._neighborsFun||this._exploreFun)throw new Error("GraphFinder: search already in progress");this.reset(),this._neighborsFun=b,this._exploreFun=c,this._queue.push(a)},d.prototype.reset=function(){this._neighborsFun=null,this._exploreFun=null,this._queue.length=0,this._visited.clear()},d.prototype.next=function(){var a=this._queue,b=this._visited,c=this._neighborsFun,d=this._exploreFun;if(!c||!d)throw new Error("GraphFinder: no search in progress");for(;a.length>0;){var e=this._queue.shift();if(!b.has(e)&&d(e)){b.add(e);for(var f=c(e),g=0;g<f.length;g++)a.push(f[g]);return e}}return this.reset(),null},b.exports=d},{"./collections/Set":33}],15:[function(a,b,c){"use strict";function d(a,b,c,d,e){if(e=e||{},e.perspective=e.perspective||{},e.perspective.extraRotations=null!=e.perspective.extraRotations?e.perspective.extraRotations:"",e.perspective.radius&&!f())throw new Error("Hotspot cannot not be embedded in sphere for lack of browser support");this._domElement=a,this._parentDomElement=b,this._view=c,this._params={},this._perspective={},this.setPosition(d),this._parentDomElement.appendChild(this._domElement),this.setPerspective(e.perspective),this._visible=!0,this._position={x:0,y:0}}var e=a("minimal-event-emitter"),f=a("./support/Css"),g=a("./positionAbsolutely"),h=a("./util/dom").setTransform;e(d),d.prototype._destroy=function(){this._parentDomElement.removeChild(this._domElement),this._domElement=null,this._parentDomElement=null,this._params=null,this._view=null,this._position=null,this._visible=!1},d.prototype.domElement=function(){return this._domElement},d.prototype.position=function(){return this._params},d.prototype.setPosition=function(a){for(var b in a)this._params[b]=a[b];this._update()},d.prototype.perspective=function(){return this._perspective},d.prototype.setPerspective=function(a){for(var b in a)this._perspective[b]=a[b];this._update()},d.prototype.show=function(){this._visible||(this._visible=!0,this._update())},d.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},d.prototype._update=function(){var a,b,c=this._domElement,d=this._params,e=this._position,f=!1;if(this._visible){var g=this._view;this._perspective.radius?(f=!0,this._setEmbeddedPosition(g,d)):(g.coordinatesToScreen(d,e),a=e.x,b=e.y,null!=a&&null!=b&&(f=!0,this._setPosition(a,b)))}f?(c.style.display="block",c.style.position="absolute"):(c.style.display="none",c.style.position="")},d.prototype._setEmbeddedPosition=function(a,b){var c=a.coordinatesToPerspectiveTransform(b,this._perspective.radius,this._perspective.extraRotations);h(this._domElement,c)},d.prototype._setPosition=function(a,b){g(this._domElement,a,b)},b.exports=d},{"./positionAbsolutely":58,"./support/Css":80,"./util/dom":98,"minimal-event-emitter":13}],16:[function(a,b,c){"use strict";function d(a,b,c,d,e){e=e||{},this._parentDomElement=a,this._stage=b,this._view=c,this._renderLoop=d,this._rect=e.rect,this._hotspotContainerWrapper=document.createElement("div"),j(this._hotspotContainerWrapper),o(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),j(this._hotspotContainer),o(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._hotspots=[],this._visible=!0,this._supported=!0,this._isVisible=!0,this._positionAndSize={},this._hasRect=null,this._newPositionAndSize={},this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}var e=a("minimal-event-emitter"),f=a("./Hotspot"),g=a("./calcRect"),h=a("./positionAbsolutely"),i=a("./support/cssPointerEvents"),j=a("./util/dom").setAbsolute,k=a("./util/dom").setOverflowHidden,l=a("./util/dom").setOverflowVisible,m=a("./util/dom").setNullSize,n=a("./util/dom").setPixelSize,o=a("./util/dom").setWithVendorPrefix("pointer-events");e(d),d.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),this._parentDomElement=null,this._stage=null,this._view=null,this._renderLoop=null,this._rect=null},d.prototype.domElement=function(){return this._hotspotContainer},d.prototype.setRect=function(a){this._rect=a},d.prototype.rect=function(){return this._rect},d.prototype.createHotspot=function(a,b,c){b=b||{};var d=new f(a,this._hotspotContainer,this._view,b,c);return this._hotspots.push(d),d._update(),this.emit("hotspotsChange"),d},d.prototype.hasHotspot=function(a){return this._hotspots.indexOf(a)>=0},d.prototype.listHotspots=function(){return[].concat(this._hotspots)},d.prototype.destroyHotspot=function(a){var b=this._hotspots.indexOf(a);if(0>b)throw new Error("No such hotspot");this._hotspots.splice(b,1),a._destroy(),this.emit("hotspotsChange")},d.prototype.hide=function(){this._visible=!1,this._updateVisibility()},d.prototype.show=function(){this._visible=!0,this._updateVisibility()},d.prototype._updateVisibility=function(){var a=this._visible&&this._supported;
a&&!this._isVisible?(this._hotspotContainerWrapper.style.display="block",this._isVisible=!0):!a&&this._isVisible&&(this._hotspotContainerWrapper.style.display="none",this._isVisible=!1)},d.prototype._update=function(){this._updatePositionAndSize();for(var a=0;a<this._hotspots.length;a++)this._hotspots[a]._update()},d.prototype._updatePositionAndSize=function(){this._rect?!i()&&this._hotspots.length>0?(console.warn("HotspotContainer: this browser does not support using effects.rect with hotspots. Hotspots will be hidden."),this._supported=!1):(g(this._stage.width(),this._stage.height(),this._rect,this._newPositionAndSize),this._setPositionAndSizeWithRect(this._newPositionAndSize),this._supported=!0):(this._setPositionAndSizeWithoutRect(),this._supported=!0),this._updateVisibility()},d.prototype._setPositionAndSizeWithRect=function(a){var b=this._hotspotContainerWrapper;this._hasRect!==!0&&k(b),this._hasRect===!0&&a.left===this._positionAndSize.left&&a.top===this._positionAndSize.top||h(b,a.left,a.top),this._hasRect===!0&&+a.width===this._positionAndSize.width&&a.height===this._positionAndSize.height||n(b,a.width,a.height),this._positionAndSize.left=a.left,this._positionAndSize.top=a.top,this._positionAndSize.width=a.width,this._positionAndSize.height=a.height,this._hasRect=!0},d.prototype._setPositionAndSizeWithoutRect=function(){this._hasRect!==!1&&(h(this._hotspotContainerWrapper,0,0),m(this._hotspotContainerWrapper),l(this._hotspotContainerWrapper),this._hasRect=!1)},b.exports=d},{"./Hotspot":15,"./calcRect":29,"./positionAbsolutely":58,"./support/cssPointerEvents":83,"./util/dom":98,"minimal-event-emitter":13}],17:[function(a,b,c){"use strict";function d(a,b,c,d,e,f){f=f||{};var g=this;this._stage=a,this._source=b,this._geometry=c,this._view=d,this._textureStore=e,this._effects=f.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){g.emit("viewChange",g.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){g.emit("textureStoreChange",g.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}var e=a("minimal-event-emitter"),f=a("./util/extend");e(d),d.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),this._stage.removeEventListener("resize",this._handleStageResize),this._stage=null,this._source=null,this._geometry=null,this._view=null,this._textureStore=null,this._fixedLevelIndex=null,this._effects=null,this._viewChangeHandler=null,this._textureStoreChangeHandler=null},d.prototype.source=function(){return this._source},d.prototype.geometry=function(){return this._geometry},d.prototype.view=function(){return this._view},d.prototype.textureStore=function(){return this._textureStore},d.prototype.effects=function(){return this._effects},d.prototype.setView=function(a){this._view=a,this.emit("viewChange",this._view)},d.prototype.setEffects=function(a){this._effects=a,this.emit("effectsChange",this._effects)},d.prototype.mergeEffects=function(a){f(this._effects,a),this.emit("effectsChange",this._effects)},d.prototype.fixedLevel=function(){return this._fixedLevelIndex},d.prototype.setFixedLevel=function(a){if(a!==this._fixedLevelIndex){if(null!=a&&(a>=this._geometry.levelList.length||0>a))throw new Error("Level index out of range: "+a);this._fixedLevelIndex=a,this.emit("fixedLevelChange",this._fixedLevelIndex)}},d.prototype._selectLevel=function(){var a;return a=null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},d.prototype.visibleTiles=function(a){var b=this._selectLevel();return this._geometry.visibleTiles(this._view,b,a)},d.prototype.pinLevel=function(a){for(var b=this._geometry.levelList[a],c=this._geometry.levelTiles(b),d=0;d<c.length;d++)this._textureStore.pin(c[d])},d.prototype.unpinLevel=function(a){for(var b=this._geometry.levelList[a],c=this._geometry.levelTiles(b),d=0;d<c.length;d++)this._textureStore.unpin(c[d])},d.prototype.pinFirstLevel=function(){return this.pinLevel(0)},d.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)},b.exports=d},{"./util/extend":99,"minimal-event-emitter":13}],18:[function(a,b,c){"use strict";function d(){this.constructor.super_.apply(this,arguments)}var e=a("./util/inherits");e(d,Error),b.exports=d},{"./util/inherits":101}],19:[function(a,b,c){"use strict";function d(a){var b=this;this._stage=a,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){b._rendering||b.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}var e=a("minimal-event-emitter");e(d),d.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),this._stage=null,this._running=null,this._rendering=null,this._requestHandle=null,this._boundLoop=null},d.prototype.stage=function(){return this._stage},d.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},d.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},d.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},d.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")},b.exports=d},{"minimal-event-emitter":13}],20:[function(a,b,c){"use strict";function d(a,b){this._viewer=a,this._layer=b,this._view=b.view(),this._hotspotContainer=new f(a._controlContainer,a._stage,this._view,a._renderLoop,{rect:b.effects().rect}),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._layer.addEventListener("effectsChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}var e=a("minimal-event-emitter"),f=a("./HotspotContainer"),g=a("./util/clock"),h=a("./util/noop"),i=a("./util/type"),j=a("./util/defaults");e(d),d.prototype._destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._layer.removeEventListener("effectsChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this._movement=null,this._viewer=null,this._layer=null,this._view=null,this._hotspotContainer=null},d.prototype.hotspotContainer=function(){return this._hotspotContainer},d.prototype.layer=function(){return this._layer},d.prototype.view=function(){return this._view},d.prototype.viewer=function(){return this._viewer},d.prototype.visible=function(){return this._viewer.scene()===this},d.prototype.switchTo=function(a,b){return this._viewer.switchScene(this,a,b)},d.prototype.lookTo=function(a,b,c){if(b=b||{},c=c||h,"object"!==i(a))throw new Error("Target view parameters must be an object");var d=null!=b.transitionDuration?b.transitionDuration:1e3,e=null==b.shortest||b.shortest,f=this._view,g=f.parameters(),k={};j(k,a),j(k,g),e&&f.normalizeToClosest&&f.normalizeToClosest(k,k);var l=function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)},m=function(){var a=!1;return function(b,c){if(c>=d&&a)return null;var e=Math.min(c/d,1);for(var f in b){var h=g[f],i=k[f];b[f]=h+l(e)*(i-h)}return a=c>=d,b}},n=this._viewer.controls().enabled();this._viewer.controls().disable(),this.startMovement(m,function(){n&&this._viewer.controls().enable(),c()})},d.prototype.startMovement=function(a,b){var c=this._viewer.renderLoop();this._movement&&this.stopMovement();var d=a();if("function"!=typeof d)throw new Error("Bad movement");this._movement=a,this._movementStep=d,this._movementStartTime=g(),this._movementParams={},this._movementCallback=b,c.addEventListener("beforeRender",this._updateMovementHandler),c.renderOnNextFrame()},d.prototype.stopMovement=function(){var a=this._viewer.renderLoop();this._movementCallback&&this._movementCallback(),a.removeEventListener("beforeRender",this._updateMovementHandler),this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null},d.prototype.movement=function(){return this._movement},d.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var a=this._viewer.renderLoop(),b=this._view,c=g()-this._movementStartTime,d=this._movementStep,e=this._movementParams;e=b.parameters(e),e=d(e,c),null==e?this.stopMovement():(b.setParameters(e),a.renderOnNextFrame())},d.prototype._updateHotspotContainer=function(){this._hotspotContainer.setRect(this._layer.effects().rect),this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()},b.exports=d},{"./HotspotContainer":16,"./util/clock":89,"./util/defaults":94,"./util/noop":103,"./util/type":111,"minimal-event-emitter":13}],21:[function(a,b,c){"use strict";function d(){}function e(a,b){var c=this;c._id=t++,c._store=a,c._tile=b,c._asset=null,c._texture=null,c._changeHandler=function(){a.emit("textureInvalid",b)};var e=a.source(),f=a.stage(),g=e.loadAsset.bind(e),h=f.createTexture.bind(f),i=m(l(g),h);o&&console.log("loading",c._id,c._tile),c._cancel=i(f,b,function(a,b,e,f){return c._cancel=null,a?(e&&e.destroy(),f&&f.destroy(),void(a instanceof d?(c._store.emit("textureCancel",c._tile),o&&console.log("cancel",c._id,c._tile)):(c._store.emit("textureError",c._tile,a),o&&console.log("error",c._id,c._tile)))):(c._texture=f,e.dynamic?(c._asset=e,e.addEventListener("change",c._changeHandler)):e.destroy(),c._store.emit("textureLoad",c._tile),void(o&&console.log("load",c._id,c._tile)))})}function f(a,b,c,d){d=k(d||{},s),this._source=b,this._stage=c;var e=a.TileClass;this._clientPhase=p,this._clientCounter=0,this._itemMap=new g(e.equals,e.hash),this._visible=new h(e.equals,e.hash),this._previouslyVisible=new i(e.equals,e.hash,d.previouslyVisibleCacheSize),this._pinMap=new g(e.equals,e.hash),this._newVisible=new h(e.equals,e.hash),this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}var g=a("./collections/Map"),h=a("./collections/Set"),i=a("./collections/LruSet"),j=a("minimal-event-emitter"),k=a("./util/defaults"),l=a("./util/retry"),m=a("./util/chain"),n=a("./util/inherits"),o="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.textureStore,p="idle",q="start",r="end",s={previouslyVisibleCacheSize:32},t=0;n(d,Error),e.prototype.asset=function(){return this._asset},e.prototype.texture=function(){return this._texture},e.prototype.destroy=function(){var a=this,b=a._id,c=a._store,e=a._tile,f=a._asset,g=a._texture,h=a._cancel;return h?void h(new d("Texture load cancelled")):(f&&(f.removeEventListener("change",a._changeHandler),f.destroy()),g&&g.destroy(),c.emit("textureUnload",e),o&&console.log("unload",b,e),a._changeHandler=null,a._asset=null,a._texture=null,a._tile=null,a._store=null,void(a._id=null))},j(e),j(f),f.prototype.destroy=function(){this.clear(),this._source=null,this._stage=null,this._itemMap=null,this._visible=null,this._previouslyVisible=null,this._pinMap=null,this._newVisible=null,this._noLongerVisible=null,this._visibleAgain=null,this._evicted=null},f.prototype.stage=function(){return this._stage},f.prototype.source=function(){return this._source},f.prototype.clear=function(){var a=this;a._evicted.length=0,a._itemMap.each(function(b){a._evicted.push(b)}),a._evicted.forEach(function(b){a._unloadTile(b)}),a._itemMap.clear(),a._visible.clear(),a._previouslyVisible.clear(),a._pinMap.clear(),a._newVisible.clear(),a._noLongerVisible.length=0,a._visibleAgain.length=0,a._evicted.length=0},f.prototype.clearNotPinned=function(){var a=this;a._evicted.length=0,a._itemMap.each(function(b){a._pinMap.has(b)||a._evicted.push(b)}),a._evicted.forEach(function(b){a._unloadTile(b)}),a._visible.clear(),a._previouslyVisible.clear(),a._evicted.length=0},f.prototype.startFrame=function(){if(this._clientPhase!==p&&this._clientPhase!==q)throw new Error("TextureStore: startFrame called out of sequence");this._clientPhase=q,this._clientCounter++,this._newVisible.clear()},f.prototype.markTile=function(a){if(this._clientPhase!==q)throw new Error("TextureStore: markTile called out of sequence");var b=this._itemMap.get(a),c=b&&b.texture(),d=b&&b.asset();c&&d&&c.refresh(a,d),this._newVisible.add(a)},f.prototype.endFrame=function(){if(this._clientPhase!==q&&this._clientPhase!==r)throw new Error("TextureStore: endFrame called out of sequence");this._clientPhase=r,this._clientCounter--,this._clientCounter||(this._update(),this._clientPhase=p)},f.prototype._update=function(){var a=this;a._noLongerVisible.length=0,a._visible.each(function(b){a._newVisible.has(b)||a._noLongerVisible.push(b)}),a._visibleAgain.length=0,a._newVisible.each(function(b){a._previouslyVisible.has(b)&&a._visibleAgain.push(b)}),a._visibleAgain.forEach(function(b){a._previouslyVisible.remove(b)}),a._evicted.length=0,a._noLongerVisible.forEach(function(b){var c=a._itemMap.get(b),d=c&&c.texture();if(d){var e=a._previouslyVisible.add(b);null!=e&&a._evicted.push(e)}else c&&a._unloadTile(b)}),a._evicted.forEach(function(b){a._pinMap.has(b)||a._unloadTile(b)}),a._newVisible.each(function(b){var c=a._itemMap.get(b);c||a._loadTile(b)});var b=a._visible;a._visible=a._newVisible,a._newVisible=b,a._noLongerVisible.length=0,a._visibleAgain.length=0,a._evicted.length=0},f.prototype._loadTile=function(a){if(this._itemMap.has(a))throw new Error("TextureStore: loading texture already in cache");var b=new e(this,a);this._itemMap.set(a,b)},f.prototype._unloadTile=function(a){var b=this._itemMap.del(a);if(!b)throw new Error("TextureStore: unloading texture not in cache");b.destroy()},f.prototype.asset=function(a){var b=this._itemMap.get(a);return b?b.asset():null},f.prototype.texture=function(a){var b=this._itemMap.get(a);return b?b.texture():null},f.prototype.pin=function(a){var b=(this._pinMap.get(a)||0)+1;return this._pinMap.set(a,b),this._itemMap.has(a)||this._loadTile(a),b},f.prototype.unpin=function(a){var b=this._pinMap.get(a);if(!b)throw new Error("TextureStore: unpin when not pinned");return b--,b>0?this._pinMap.set(a,b):(this._pinMap.del(a),this._visible.has(a)||this._previouslyVisible.has(a)||this._unloadTile(a)),b},f.prototype.query=function(a){var b=this._itemMap.get(a),c=this._pinMap.get(a)||0;return{visible:this._visible.has(a),previouslyVisible:this._previouslyVisible.has(a),hasAsset:null!=b&&null!=b.asset(),hasTexture:null!=b&&null!=b.texture(),pinned:0!==c,pinCount:c}},b.exports=f},{"./collections/LruSet":31,"./collections/Map":32,"./collections/Set":33,"./util/chain":87,"./util/defaults":94,"./util/inherits":101,"./util/retry":108,"minimal-event-emitter":13}],22:[function(a,b,c){"use strict";function d(a){a=f(a||{},h),this._duration=a.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}var e=a("minimal-event-emitter"),f=a("./util/defaults"),g=a("./util/clock"),h={duration:1/0};e(d),d.prototype.start=function(){this._startTime=g(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},d.prototype.started=function(){return null!=this._startTime},d.prototype.stop=function(){this._startTime=null,null!=this._handle&&(clearTimeout(this._handle),this._handle=null)},d.prototype.reset=function(){this.start()},d.prototype._setup=function(a){this._handle=setTimeout(this._check,a)},d.prototype._check=function(){var a=g(),b=a-this._startTime,c=this._duration-b;this._handle=null,0>=c?(this.emit("timeout"),this._startTime=null):1/0>c&&this._setup(c)},d.prototype.duration=function(){return this._duration},d.prototype.setDuration=function(a){this._duration=a,null!=this._startTime&&(null!=this._handle&&(clearTimeout(this._handle),this._handle=null),this._check())},b.exports=d},{"./util/clock":89,"./util/defaults":94,"minimal-event-emitter":13}],23:[function(a,b,c){"use strict";function d(a,b){b=b||{},this._domElement=a,r(a);var c;if(b.stageType){if(c=z[b.stageType],!c)throw new Error("Unknown stage type: "+b.stageType)}else{for(var d=0;d<A.length;d++)if(A[d].supported()){c=A[d];break}if(!c)throw new Error("None of the stage types are supported")}this._stage=new c(b.stage),q(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),s(this._controlContainer),t(this._controlContainer);var e=document.createElement("div");s(e),t(e),u(e),this._controlContainer.appendChild(e),a.appendChild(this._controlContainer),this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new g(this._stage),this._controls=new h,this._controlMethods=p(this._controls,this._controlContainer,b.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=y.get(this._controlContainer,"touch"),this._hammerManagerMouse=y.get(this._controlContainer,"mouse"),b.cursors=b.cursors||{},this._dragCursor=new x(this._controls,"mouseViewDrag",a,b.cursors.drag),this._renderLoop.start(),this._scenes=[],this._scene=null,this._cancelCurrentTween=null,this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new l,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._enterIdleHandler=this._enterIdle.bind(this),this._idleTimer.addEventListener("timeout",this._enterIdleHandler),this._leaveIdleHandler=this._leaveIdle.bind(this),this._controls.addEventListener("active",this._leaveIdleHandler),this.addEventListener("sceneChange",this._leaveIdleHandler),this._idleMovement=null}function e(a,b,c){b.layer().mergeEffects({opacity:a}),b._hotspotContainer.domElement().style.opacity=a}var f=a("minimal-event-emitter"),g=a("./RenderLoop"),h=a("./controls/Controls"),i=a("./Layer"),j=a("./TextureStore"),k=a("./Scene"),l=a("./Timer"),m=a("./stages/WebGl"),n=a("./stages/Css"),o=a("./stages/Flash"),p=a("./controls/registerDefaultControls"),q=a("./renderers/registerDefaultRenderers"),r=a("./util/dom").setOverflowHidden,s=a("./util/dom").setAbsolute,t=a("./util/dom").setFullSize,u=a("./util/dom").setBlocking,v=a("./util/tween"),w=a("./util/noop"),x=a("./controls/DragCursor"),y=a("./controls/HammerGestures"),z={webgl:m,css:n,flash:o},A=[m,n,o];f(d),d.prototype.destroy=function(){window.removeEventListener("resize",this._updateSizeListener),this._updateSizeListener=null,this._scene&&this._scene.view().removeEventListener("change",this._viewChangeHandler),this._viewChangeHandler=null;for(var a in this._controlMethods)this._controlMethods[a].destroy();for(this._controlMethods=null;this._scenes.length;)this.destroyScene(this._scenes[0]);this._scenes=null,this._scene=null,this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._stage=null,this._renderLoop.destroy(),this._renderLoop=null,this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._domElement=null,this._controlContainer=null},d.prototype.updateSize=function(){this._stage.updateSize()},d.prototype.stage=function(){return this._stage},d.prototype.renderLoop=function(){return this._renderLoop},d.prototype.controls=function(){return this._controls},d.prototype.domElement=function(){return this._domElement},d.prototype.createScene=function(a){a=a||{};var b=this._stage,c=a.source,d=a.geometry,e=a.view,f=new j(d,c,b,a.textureStore),g=new i(b,c,d,e,f,a.layerOpts);a.pinFirstLevel&&g.pinFirstLevel();var h=new k(this,g);return this._scenes.push(h),h},d.prototype._addLayer=function(a){a.pinFirstLevel(),this._stage.addLayer(a)},d.prototype._removeLayer=function(a){this._stage.hasLayer(a)&&(a.unpinFirstLevel(),this._stage.removeLayer(a)),a.textureStore().clearNotPinned()},d.prototype.destroyScene=function(a){var b=this._scenes.indexOf(a);if(0>b)throw new Error("No such scene in viewer");this._removeLayer(a._layer),this._scene===a&&(this._scene=null,this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null)),this._scenes.splice(b,1);var c=a._layer,d=c.textureStore();a._destroy(),c.destroy(),d.destroy()},d.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},d.prototype.hasScene=function(a){return this._scenes.indexOf(a)>=0},d.prototype.listScenes=function(){return[].concat(this._scenes)},d.prototype.scene=function(){return this._scene},d.prototype.view=function(){var a=this._scene;return a?a.layer().view():null},d.prototype.lookTo=function(a,b,c){var d=this._scene;d&&d.lookTo(a,b,c)},d.prototype.startMovement=function(a,b){var c=this._scene;c&&c.startMovement(a,b)},d.prototype.stopMovement=function(){var a=this._scene;a&&a.stopMovement()},d.prototype.setIdleMovement=function(a,b){this._idleTimer.setDuration(a),this._idleMovement=b},d.prototype.breakIdleMovement=function(){this._leaveIdle(),this._resetIdleTimer()},d.prototype._resetIdleTimer=function(){this._idleTimer.reset()},d.prototype._enterIdle=function(){var a=this._scene,b=this._idleMovement;a&&b&&a.startMovement(b)},d.prototype._leaveIdle=function(){var a=this._scene;a&&a.movement()===this._idleMovement&&a.stopMovement()};var B=1e3;d.prototype.switchScene=function(a,b,c){function d(b){k(b,a,h)}function f(){h&&l._removeLayer(h.layer()),l._cancelCurrentTween=null,c()}b=b||{},c=c||w;var g=this._stage,h=this._scene;if(h===a)return void c();if(this._scenes.indexOf(a)<0)throw new Error("No such scene in viewer");var i=g.listLayers();if(h&&h.layer()!==i[i.length-1])throw new Error("Stage not in sync with viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var j=null!=b.transitionDuration?b.transitionDuration:B,k=null!=b.transitionUpdate?b.transitionUpdate:e,l=this;l._addLayer(a.layer()),this._cancelCurrentTween=v(j,d,f),this._scene=a,this.emit("sceneChange"),this.emit("viewChange"),h&&h.view().removeEventListener("change",this._viewChangeHandler),a.view().addEventListener("change",this._viewChangeHandler)},b.exports=d},{"./Layer":17,"./RenderLoop":19,"./Scene":20,"./TextureStore":21,"./Timer":22,"./controls/Controls":38,"./controls/DragCursor":40,"./controls/HammerGestures":43,"./controls/registerDefaultControls":50,"./renderers/registerDefaultRenderers":70,"./stages/Css":73,"./stages/Flash":74,"./stages/WebGl":77,"./util/dom":98,"./util/noop":103,"./util/tween":110,"minimal-event-emitter":13}],24:[function(a,b,c){"use strict";function d(a,b){b=b||{},this._opts=b,this._element=a,this._timestamp=1,this._lastUsedTime=null}var e=a("minimal-event-emitter");e(d),d.prototype.element=function(){return this._element},d.prototype.width=function(){return this._element.width},d.prototype.height=function(){return this._element.height},d.prototype.dynamic=!0,d.prototype.timestamp=function(){return this._timestamp},d.prototype.changed=function(){this._timestamp++,this.emit("change")},d.prototype.destroy=function(){this._opts.unload&&this._opts.unload()},b.exports=d},{"minimal-event-emitter":13}],25:[function(a,b,c){"use strict";function d(a,b){this._flashElement=a,this._imageId=b}d.prototype.element=function(){return this._imageId},d.prototype.timestamp=function(){return 0},d.prototype.dynamic=!1,d.prototype.destroy=function(){var a=this._flashElement,b=this._imageId;a.unloadImage(b),this._flashElement=null,this._imageId=null},b.exports=d},{}],26:[function(a,b,c){"use strict";function d(a){this._element=a}var e=a("../util/noop");d.prototype.element=function(){return this._element},d.prototype.width=function(){return this._element.width},d.prototype.height=function(){return this._element.height},d.prototype.timestamp=function(){return 0},d.prototype.dynamic=!1,d.prototype.destroy=e,b.exports=d},{"../util/noop":103}],27:[function(a,b,c){"use strict";function d(a){this._element=a}var e=a("../util/noop");d.prototype.element=function(){return this._element},d.prototype.width=function(){return this._element.naturalWidth},d.prototype.height=function(){return this._element.naturalHeight},d.prototype.timestamp=function(){return 0},d.prototype.dynamic=!1,d.prototype.destroy=e,b.exports=d},{"../util/noop":103}],28:[function(a,b,c){"use strict";function d(a){a=e(a||{},h);var b=a.yawSpeed,c=a.pitchSpeed,d=a.fovSpeed,f=a.yawAccel,g=a.pitchAccel,i=a.fovAccel,j=a.targetPitch,k=a.targetFov;return function(){var a,e,h,l,m=0,n=0,o=0,p=0,q=0,r=0,s=0;return function(t,u){if(a=(u-m)/1e3,q=Math.min(n+a*f,b),e=q*a,t.yaw=t.yaw+e,null!=j&&t.pitch!==j){var v=.5*o*o/g;r=Math.abs(j-t.pitch)>v?Math.min(o+a*g,c):Math.max(o-a*g,0),h=r*a,j<t.pitch&&(t.pitch=Math.max(j,t.pitch-h)),j>t.pitch&&(t.pitch=Math.min(j,t.pitch+h))}if(null!=k&&t.fov!==j){var w=.5*p*p/i;s=Math.abs(k-t.fov)>w?Math.min(p+a*i,d):Math.max(p-a*i,0),l=s*a,k<t.fov&&(t.fov=Math.max(k,t.fov-l)),k>t.fov&&(t.fov=Math.min(k,t.fov+l))}return m=u,n=q,o=r,p=s,t}}}var e=a("./util/defaults"),f=.1,g=.01,h={yawSpeed:f,pitchSpeed:f,fovSpeed:f,yawAccel:g,pitchAccel:g,fovAccel:g,targetPitch:0,targetFov:null};b.exports=d},{"./util/defaults":94}],29:[function(a,b,c){"use strict";function d(a,b,c,d){d=d||{};var e;e=null!=c&&null!=c.absoluteWidth?c.absoluteWidth:null!=c&&null!=c.relativeWidth?c.relativeWidth*a:a;var f;f=c&&null!=c.absoluteHeight?c.absoluteHeight:null!=c&&null!=c.relativeHeight?c.relativeHeight*b:b;var g;g=null!=c&&null!=c.absoluteX?c.absoluteX:null!=c&&null!=c.relativeX?c.relativeX*a:0;var h;return h=null!=c&&null!=c.absoluteY?c.absoluteY:null!=c&&null!=c.relativeY?c.relativeY*b:0,d.height=f,d.width=e,d.left=g,d.top=h,d.right=g+e,d.bottom=h+f,d.totalWidth=a,d.totalHeight=b,d}b.exports=d},{}],30:[function(a,b,c){"use strict";function d(a,b,c){if("function"!=typeof a)throw new Error("LruMap: bad equals function");if(this._equals=a,"function"!=typeof b)throw new Error("LruMap: bad hash function");if(this._hash=b,"number"!=typeof c||isNaN(c)||0>c)throw new Error("LruMap: bad maximum size");this._maxsize=c,this._keys=[],this._values=[],this._pivot=0}var e=a("../util/mod");d.prototype._modulus=function(){return this._maxsize>this._keys.length?this._keys.length+1:this._maxsize},d.prototype.get=function(a){for(var b=0;b<this._keys.length;b++){var c=this._keys[b];if(this._equals(a,c)){var d=this._values[b];return d}}return null},d.prototype.set=function(a,b){var c=null,d=!1;if(0===this._maxsize)return a;for(var f=0;f<this._keys.length;f++){var g=this._keys[f];if(this._equals(a,g)){for(var h=f,i=this._modulus();h!==this._pivot;){var j=e(h+1,i);this._keys[h]=this._keys[j],this._values[h]=this._values[j],h=j}d=!0;break}}return d||(c=this._pivot<this._keys.length?this._keys[this._pivot]:null),this._keys[this._pivot]=a,this._values[this._pivot]=b,this._pivot=e(this._pivot+1,this._modulus()),c},d.prototype.del=function(a){for(var b=0;b<this._keys.length;b++){var c=this._keys[b];if(this._equals(a,c)){for(var d=this._values[b],f=b;f<this._keys.length-1;f++)this._keys[f]=this._keys[f+1],this._values[f]=this._values[f+1];return this._keys.length=this._keys.length-1,this._values.length=this._values.length-1,b<this._pivot&&(this._pivot=e(this._pivot-1,this._modulus())),d}}return null},d.prototype.has=function(a){for(var b=0;b<this._keys.length;b++){var c=this._keys[b];if(this._equals(a,c))return!0}return!1},d.prototype.size=function(){return this._keys.length},d.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._pivot=0},d.prototype.each=function(a){for(var b=0,c=0;c<this._keys.length;c++){var d=this._keys[c],e=this._values[c];a(d,e),b+=1}return b},b.exports=d},{"../util/mod":102}],31:[function(a,b,c){"use strict";function d(a,b,c){if("function"!=typeof a)throw new Error("LruSet: bad equals function");if(this._equals=a,"function"!=typeof b)throw new Error("LruSet: bad hash function");if(this._hash=b,"number"!=typeof c||isNaN(c)||0>c)throw new Error("LruSet: bad maximum size");this._maxsize=c,this._items=[],this._pivot=0}var e=a("../util/mod");d.prototype._modulus=function(){return this._maxsize>this._items.length?this._items.length+1:this._maxsize},d.prototype.add=function(a){var b=null,c=!1;if(0===this._maxsize)return a;for(var d=0;d<this._items.length;d++){var f=this._items[d];if(this._equals(a,f)){for(var g=d,h=this._modulus();g!==this._pivot;){var i=e(g+1,h);this._items[g]=this._items[i],g=i}c=!0;break}}return c||(b=this._pivot<this._items.length?this._items[this._pivot]:null),this._items[this._pivot]=a,this._pivot=e(this._pivot+1,this._modulus()),b},d.prototype.remove=function(a){for(var b=0;b<this._items.length;b++){var c=this._items[b];if(this._equals(a,c)){for(var d=b;d<this._items.length-1;d++)this._items[d]=this._items[d+1];return this._items.length=this._items.length-1,b<this._pivot&&(this._pivot=e(this._pivot-1,this._modulus())),c}}return null},d.prototype.has=function(a){for(var b=0;b<this._items.length;b++){var c=this._items[b];if(this._equals(a,c))return!0}return!1},d.prototype.size=function(){return this._items.length},d.prototype.clear=function(){this._items.length=0,this._pivot=0},d.prototype.each=function(a){for(var b=0,c=0;c<this._items.length;c++){var d=this._items[c];a(d),b+=1}return b},b.exports=d},{"../util/mod":102}],32:[function(a,b,c){"use strict";function d(a,b,c){if("function"!=typeof a)throw new Error("Map: bad equals function");if(this._equals=a,"function"!=typeof b)throw new Error("Map: bad hash function");if(this._hash=b,null!=c){if("number"!=typeof c||isNaN(c)||1>c)throw new Error("Map: bad number of buckets");this._nbuckets=c}else this._nbuckets=e;this._keyBuckets=[],this._valBuckets=[];for(var d=0;d<this._nbuckets;d++)this._keyBuckets.push([]),this._valBuckets.push([])}var e=32;d.prototype._hashmod=function(a){return this._hash(a)%this._nbuckets},d.prototype.get=function(a){for(var b=this._hashmod(a),c=this._keyBuckets[b],d=0;d<c.length;d++){var e=c[d];if(this._equals(a,e)){var f=this._valBuckets[b],g=f[d];return g}}return null},d.prototype.set=function(a,b){for(var c=this._hashmod(a),d=this._keyBuckets[c],e=this._valBuckets[c],f=0;f<d.length;f++){var g=d[f];if(this._equals(a,g)){var h=e[f];return d[f]=a,e[f]=b,h}}return d.push(a),e.push(b),null},d.prototype.del=function(a){for(var b=this._hashmod(a),c=this._keyBuckets[b],d=this._valBuckets[b],e=0;e<c.length;e++){var f=c[e];if(this._equals(a,f)){for(var g=d[e],h=e;h<c.length-1;h++)c[h]=c[h+1],d[h]=d[h+1];return c.length=c.length-1,d.length=d.length-1,g}}return null},d.prototype.has=function(a){for(var b=this._hashmod(a),c=this._keyBuckets[b],d=0;d<c.length;d++){var e=c[d];if(this._equals(a,e))return!0}return!1},d.prototype.size=function(){for(var a=0,b=0;b<this._nbuckets;b++){var c=this._keyBuckets[b];a+=c.length}return a},d.prototype.clear=function(){for(var a=0;a<this._nbuckets;a++){var b=this._keyBuckets[a],c=this._valBuckets[a];b.length=0,c.length=0}},d.prototype.each=function(a){for(var b=0,c=0;c<this._nbuckets;c++)for(var d=this._keyBuckets[c],e=this._valBuckets[c],f=0;f<d.length;f++){var g=d[f],h=e[f];a(g,h),b+=1}return b},b.exports=d},{}],33:[function(a,b,c){"use strict";function d(a,b,c){if("function"!=typeof a)throw new Error("Set: bad equals function");
if(this._equals=a,"function"!=typeof b)throw new Error("Set: bad hash function");if(this._hash=b,null!=c){if("number"!=typeof c||isNaN(c)||1>c)throw new Error("Set: bad number of buckets");this._nbuckets=c}else this._nbuckets=e;this._buckets=[];for(var d=0;d<this._nbuckets;d++)this._buckets.push([])}var e=32;d.prototype._hashmod=function(a){return this._hash(a)%this._nbuckets},d.prototype.add=function(a){for(var b=this._hashmod(a),c=this._buckets[b],d=0;d<c.length;d++){var e=c[d];if(this._equals(a,e))return c[d]=a,e}return c.push(a),null},d.prototype.remove=function(a){for(var b=this._hashmod(a),c=this._buckets[b],d=0;d<c.length;d++){var e=c[d];if(this._equals(a,e)){for(var f=d;f<c.length-1;f++)c[f]=c[f+1];return c.length=c.length-1,e}}return null},d.prototype.has=function(a){for(var b=this._hashmod(a),c=this._buckets[b],d=0;d<c.length;d++){var e=c[d];if(this._equals(a,e))return!0}return!1},d.prototype.size=function(){for(var a=0,b=0;b<this._nbuckets;b++){var c=this._buckets[b];a+=c.length}return a},d.prototype.clear=function(){for(var a=0;a<this._nbuckets;a++){var b=this._buckets[a];b.length=0}},d.prototype.each=function(a){for(var b=0,c=0;c<this._nbuckets;c++)for(var d=this._buckets[c],e=0;e<d.length;e++){var f=d[e];a(f),b+=1}return b},b.exports=d},{}],34:[function(a,b,c){"use strict";function d(a){this._concurrency=a&&a.concurrency||1,this._paused=a&&!!a.paused||!1,this._pool=[];for(var b=0;b<this._concurrency;b++)this._pool.push(new e(a));this._next=0}var e=a("./WorkQueue"),f=a("../util/mod");d.prototype.length=function(){for(var a=0,b=0;b<this._pool.length;b++)a+=this._pool[b].length();return a},d.prototype.push=function(a,b){var c=this._next,d=this._pool[c].push(a,b);return this._next=f(this._next+1,this._concurrency),d},d.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var a=0;a<this._concurrency;a++)this._pool[a].pause()}},d.prototype.resume=function(){if(this._paused){this._paused=!1;for(var a=0;a<this._concurrency;a++)this._pool[a].resume()}},b.exports=d},{"../util/mod":102,"./WorkQueue":35}],35:[function(a,b,c){"use strict";function d(a,b){this.fn=a,this.cb=b,this.cfn=null}function e(a){this._queue=[],this._delay=a&&a.delay||0,this._paused=a&&!!a.paused||!1,this._currentTask=null,this._lastFinished=null}var f=a("../util/clock");e.prototype.length=function(){return this._queue.length},e.prototype.push=function(a,b){var c=new d(a,b),e=this._cancel.bind(this,c);return this._queue.push(c),this._next(),e},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},e.prototype._start=function(a){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=a;var b=this._finish.bind(this,a);if(a.cfn=a.fn(b),"function"!=typeof a.cfn)throw new Error("WorkQueue: function is not cancellable")},e.prototype._finish=function(a){var b=Array.prototype.slice.call(arguments,1);if(this._currentTask!==a)throw new Error("WorkQueue: called finish on wrong task");a.cb.apply(null,b),this._currentTask=null,this._lastFinished=f(),this._next()},e.prototype._cancel=function(a){var b=Array.prototype.slice.call(arguments,1);if(this._currentTask===a)a.cfn.apply(null,b);else{var c=this._queue.indexOf(a);c>=0&&(this._queue.splice(c,1),a.cb.apply(null,b))}},e.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var a=f()-this._lastFinished,b=this._delay-a;if(b>0)return void setTimeout(this._next.bind(this),b)}var c=this._queue.shift();this._start(c)}},b.exports=e},{"../util/clock":89}],36:[function(a,b,c){"use strict";function d(a){var b=a||{};return b.colorOffset=b.colorOffset||h.create(),b.colorMatrix=b.colorMatrix||i.create(),b}function e(a,b,c){f(c,a,b.colorMatrix),h.add(c,c,b.colorOffset)}function f(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[1]*e+c[2]*f+c[3]*g,a[1]=c[4]*d+c[5]*e+c[6]*f+c[7]*g,a[2]=c[8]*d+c[9]*e+c[10]*f+c[11]*g,a[3]=c[12]*d+c[13]*e+c[14]*f+c[15]*g,a}function g(a,b){for(var c=a.width,d=a.height,f=a.data,g=0;c*d>g;g++)h.set(j,f[4*g+0]/255,f[4*g+1]/255,f[4*g+2]/255,f[4*g+3]/255),e(j,b,j),f[4*g+0]=255*j[0],f[4*g+1]=255*j[1],f[4*g+2]=255*j[2],f[4*g+3]=255*j[3]}var h=a("gl-matrix/src/gl-matrix/vec4"),i=a("gl-matrix/src/gl-matrix/mat4"),j=h.create();b.exports={identity:d,applyToPixel:e,applyToImageData:g}},{"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec4":11}],37:[function(a,b,c){"use strict";function d(a){a=a||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._clock=a.clock||g,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}var e=a("minimal-event-emitter"),f=a("./Dynamics"),g=a("../util/clock");e(d),d.prototype.add=function(a){if(!this.has(a)){var b={};this._parameters.forEach(function(a){b[a]={dynamics:new f,time:null}});var c=this._updateDynamics.bind(this,b),d={instance:a,dynamics:b,parameterDynamicsHandler:c};a.addEventListener("parameterDynamics",c),this._methods.push(d)}},d.prototype.remove=function(a){var b=this._indexOfInstance(a);if(b>=0){var c=this._methods.splice(b,1)[0];c.instance.removeEventListener("parameterDynamics",c.parameterDynamicsHandler)}},d.prototype.has=function(a){return this._indexOfInstance(a)>=0},d.prototype._indexOfInstance=function(a){for(var b=0;b<this._methods.length;b++)if(this._methods[b].instance===a)return b;return-1},d.prototype.list=function(){for(var a=[],b=0;b<this._methods.length;b++)a.push(this._methods[b].instance);return a},d.prototype._updateDynamics=function(a,b,c,d){var e=a[c];if(!e)throw new Error("Unknown control parameter "+c);var f=this._clock();e.dynamics.update(d,(f-e.time)/1e3),e.time=f,this.emit("change")},d.prototype._resetComposedOffsets=function(){for(var a=0;a<this._parameters.length;a++)this._composedOffsets[this._parameters[a]]=0},d.prototype.offsets=function(){var a,b=!1,c=this._clock();this._resetComposedOffsets();for(var d=0;d<this._methods.length;d++)for(var e=this._methods[d].dynamics,f=0;f<this._parameters.length;f++){a=this._parameters[f];var g=e[a],h=g.dynamics;null!=h.offset&&(this._composedOffsets[a]+=h.offset,h.offset=null);var i=(c-g.time)/1e3,j=h.offsetFromVelocity(i);j&&(this._composedOffsets[a]+=j);var k=h.velocityAfter(i);h.velocity=k,k&&(b=!0),g.time=c}return this._composeReturn.changing=b,this._composeReturn},d.prototype.destroy=function(){for(var a=this.list(),b=0;b<a.length;b++)this.remove(a[b]);this._methods=null},b.exports=d},{"../util/clock":89,"./Dynamics":41,"minimal-event-emitter":13}],38:[function(a,b,c){"use strict";function d(a){a=a||{},this._methods={},this._methodGroups={},this._composer=new e,this._enabled=!a||!a.enabled||!!a.enabled,this._activeCount=0,this._attachedRenderLoop=null}var e=a("./Composer"),f=a("minimal-event-emitter"),g="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;f(d),d.prototype.methods=function(){var a={};for(var b in this._methods)a[b]=this._methods[b];return a},d.prototype.method=function(a){return this._methods[a]},d.prototype.registerMethod=function(a,b,c){if(this._methods[a])throw new Error("Control method already registered with id "+a);this._methods[a]={instance:b,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,a),inactiveHandler:this._handleInactive.bind(this,a)},c&&this.enableMethod(a,b)},d.prototype.unregisterMethod=function(a){var b=this._methods[a];if(!b)throw new Error("No control method registered with id "+a);b.enabled&&this.disableMethod(a),delete this._methods[a]},d.prototype.enableMethod=function(a){var b=this._methods[a];if(!b)throw new Error("No control method registered with id "+a);b.enabled||(b.enabled=!0,b.active&&this._incrementActiveCount(),this._listen(a),this._updateComposer(),this.emit("methodEnabled",a))},d.prototype.disableMethod=function(a){var b=this._methods[a];if(!b)throw new Error("No control method registered with id "+a);b.enabled&&(b.enabled=!1,b.active&&this._decrementActiveCount(),this._unlisten(a),this._updateComposer(),this.emit("methodDisabled",a))},d.prototype.addMethodGroup=function(a,b){this._methodGroups[a]=b},d.prototype.removeMethodGroup=function(a){delete this._methodGroups[a]},d.prototype.methodGroups=function(){var a={};for(var b in this._methodGroups)a[b]=this._methodGroups[b];return a},d.prototype.enableMethodGroup=function(a){var b=this;b._methodGroups[a].forEach(function(a){b.enableMethod(a)})},d.prototype.disableMethodGroup=function(a){var b=this;b._methodGroups[a].forEach(function(a){b.disableMethod(a)})},d.prototype.enabled=function(){return this._enabled},d.prototype.enable=function(){this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer()},d.prototype.disable=function(){this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer()},d.prototype.attach=function(a){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=a,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=a.renderOnNextFrame.bind(a),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},d.prototype.detach=function(){this._attachedRenderLoop&&(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},d.prototype.attached=function(){return null!=this._attachedRenderLoop},d.prototype._listen=function(a){var b=this._methods[a];if(!b)throw new Error("Bad method id");b.instance.addEventListener("active",b.activeHandler),b.instance.addEventListener("inactive",b.inactiveHandler)},d.prototype._unlisten=function(a){var b=this._methods[a];if(!b)throw new Error("Bad method id");b.instance.removeEventListener("active",b.activeHandler),b.instance.removeEventListener("inactive",b.inactiveHandler)},d.prototype._handleActive=function(a){var b=this._methods[a];if(!b)throw new Error("Bad method id");if(!b.enabled)throw new Error("Should not receive event from disabled control method");b.active||(b.active=!0,this._incrementActiveCount())},d.prototype._handleInactive=function(a){var b=this._methods[a];if(!b)throw new Error("Bad method id");if(!b.enabled)throw new Error("Should not receive event from disabled control method");b.active&&(b.active=!1,this._decrementActiveCount())},d.prototype._incrementActiveCount=function(){this._activeCount++,g&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},d.prototype._decrementActiveCount=function(){this._activeCount--,g&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},d.prototype._checkActiveCount=function(){var a=0;for(var b in this._methods){var c=this._methods[b];c.enabled&&c.active&&a++}if(a!=this._activeCount)throw new Error("Bad control state")},d.prototype._updateComposer=function(){var a=this._composer;for(var b in this._methods){var c=this._methods[b],d=this._enabled&&c.enabled;d&&!a.has(c.instance)&&a.add(c.instance),!d&&a.has(c.instance)&&a.remove(c.instance)}},d.prototype._updateViewsWithControls=function(){var a=this._composer.offsets();a.changing&&this._attachedRenderLoop.renderOnNextFrame();for(var b=this._attachedRenderLoop.stage().listLayers(),c=0;c<b.length;c++)b[c].view().updateWithControlParameters(a.offsets)},d.prototype.destroy=function(){this.detach(),this._composer.destroy(),this._methods=null},b.exports=d},{"./Composer":37,"minimal-event-emitter":13}],39:[function(a,b,c){"use strict";function d(a,b,c){this._element=a,this._opts=g(c||{},j),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new e,y:new e},this._hammer=f.get(a,b),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleEnd.bind(this)),this._hammer.on("pancancel",this._handleEnd.bind(this))}var e=a("./Dynamics"),f=a("./HammerGestures"),g=a("../util/defaults"),h=a("minimal-event-emitter"),i=a("./util").maxFriction,j={friction:6,maxFrictionTime:.3},k="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;h(d),d.prototype.destroy=function(){this._hammer.release(),this._element=null,this._opts=null,this._startEvent=null,this._lastEvent=null,this._active=null,this._dynamics=null,this._hammer=null},d.prototype._handleHammerEvent=function(a){if(a.isFirst){if(k&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(a.isFinal){if(k&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},d.prototype._handleStart=function(a){a.preventDefault(),this._startEvent=a},d.prototype._handleMove=function(a){a.preventDefault(),this._startEvent&&(this._updateDynamicsMove(a),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},d.prototype._handleEnd=function(a){a.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(a),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},d.prototype._updateDynamicsMove=function(a){var b=a.deltaX,c=a.deltaY,d=this._lastEvent||this._startEvent;d&&(b-=d.deltaX,c-=d.deltaY);var e=this._element.getBoundingClientRect(),f=e.right-e.left,g=e.bottom-e.top;b/=f,c/=g,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-b,this._dynamics.y.offset=-c,this._lastEvent=a};var l=[null,null];d.prototype._updateDynamicsRelease=function(a){var b=this._element.getBoundingClientRect(),c=b.right-b.left,d=b.bottom-b.top,e=1e3*a.velocityX/c,f=1e3*a.velocityY/d;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=e,this._dynamics.y.velocity=f,i(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,l),this._dynamics.x.friction=l[0],this._dynamics.y.friction=l[1]},b.exports=d},{"../util/defaults":94,"./Dynamics":41,"./HammerGestures":43,"./util":51,"minimal-event-emitter":13}],40:[function(a,b,c){"use strict";function d(a,b,c,d){d=d||{},d.active=["move"],d.inactive=["default"],d.disabled=[null],this._controls=a,this._id=b,this._attached=!1,this._setActiveCursor=e.bind(null,c,d.active),this._setInactiveCursor=e.bind(null,c,d.inactive),this._setDisabledCursor=e.bind(null,c,d.disabled),a.method(b).enabled&&this._attachCursor(a.method(b)),this._enableChangeHandler=this._updateAttach.bind(this),a.addEventListener("methodEnabled",this._enableChangeHandler),a.addEventListener("methodDisabled",this._enableChangeHandler),a.addEventListener("enabled",this._enableChangeHandler),a.addEventListener("disabled",this._enableChangeHandler)}function e(a,b){b.forEach(function(b){a.style.cursor=b})}d.prototype.destroy=function(){this._detachCursor(this._controls.method(this._id)),this._controls.removeEventListener("methodEnabled",this._enableChangeHandler),this._controls.removeEventListener("methodDisabled",this._enableChangeHandler),this._controls.removeEventListener("enabled",this._enableChangeHandler),this._controls.removeEventListener("disabled",this._enableChangeHandler)},d.prototype._updateAttach=function(){var a=this._controls,b=this._id;a.enabled()&&a.method(b).enabled?this._attachCursor(a.method(b)):this._detachCursor(a.method(b))},d.prototype._attachCursor=function(a){this._attached||(a.instance.addEventListener("active",this._setActiveCursor),a.instance.addEventListener("inactive",this._setInactiveCursor),a.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},d.prototype._detachCursor=function(a){this._attached&&(a.instance.removeEventListener("active",this._setActiveCursor),a.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},b.exports=d},{}],41:[function(a,b,c){"use strict";function d(){this.velocity=null,this.friction=null,this.offset=null}function e(a,b){return 0>a?Math.min(0,a+b):a>0?Math.max(0,a-b):0}d.equals=function(a,b){return a.velocity===b.velocity&&a.friction===b.friction&&a.offset===b.offset},d.prototype.equals=function(a){return d.equals(this,a)},d.prototype.update=function(a,b){a.offset&&(this.offset=this.offset||0,this.offset+=a.offset);var c=this.offsetFromVelocity(b);c&&(this.offset=this.offset||0,this.offset+=c),this.velocity=a.velocity,this.friction=a.friction},d.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},d.prototype.velocityAfter=function(a){return this.velocity?this.friction?e(this.velocity,this.friction*a):this.velocity:null},d.prototype.offsetFromVelocity=function(a){a=Math.min(a,this.nullVelocityTime());var b=this.velocityAfter(a),c=(this.velocity+b)/2;return c*a},d.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)},b.exports=d},{}],42:[function(a,b,c){"use strict";function d(a,b,c,d){if(!a)throw new Error("ElementPressControlMethod: element must be defined");if(!b)throw new Error("ElementPressControlMethod: parameter must be defined");if(!c)throw new Error("ElementPressControlMethod: velocity must be defined");if(!d)throw new Error("ElementPressControlMethod: friction must be defined");this._element=a,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),a.addEventListener("mousedown",this._pressHandler),a.addEventListener("mouseup",this._releaseHandler),a.addEventListener("mouseleave",this._releaseHandler),a.addEventListener("touchstart",this._pressHandler),a.addEventListener("touchmove",this._releaseHandler),a.addEventListener("touchend",this._releaseHandler),this._parameter=b,this._velocity=c,this._friction=d,this._dynamics=new e,this._pressing=!1}var e=a("./Dynamics"),f=a("minimal-event-emitter");f(d),d.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler)},d.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},d.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1},b.exports=d},{"./Dynamics":41,"minimal-event-emitter":13}],43:[function(a,b,c){"use strict";function d(){this._managers=new i(e,f)}function e(a,b){return a===b}function f(a){for(var b=a.id||a.toString();b.length<5;)b+="0";return j(b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3),b.charCodeAt(4))}function g(a,b,c,d){this._manager=b,this._element=c,this._type=d,this._hammerGestures=a,this._eventHandlers=[]}var h=a("hammerjs"),i=a("../collections/Map"),j=a("../util/hash"),k=a("bowser");d.prototype.get=function(a,b){this._managers.has(a)||this._managers.set(a,{});var c=this._managers.get(a);c[b]||(c[b]=this._createManager(a,b));var d=c[b];return d.refs+=1,new g(this,d.manager,a,b)},d.prototype._createManager=function(a,b){var c=new h.Manager(a);return"mouse"===b?c.add(new h.Pan({direction:h.DIRECTION_ALL,threshold:0})):"touch"!==b&&"pen"!==b&&"kinect"!==b||(c.add(new h.Pan({direction:h.DIRECTION_ALL,threshold:20,pointers:1})),k.msie&&parseFloat(k.version)<10||c.add(new h.Pinch)),{manager:c,refs:0}},d.prototype._releaseHandle=function(a,b){var c=this._managers.get(a)[b];c.refs-=1,c.refs<=0&&(c.manager.destroy(),this._managers.get(a)[b]=null)},g.prototype.on=function(a,b){var c=this._type,d=function(a){c===a.pointerType&&b(a)};this._eventHandlers.push({events:a,handler:d}),this._manager.on(a,d)},g.prototype.release=function(){for(var a=0;a<this._eventHandlers.length;a++){var b=this._eventHandlers[a];this._manager.off(b.events,b.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},g.prototype.manager=function(){return this._manager},b.exports=new d},{"../collections/Map":32,"../util/hash":100,bowser:1,hammerjs:12}],44:[function(a,b,c){"use strict";function d(a,b,c,d,f){if(!a)throw new Error("KeyControlMethod: keyCode must be defined");if(!b)throw new Error("KeyControlMethod: parameter must be defined");if(!c)throw new Error("KeyControlMethod: velocity must be defined");if(!d)throw new Error("KeyControlMethod: friction must be defined");f=f||document,this._keyCode=a,this._parameter=b,this._velocity=c,this._friction=d,this._element=f,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new e,this._pressing=!1}var e=a("./Dynamics"),f=a("minimal-event-emitter");f(d),d.prototype.destroy=function(){this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler)},d.prototype._handlePress=function(a){a.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},d.prototype._handleRelease=function(a){a.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},d.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1},b.exports=d},{"./Dynamics":41,"minimal-event-emitter":13}],45:[function(a,b,c){"use strict";function d(a,b,c){this._hammer=f.get(a,b),this._lastEvent=null,this._active=!1,this._dynamics=new e,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}var e=a("./Dynamics"),f=a("./HammerGestures"),g=a("minimal-event-emitter");g(d),d.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._lastEvent=null,this._active=null,this._dynamics=null},d.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},d.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},d.prototype._handleEvent=function(a){var b=a.scale;this._lastEvent&&(b/=this._lastEvent.scale),this._dynamics.offset=-1*(b-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=a},b.exports=d},{"./Dynamics":41,"./HammerGestures":43,"minimal-event-emitter":13}],46:[function(a,b,c){"use strict";function d(a,b,c){this._element=a,this._opts=g(c||{},j),this._active=!1,this._hammer=f.get(a,b),this._dynamics={x:new e,y:new e},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}var e=a("./Dynamics"),f=a("./HammerGestures"),g=a("../util/defaults"),h=a("minimal-event-emitter"),i=a("./util").maxFriction,j={speed:8,friction:6,maxFrictionTime:.3};h(d),d.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._element=null,this._opts=null,this._active=null,this._dynamics=null},d.prototype._handleStart=function(a){a.preventDefault(),this._active||(this._active=!0,this.emit("active"))},d.prototype._handleMove=function(a){a.preventDefault(),this._updateDynamics(a,!1)},d.prototype._handleRelease=function(a){a.preventDefault(),this._updateDynamics(a,!0),this._active&&(this._active=!1,this.emit("inactive"))};var k=[null,null];d.prototype._updateDynamics=function(a,b){var c=this._element.getBoundingClientRect(),d=c.right-c.left,e=c.bottom-c.top,f=Math.max(d,e),g=a.deltaX/f*this._opts.speed,h=a.deltaY/f*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=g,this._dynamics.y.velocity=h,b&&(i(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,k),this._dynamics.x.friction=k[0],this._dynamics.y.friction=k[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)},b.exports=d},{"../util/defaults":94,"./Dynamics":41,"./HammerGestures":43,"./util":51,"minimal-event-emitter":13}],47:[function(a,b,c){"use strict";function d(a,b){this._opts=h(b||{},j),this._dynamics=new f,this._eventList=[];var c=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=new g(a,c.bind(this))}function e(a){var b=1==a.deltaMode?20:1;return a.deltaY*b}var f=a("./Dynamics"),g=a("./WheelListener"),h=a("../util/defaults"),i=a("minimal-event-emitter"),j={frictionTime:.2,zoomDelta:.001};i(d),d.prototype.destroy=function(){this._wheelListener.remove(),this._opts=null,this._dynamics=null,this._eventList=null},d.prototype.withoutSmoothing=function(a){this._dynamics.offset=e(a)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),a.preventDefault(),this.emit("active"),this.emit("inactive")},d.prototype.withSmoothing=function(a){var b=a.timeStamp;for(this._eventList.push(a);this._eventList[0].timeStamp<b-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var c=0,d=0;d<this._eventList.length;d++){var f=e(this._eventList[d])*this._opts.zoomDelta;c+=f/this._opts.frictionTime}this._dynamics.velocity=c,this._dynamics.friction=Math.abs(c)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),a.preventDefault(),this.emit("active"),this.emit("inactive")},b.exports=d},{"../util/defaults":94,"./Dynamics":41,"./WheelListener":49,"minimal-event-emitter":13}],48:[function(a,b,c){"use strict";function d(a){if(!a)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=a,this._dynamics=new e}var e=a("./Dynamics"),f=(a("../util/defaults"),a("minimal-event-emitter"));f(d),d.prototype.destroy=function(){},d.prototype.setVelocity=function(a){this._dynamics.velocity=a,this.emit("parameterDynamics",this._parameter,this._dynamics)},d.prototype.setFriction=function(a){this._dynamics.friction=a,this.emit("parameterDynamics",this._parameter,this._dynamics)},b.exports=d},{"../util/defaults":94,"./Dynamics":41,"minimal-event-emitter":13}],49:[function(a,b,c){"use strict";function d(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":null}function e(a,b,c){var e=d();if("wheel"===e)this._fun=b,this._elem=a,this._elem.addEventListener("wheel",this._fun,c);else{if("mousewheel"!==e)throw new Error("Browser does not support mouse wheel events");this._fun=f(b),this._elem=a,this._elem.addEventListener("mousewheel",this._fun,c)}}function f(a){return function(b){b||(b=window.event);var c={originalEvent:b,target:b.target||b.srcElement,type:"wheel",deltaMode:1,deltaX:0,deltaZ:0,timeStamp:b.timeStamp||Date.now(),preventDefault:b.preventDefault.bind(b)};return c.deltaY=-.025*b.wheelDelta,b.wheelDeltaX&&(c.deltaX=-.025*b.wheelDeltaX),a(c)}}e.prototype.remove=function(){var a=d();"wheel"===a?this._elem.removeEventListener("wheel",this._fun):"mousewheel"===a&&this._elem.removeEventListener("mousewheel",this._fun)},b.exports=e},{}],50:[function(a,b,c){"use strict";function d(a,b,c){c=e(c||{},k);var d={mouseViewDrag:new f(b,"mouse"),mouseViewQtvr:new g(b,"mouse"),touchView:new f(b,"touch"),pinch:new i(b,"touch"),leftArrowKey:new j(37,"x",-.7,3),rightArrowKey:new j(39,"x",.7,3),upArrowKey:new j(38,"y",-.7,3),downArrowKey:new j(40,"y",.7,3),plusKey:new j(107,"zoom",-.7,3),minusKey:new j(109,"zoom",.7,3),wKey:new j(87,"y",-.7,3),aKey:new j(65,"x",-.7,3),sKey:new j(83,"y",.7,3),dKey:new j(68,"x",.7,3),qKey:new j(81,"roll",.7,3),eKey:new j(69,"roll",-.7,3)};c.scrollZoom!==!1&&(d.scrollZoom=new h(b));var l={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]},m=["scrollZoom","touchView","pinch"];switch(c.mouseViewMode){case"drag":m.push("mouseViewDrag");break;case"qtvr":m.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+c.mouseViewMode)}for(var n in d){var o=d[n];a.registerMethod(n,o),m.indexOf(n)>=0&&a.enableMethod(n)}for(var p in l){var q=l[p];a.addMethodGroup(p,q)}return d}var e=a("../util/defaults"),f=a("./Drag"),g=a("./Qtvr"),h=a("./ScrollZoom"),i=a("./PinchZoom"),j=a("./Key"),k={mouseViewMode:"drag"};b.exports=d},{"../util/defaults":94,"./Drag":39,"./Key":44,"./PinchZoom":45,"./Qtvr":46,"./ScrollZoom":47}],51:[function(a,b,c){"use strict";function d(a,b,c,d,f){var g=Math.sqrt(Math.pow(b,2)+Math.pow(c,2));a=Math.max(a,g/d),e(b,c,a,f),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1])}function e(a,b,c,d){var e=Math.atan(b/a);d[0]=c*Math.cos(e),d[1]=c*Math.sin(e)}b.exports={maxFriction:d,changeVectorNorm:e}},{}],52:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.face=a,this.x=b,this.y=c,this.z=d,this._geometry=e,this._level=e.levelList[d]}function e(a){if(this.constructor.super_.call(this,a),this._size=a.size,this._tileSize=a.tileSize,this._size%this._tileSize!==0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function f(a){if("array"!==q(a))throw new Error("Level list must be an array");this.levelList=l(a,e),this.selectableLevelList=m(this.levelList);for(var b=1;b<this.levelList.length;b++)this.levelList[b]._validateWithParentLevel(this.levelList[b-1]);this._graphFinder=new i(d.equals,d.hash),this._neighborsCache=new j(d.equals,d.hash,64),this._vec=r.create(),this._viewParams={},this._tileVertices=[r.create(),r.create(),r.create(),r.create()]}for(var g=a("../util/inherits"),h=a("../util/hash"),i=a("../GraphFinder"),j=a("../collections/LruMap"),k=a("./Level"),l=a("./common").makeLevelList,m=a("./common").makeSelectableLevelList,n=a("../util/rotateVector"),o=a("../util/clamp"),p=a("../util/cmp"),q=a("../util/type"),r=a("gl-matrix/src/gl-matrix/vec3"),s="fudlrb",t={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},u={},v=0;v<s.length;v++){var w=s[v],x=t[w],y=r.fromValues(0,0,-1);n(y,y,x.y,x.x,0),u[w]=y}var z={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},A=[[0,1],[1,0],[0,-1],[-1,0]];d.prototype.rotX=function(){return t[this.face].x},d.prototype.rotY=function(){return t[this.face].y},d.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},d.prototype.centerY=function(){return.5-(this.y+.5)/this._level.numVerticalTiles()},d.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},d.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},d.prototype.width=function(){return this._level.tileWidth()},d.prototype.height=function(){return this._level.tileHeight()},d.prototype.levelWidth=function(){return this._level.width()},d.prototype.levelHeight=function(){return this._level.height()},d.prototype.atTopLevel=function(){return 0===this.z;
},d.prototype.atBottomLevel=function(){return this.z===this._geometry.levelList.length-1},d.prototype.atTopEdge=function(){return 0===this.y},d.prototype.atBottomEdge=function(){return this.y===this._level.numVerticalTiles()-1},d.prototype.atLeftEdge=function(){return 0===this.x},d.prototype.atRightEdge=function(){return this.x===this._level.numHorizontalTiles()-1},d.prototype.padTop=function(){return this.atTopEdge()&&/[fu]/.test(this.face)},d.prototype.padBottom=function(){return!this.atBottomEdge()||/[fd]/.test(this.face)},d.prototype.padLeft=function(){return this.atLeftEdge()&&/[flud]/.test(this.face)},d.prototype.padRight=function(){return!this.atRightEdge()||/[frud]/.test(this.face)},d.prototype.vertices=function(a){function b(a,b,d){r.set(a,b,d,-.5),n(a,a,c.y,c.x,0)}var c=t[this.face],d=this.centerX()-this.scaleX()/2,e=this.centerX()+this.scaleX()/2,f=this.centerY()-this.scaleY()/2,g=this.centerY()+this.scaleY()/2;return b(a[0],d,g),b(a[1],e,g),b(a[2],e,f),b(a[3],d,f),a},d.prototype.parent=function(){if(this.atTopLevel())return null;var a=this.face,b=this.z,c=this.x,e=this.y,f=this._geometry,g=f.levelList[b],h=f.levelList[b-1],i=Math.floor(c/g.numHorizontalTiles()*h.numHorizontalTiles()),j=Math.floor(e/g.numVerticalTiles()*h.numVerticalTiles()),k=b-1;return new d(a,i,j,k,f)},d.prototype.children=function(a){if(this.atBottomLevel())return null;var b=this.face,c=this.z,e=this.x,f=this.y,g=this._geometry,h=g.levelList[c],i=g.levelList[c+1],j=i.numHorizontalTiles()/h.numHorizontalTiles(),k=i.numVerticalTiles()/h.numVerticalTiles();a=a||[];for(var l=0;j>l;l++)for(var m=0;k>m;m++){var n=j*e+l,o=k*f+m,p=c+1;a.push(new d(b,n,o,p,g))}return a},d.prototype.neighbors=function(){var a=this._geometry,b=a._neighborsCache,c=b.get(this);if(c)return c;for(var e=a._vec,f=this.face,g=this.x,h=this.y,i=this.z,j=this._level,k=j.numHorizontalTiles(),l=j.numVerticalTiles(),m=[],p=0;p<A.length;p++){var q=A[p][0],s=A[p][1],u=g+q,v=h+s,w=i,x=f;if(0>u||u>=k||0>v||v>=l){var y=this.centerX(),B=this.centerY();0>u?(r.set(e,-.5,B,-.5),x=z[f][0]):u>=k?(r.set(e,.5,B,-.5),x=z[f][1]):0>v?(r.set(e,y,.5,-.5),x=z[f][2]):v>=l&&(r.set(e,y,-.5,-.5),x=z[f][3]);var C;C=t[f],n(e,e,C.y,C.x,0),C=t[x],n(e,e,-C.y,-C.x,0),u=o(Math.floor((.5+e[0])*k),0,k-1),v=o(Math.floor((.5-e[1])*l),0,l-1)}m.push(new d(x,u,v,w,a))}return b.set(this,m),m},d.prototype.hash=function(){return d.hash(this)},d.prototype.equals=function(a){return d.equals(this,a)},d.prototype.cmp=function(a){return d.cmp(this,a)},d.prototype.str=function(){return d.str(this)},d.hash=function(a){return null!=a?h(a.face.charCodeAt(0),a.z,a.x,a.y):0},d.equals=function(a,b){return null!=a&&null!=b&&a.face===b.face&&a.z===b.z&&a.x===b.x&&a.y===b.y},d.cmp=function(a,b){var c=s.indexOf(a.face),d=s.indexOf(b.face);return p(a.z,b.z)||p(c,d)||p(a.y,b.y)||p(a.x,b.x)},d.str=function(a){return"CubeTile("+a.face+", "+a.x+", "+a.y+", "+a.z+")"},g(e,k),e.prototype.width=function(){return this._size},e.prototype.height=function(){return this._size},e.prototype.tileWidth=function(){return this._tileSize},e.prototype.tileHeight=function(){return this._tileSize},e.prototype._validateWithParentLevel=function(a){var b=this.width(),c=this.height(),d=this.tileWidth(),e=this.tileHeight(),f=this.numHorizontalTiles(),g=this.numVerticalTiles(),h=a.width(),i=a.height(),j=a.tileWidth(),k=a.tileHeight(),l=a.numHorizontalTiles(),m=a.numVerticalTiles();if(b%h!==0)throw new Error("Level width must be multiple of parent level: "+b+" vs. "+h);if(c%i!==0)throw new Error("Level height must be multiple of parent level: "+c+" vs. "+i);if(f%l!==0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+f+" ("+b+"/"+d+") vs. "+l+" ("+h+"/"+j+")");if(g%m!==0)throw new Error("Number of vertical tiles must be multiple of parent level: "+g+" ("+c+"/"+e+") vs. "+m+" ("+i+"/"+k+")")},f.prototype.maxTileSize=function(){for(var a=0,b=0;b<this.levelList.length;b++){var c=this.levelList[b];a=Math.max(a,c.tileWidth,c.tileHeight)}return a},f.prototype.levelTiles=function(a,b){var c=this.levelList.indexOf(a),e=a.numHorizontalTiles()-1,f=a.numVerticalTiles()-1;b=b||[];for(var g=0;g<s.length;g++)for(var h=s[g],i=0;e>=i;i++)for(var j=0;f>=j;j++)b.push(new d(h,i,j,c,this));return b},f.prototype._closestTile=function(a,b){var c=this._vec,e=1/0,f=null;r.set(c,0,0,-1),n(c,c,-a.yaw,-a.pitch,-a.roll);for(var g in u){var h=u[g],i=1-r.dot(h,c);e>i&&(e=i,f=g)}for(var j=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2]))/.5,k=0;3>k;k++)c[k]=c[k]/j;var l=t[f];n(c,c,-l.y,-l.x,-l.z);var m=this.levelList.indexOf(b),p=b.numHorizontalTiles(),q=b.numVerticalTiles(),s=c[0],v=c[1],w=o(Math.floor((.5+s)*p),0,p-1),x=o(Math.floor((.5-v)*q),0,q-1);return new d(f,w,x,m,this)},f.prototype.visibleTiles=function(a,b,c){function d(a){return a.neighbors()}function e(b){return b.vertices(g),a.intersects(g)}var f=this._viewParams,g=this._tileVertices,h=this._graphFinder,i=this._closestTile(a.parameters(f),b);if(!e(i))throw new Error("Starting tile is not visible");c=c||[];var j;for(h.start(i,d,e);null!=(j=h.next());)c.push(j);return c},f.TileClass=f.prototype.TileClass=d,f.type=f.prototype.type="cube",d.type=d.prototype.type="cube",b.exports=f},{"../GraphFinder":14,"../collections/LruMap":30,"../util/clamp":88,"../util/cmp":90,"../util/hash":100,"../util/inherits":101,"../util/rotateVector":109,"../util/type":111,"./Level":55,"./common":56,"gl-matrix/src/gl-matrix/vec3":10}],53:[function(a,b,c){"use strict";function d(a,b){this.z=a,this._geometry=b,this._level=b.levelList[a]}function e(a){this.constructor.super_.call(this,a),this._width=a.width}function f(a){if("array"!==l(a))throw new Error("Level list must be an array");this.levelList=j.makeLevelList(a,e),this.selectableLevelList=j.makeSelectableLevelList(this.levelList)}var g=a("../util/inherits"),h=a("../util/hash"),i=a("../util/cmp"),j=a("./common"),k=a("./Level"),l=a("../util/type");d.prototype.rotX=function(){return 0},d.prototype.rotY=function(){return 0},d.prototype.centerX=function(){return.5},d.prototype.centerY=function(){return.5},d.prototype.scaleX=function(){return 1},d.prototype.scaleY=function(){return 1},d.prototype.width=function(){return this._level.tileWidth()},d.prototype.height=function(){return this._level.tileHeight()},d.prototype.levelWidth=function(){return this._level.width()},d.prototype.levelHeight=function(){return this._level.height()},d.prototype.atTopLevel=function(){return 0===this.z},d.prototype.atBottomLevel=function(){return this.z===this._geometry.levelList.length-1},d.prototype.atTopEdge=function(){return!0},d.prototype.atBottomEdge=function(){return!0},d.prototype.atLeftEdge=function(){return!0},d.prototype.atRightEdge=function(){return!0},d.prototype.padTop=function(){return!1},d.prototype.padBottom=function(){return!1},d.prototype.padLeft=function(){return!1},d.prototype.padRight=function(){return!1},d.prototype.parent=function(){return this.atTopLevel()?null:new d(this.z-1,this._geometry)},d.prototype.children=function(a){return this.atBottomLevel()?null:(a=a||[],a.push(new d(this.z+1,this._geometry)),a)},d.prototype.neighbors=function(){return[]},d.prototype.hash=function(){return d.hash(this)},d.prototype.equals=function(a){return d.equals(this,a)},d.prototype.cmp=function(a){return d.cmp(this,a)},d.prototype.str=function(){return d.str(this)},d.hash=function(a){return h(a.z)},d.equals=function(a,b){return a.z===b.z},d.cmp=function(a,b){return i(a.z,b.z)},d.str=function(a){return"EquirectTile("+a.z+")"},g(e,k),e.prototype.width=function(){return this._width},e.prototype.height=function(){return this._width/2},e.prototype.tileWidth=function(){return this._width},e.prototype.tileHeight=function(){return this._width/2},f.prototype.maxTileSize=function(){for(var a=0,b=0;b<this.levelList.length;b++){var c=this.levelList[b];a=Math.max(a,c.tileWidth,c.tileHeight)}return a},f.prototype.levelTiles=function(a,b){var c=this.levelList.indexOf(a);return b=b||[],b.push(new d(c,this)),b},f.prototype.visibleTiles=function(a,b,c){var e=new d(this.levelList.indexOf(b),this);c=c||[],c.length=0,c.push(e)},f.TileClass=f.prototype.TileClass=d,f.type=f.prototype.type="equirect",d.type=d.prototype.type="equirect",b.exports=f},{"../util/cmp":90,"../util/hash":100,"../util/inherits":101,"../util/type":111,"./Level":55,"./common":56}],54:[function(a,b,c){"use strict";function d(a,b,c,d){this.x=a,this.y=b,this.z=c,this._geometry=d,this._level=d.levelList[c]}function e(a){this.constructor.super_.call(this,a),this._width=a.width,this._height=a.height,this._tileWidth=a.tileWidth,this._tileHeight=a.tileHeight}function f(a){if("array"!==q(a))throw new Error("Level list must be an array");this.levelList=l(a,e),this.selectableLevelList=m(this.levelList);for(var b=1;b<this.levelList.length;b++)this.levelList[b]._validateWithParentLevel(this.levelList[b-1]);this._graphFinder=new i(d.equals,d.hash),this._neighborsCache=new j(d.equals,d.hash,64),this._viewParams={},this._tileVertices=[r.create(),r.create(),r.create(),r.create()]}var g=a("../util/inherits"),h=a("../util/hash"),i=a("../GraphFinder"),j=a("../collections/LruMap"),k=a("./Level"),l=a("./common").makeLevelList,m=a("./common").makeSelectableLevelList,n=a("../util/clamp"),o=a("../util/mod"),p=a("../util/cmp"),q=a("../util/type"),r=a("gl-matrix/src/gl-matrix/vec2"),s=[[0,1],[1,0],[0,-1],[-1,0]];d.prototype.rotX=function(){return 0},d.prototype.rotY=function(){return 0},d.prototype.centerX=function(){var a=this._level.width(),b=this._level.tileWidth();return(this.x*b+.5*this.width())/a-.5},d.prototype.centerY=function(){var a=this._level.height(),b=this._level.tileHeight();return.5-(this.y*b+.5*this.height())/a},d.prototype.scaleX=function(){var a=this._level.width();return this.width()/a},d.prototype.scaleY=function(){var a=this._level.height();return this.height()/a},d.prototype.width=function(){var a=this._level.width(),b=this._level.tileWidth();if(this.atRightEdge()){var c=o(a,b);return c||b}return b},d.prototype.height=function(){var a=this._level.height(),b=this._level.tileHeight();if(this.atBottomEdge()){var c=o(a,b);return c||b}return b},d.prototype.levelWidth=function(){return this._level.width()},d.prototype.levelHeight=function(){return this._level.height()},d.prototype.atTopLevel=function(){return 0===this.z},d.prototype.atBottomLevel=function(){return this.z===this._geometry.levelList.length-1},d.prototype.atTopEdge=function(){return 0===this.y},d.prototype.atBottomEdge=function(){return this.y===this._level.numVerticalTiles()-1},d.prototype.atLeftEdge=function(){return 0===this.x},d.prototype.atRightEdge=function(){return this.x===this._level.numHorizontalTiles()-1},d.prototype.padTop=function(){return!1},d.prototype.padBottom=function(){return!this.atBottomEdge()},d.prototype.padLeft=function(){return!1},d.prototype.padRight=function(){return!this.atRightEdge()},d.prototype.vertices=function(a){var b=this.centerX()-this.scaleX()/2,c=this.centerX()+this.scaleX()/2,d=this.centerY()-this.scaleY()/2,e=this.centerY()+this.scaleY()/2;return r.set(a[0],b,e),r.set(a[1],c,e),r.set(a[2],c,d),r.set(a[3],b,d),a},d.prototype.parent=function(){if(this.atTopLevel())return null;var a=this._geometry,b=this.z-1,c=Math.floor(this.x/2),e=Math.floor(this.y/2);return new d(c,e,b,a)},d.prototype.children=function(a){if(this.atBottomLevel())return null;var b=this._geometry,c=this.z+1;return a=a||[],a.push(new d(2*this.x,2*this.y,c,b)),a.push(new d(2*this.x,2*this.y+1,c,b)),a.push(new d(2*this.x+1,2*this.y,c,b)),a.push(new d(2*this.x+1,2*this.y+1,c,b)),a},d.prototype.neighbors=function(){var a=this._geometry,b=a._neighborsCache,c=b.get(this);if(c)return c;for(var e=this.x,f=this.y,g=this.z,h=this._level,i=h.numHorizontalTiles()-1,j=h.numVerticalTiles()-1,k=[],l=0;l<s.length;l++){var m=s[l][0],n=s[l][1],o=e+m,p=f+n,q=g;o>=0&&i>=o&&p>=0&&j>=p&&k.push(new d(o,p,q,a))}return b.set(this,k),k},d.prototype.hash=function(){return d.hash(this)},d.prototype.equals=function(a){return d.equals(this,a)},d.prototype.cmp=function(a){return d.cmp(this,a)},d.prototype.str=function(){return d.str(this)},d.hash=function(a){return null!=a?h(a.z,a.x,a.y):0},d.equals=function(a,b){return null!=a&&null!=b&&a.z===b.z&&a.x===b.x&&a.y===b.y},d.cmp=function(a,b){return p(a.z,b.z)||p(a.y,b.y)||p(a.x,b.x)},d.str=function(a){return"FlatTile("+a.x+", "+a.y+", "+a.z+")"},g(e,k),e.prototype.width=function(){return this._width},e.prototype.height=function(){return this._height},e.prototype.tileWidth=function(){return this._tileWidth},e.prototype.tileHeight=function(){return this._tileHeight},e.prototype._validateWithParentLevel=function(a){var b=this.width(),c=this.height(),d=this.tileWidth(),e=this.tileHeight(),f=a.width(),g=a.height(),h=a.tileWidth(),i=a.tileHeight();return b%f!==0?new Error("Level width must be multiple of parent level: "+b+" vs. "+f):c%g!==0?new Error("Level height must be multiple of parent level: "+c+" vs. "+g):d%h!==0?new Error("Level tile width must be multiple of parent level: "+d+" vs. "+h):e%i!==0?new Error("Level tile height must be multiple of parent level: "+e+" vs. "+i):void 0},f.prototype.maxTileSize=function(){for(var a=0,b=0;b<this.levelList.length;b++){var c=this.levelList[b];a=Math.max(a,c.tileWidth,c.tileHeight)}return a},f.prototype.levelTiles=function(a,b){var c=this.levelList.indexOf(a),e=a.numHorizontalTiles()-1,f=a.numVerticalTiles()-1;b||(b=[]);for(var g=0;e>=g;g++)for(var h=0;f>=h;h++)b.push(new d(g,h,c,this));return b},f.prototype._closestTile=function(a,b){var c=a.x,e=a.y,f=this.levelList.indexOf(b),g=b.width(),h=b.height(),i=b.tileWidth(),j=b.tileHeight(),k=b.numHorizontalTiles(),l=b.numVerticalTiles(),m=n(Math.floor(c*g/i),0,k-1),o=n(Math.floor(e*h/j),0,l-1);return new d(m,o,f,this)},f.prototype.visibleTiles=function(a,b,c){function d(a){return a.neighbors()}function e(b){return b.vertices(g),a.intersects(g)}var f=this._viewParams,g=this._tileVertices,h=this._graphFinder,i=this._closestTile(a.parameters(f),b);if(!e(i))throw new Error("Starting tile is not visible");c=c||[];var j;for(h.start(i,d,e);null!=(j=h.next());)c.push(j);return c},f.TileClass=f.prototype.TileClass=d,f.type=f.prototype.type="flat",d.type=d.prototype.type="flat",b.exports=f},{"../GraphFinder":14,"../collections/LruMap":30,"../util/clamp":88,"../util/cmp":90,"../util/hash":100,"../util/inherits":101,"../util/mod":102,"../util/type":111,"./Level":55,"./common":56,"gl-matrix/src/gl-matrix/vec2":9}],55:[function(a,b,c){"use strict";function d(a){this._fallbackOnly=!!a.fallbackOnly}d.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},d.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},d.prototype.fallbackOnly=function(){return this._fallbackOnly},b.exports=d},{}],56:[function(a,b,c){"use strict";function d(a,b){for(var c=[],d=0;d<a.length;d++)c.push(new b(a[d]));return c.sort(function(a,b){return f(a.width(),b.width())}),c}function e(a){for(var b=[],c=0;c<a.length;c++)a[c]._fallbackOnly||b.push(a[c]);if(!b.length)throw new Error("No selectable levels in list");return b}var f=a("../util/cmp");b.exports={makeLevelList:d,makeSelectableLevelList:e}},{"../util/cmp":90}],57:[function(a,b,c){b.exports={WebGlStage:a("./stages/WebGl"),CssStage:a("./stages/Css"),FlashStage:a("./stages/Flash"),WebGlCubeRenderer:a("./renderers/WebGlCube"),WebGlFlatRenderer:a("./renderers/WebGlFlat"),WebGlEquirectRenderer:a("./renderers/WebGlEquirect"),CssCubeRenderer:a("./renderers/CssCube"),CssFlatRenderer:a("./renderers/CssFlat"),FlashCubeRenderer:a("./renderers/FlashCube"),FlashFlatRenderer:a("./renderers/FlashFlat"),registerDefaultRenderers:a("./renderers/registerDefaultRenderers"),CubeGeometry:a("./geometries/Cube"),FlatGeometry:a("./geometries/Flat"),EquirectGeometry:a("./geometries/Equirect"),RectilinearView:a("./views/Rectilinear"),FlatView:a("./views/Flat"),ImageUrlSource:a("./sources/ImageUrl"),SingleAssetSource:a("./sources/SingleAsset"),DynamicCanvasAsset:a("./assets/DynamicCanvas"),StaticCanvasAsset:a("./assets/StaticCanvas"),TextureStore:a("./TextureStore"),Layer:a("./Layer"),RenderLoop:a("./RenderLoop"),KeyControlMethod:a("./controls/Key"),DragControlMethod:a("./controls/Drag"),QtvrControlMethod:a("./controls/Qtvr"),ScrollZoomControlMethod:a("./controls/ScrollZoom"),PinchZoomControlMethod:a("./controls/PinchZoom"),VelocityControlMethod:a("./controls/Velocity"),ElementPressControlMethod:a("./controls/ElementPress"),Controls:a("./controls/Controls"),Dynamics:a("./controls/Dynamics"),Viewer:a("./Viewer"),Scene:a("./Scene"),Hotspot:a("./Hotspot"),HotspotContainer:a("./HotspotContainer"),colorEffects:a("./colorEffects"),supported:a("./supported"),registerDefaultControls:a("./controls/registerDefaultControls"),autorotate:a("./autorotate"),util:{async:a("./util/async"),cancelize:a("./util/cancelize"),chain:a("./util/chain"),clamp:a("./util/clamp"),clock:a("./util/clock"),cmp:a("./util/cmp"),compose:a("./util/compose"),convertFov:a("./util/convertFov"),decimal:a("./util/decimal"),defaults:a("./util/defaults"),defer:a("./util/defer"),degToRad:a("./util/degToRad"),delay:a("./util/delay"),dom:a("./util/dom"),extend:a("./util/extend"),hash:a("./util/hash"),inherits:a("./util/inherits"),mod:a("./util/mod"),noop:a("./util/noop"),once:a("./util/once"),pixelRatio:a("./util/pixelRatio"),radToDeg:a("./util/radToDeg"),real:a("./util/real"),retry:a("./util/retry"),tween:a("./util/tween"),type:a("./util/type")},version:a("../tmp/version"),dependencies:{bowser:a("bowser"),glMatrix:a("gl-matrix"),eventEmitter:a("minimal-event-emitter"),hammerjs:a("hammerjs")}}},{"../tmp/version":115,"./Hotspot":15,"./HotspotContainer":16,"./Layer":17,"./RenderLoop":19,"./Scene":20,"./TextureStore":21,"./Viewer":23,"./assets/DynamicCanvas":24,"./assets/StaticCanvas":26,"./autorotate":28,"./colorEffects":36,"./controls/Controls":38,"./controls/Drag":39,"./controls/Dynamics":41,"./controls/ElementPress":42,"./controls/Key":44,"./controls/PinchZoom":45,"./controls/Qtvr":46,"./controls/ScrollZoom":47,"./controls/Velocity":48,"./controls/registerDefaultControls":50,"./geometries/Cube":52,"./geometries/Equirect":53,"./geometries/Flat":54,"./renderers/CssCube":60,"./renderers/CssFlat":61,"./renderers/FlashCube":63,"./renderers/FlashFlat":64,"./renderers/WebGlCube":67,"./renderers/WebGlEquirect":68,"./renderers/WebGlFlat":69,"./renderers/registerDefaultRenderers":70,"./sources/ImageUrl":71,"./sources/SingleAsset":72,"./stages/Css":73,"./stages/Flash":74,"./stages/WebGl":77,"./supported":84,"./util/async":85,"./util/cancelize":86,"./util/chain":87,"./util/clamp":88,"./util/clock":89,"./util/cmp":90,"./util/compose":91,"./util/convertFov":92,"./util/decimal":93,"./util/defaults":94,"./util/defer":95,"./util/degToRad":96,"./util/delay":97,"./util/dom":98,"./util/extend":99,"./util/hash":100,"./util/inherits":101,"./util/mod":102,"./util/noop":103,"./util/once":104,"./util/pixelRatio":105,"./util/radToDeg":106,"./util/real":107,"./util/retry":108,"./util/tween":110,"./util/type":111,"./views/Flat":112,"./views/Rectilinear":113,bowser:1,"gl-matrix":2,hammerjs:12,"minimal-event-emitter":13}],58:[function(a,b,c){"use strict";function d(a,b,c){if(e()){var d="translateX("+h(b)+"px) translateY("+h(c)+"px) translateZ(0)";f(a,d)}else g(a,b,c)}var e=a("./support/Css"),f=a("./util/dom").setTransform,g=a("./util/dom").setPixelPosition,h=a("./util/decimal");b.exports=d},{"./support/Css":80,"./util/decimal":93,"./util/dom":98}],59:[function(a,b,c){"use strict";function d(a,b){return a.cmp(b)}function e(a,b,c){this._root=a,this._browserQuirks=b;var d=document.createElement("div");a.appendChild(d),d.style.position="absolute",g(d),h(d),this._browserQuirks.useNullTransform&&i(d),this.domElement=d,this._oldTileList=[],this._newTileList=[],this._textureMap=new f(c.equals,c.hash)}var f=a("../collections/Map"),g=a("../util/dom").setOverflowHidden,h=a("../util/dom").setNoPointerEvents,i=a("../util/dom").setNullTransform,j=a("../util/dom").setTransform,k="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.css;e.prototype.destroy=function(){this._root.removeChild(this.domElement),this._textureMap=null,this.domElement=null},e.prototype.startLayer=function(a,b){var c=this.domElement;c.style.left=b.left+"px",c.style.top=b.top+"px",c.style.width=b.width+"px",c.style.height=b.height+"px";var d=1,e=a.effects();e&&null!=e.opacity&&(d=e.opacity),c.style.opacity=d,this._newTileList.length=0,this._textureMap.clear()},e.prototype.renderTile=function(a,b){this._newTileList.push(a),this._textureMap.set(a,b)},e.prototype.endLayer=function(a){var b,c,e,f,g,h,i,l,m=this.domElement,n=this._oldTileList,o=this._newTileList,p=this._textureMap,q=a.view();if(m.children.length!==n.length)throw new Error("DOM not in sync with tile list");for(o.sort(d),b=0,e=n[b],i=m.firstChild,c=0;c<o.length;c++){for(f=o[c];b<n.length&&!(e.cmp(f)>=0);)l=i.nextSibling,m.removeChild(i),i=l,e=n[++b];if(g=p.get(f),h=g?g._canvas:null,!h)throw new Error("Rendering tile with missing texture");if(e&&0===e.cmp(f)){if(h!=i)throw new Error("DOM not in sync with tile list");i=i.nextSibling,e=n[++b]}else m.insertBefore(h,i);j(h,this.calculateTransform(f,g,q)),k&&h.setAttribute("data-tile",f.str())}for(;i;)l=i.nextSibling,m.removeChild(i),i=l;if(m.children.length!==o.length)throw new Error("DOM not in sync with tile list");var r=this._oldTileList;this._oldTileList=this._newTileList,this._newTileList=r},b.exports=e},{"../collections/Map":32,"../util/dom":98}],60:[function(a,b,c){"use strict";function d(a,b){this.constructor.super_.call(this,a,b,e)}var e=a("../geometries/Cube").TileClass,f=a("./CssBase"),g=a("../util/decimal"),h=a("../util/inherits");h(d,f),d.prototype.calculateTransform=function(a,b,c){var d=this._browserQuirks.padSize,e=this._browserQuirks.reverseLevelDepth,f=this._browserQuirks.perspectiveNudge,h="",i=e?256-a.z:a.levelWidth(),j=c.size(),k=j.width,l=j.height;h+="translate3d("+g(k/2)+"px, "+g(l/2)+"px, 0px) ";var m=.5*l/Math.tan(c.fov()/2),n=m+f;h+="perspective("+g(m)+"px) translateZ("+g(n)+"px) ";var o=-c.roll(),p=-c.pitch(),q=c.yaw();h+="rotateZ("+g(o)+"rad) rotateX("+g(p)+"rad) rotateY("+g(q)+"rad) ";var r=-a.rotX(),s=a.rotY();h+="rotateX("+g(r)+"rad) rotateY("+g(s)+"rad) ";var t=a.centerX()-a.scaleX()/2,u=-(a.centerY()+a.scaleY()/2),v=t*i,w=u*i,x=-i/2;if(h+="translate3d("+g(v)+"px, "+g(w)+"px, "+g(x)+"px) ",e){var y=i*a.scaleX()/a.width(),z=i*a.scaleY()/a.height();h+="scale("+g(y)+", "+g(z)+") "}var A=a.padLeft()?d:0,B=a.padTop()?d:0;return 0===A&&0===B||(h+="translate3d("+g(-A)+"px, "+g(-B)+"px, 0) "),h},b.exports=d},{"../geometries/Cube":52,"../util/decimal":93,"../util/inherits":101,"./CssBase":59}],61:[function(a,b,c){"use strict";function d(a,b){this.constructor.super_.call(this,a,b,e)}var e=a("../geometries/Flat").TileClass,f=a("./CssBase"),g=a("../util/decimal"),h=a("../util/inherits");h(d,f),d.prototype.calculateTransform=function(a,b,c){var d=this._browserQuirks.padSize,e="",f=c.width(),h=c.height();e+="translateX("+g(f/2)+"px) translateY("+g(h/2)+"px) ";var i=f/c._zoomX(),j=h/c._zoomY(),k=a.centerX()-a.scaleX()/2+.5,l=.5-a.centerY()-a.scaleY()/2,m=k*i,n=l*j;e+="translateX("+g(m)+"px) translateY("+g(n)+"px) ";var o=-c.x()*i,p=-c.y()*j;e+="translateX("+g(o)+"px) translateY("+g(p)+"px) ";var q=a.padLeft()?d:0,r=a.padTop()?d:0;0===q&&0===r||(e+="translateX("+g(-q)+"px) translateY("+g(-r)+"px) ");var s=i/a.levelWidth(),t=j/a.levelHeight();return e+="scale("+g(s)+", "+g(t)+") "},b.exports=d},{"../geometries/Flat":54,"../util/decimal":93,"../util/inherits":101,"./CssBase":59}],62:[function(a,b,c){"use strict";function d(a,b){return a.cmp(b)}function e(a,b,c,d){this._flashElement=a,this._layerId=b,this._quirks=c,this._tileList=[],this._textureMap=new f(d.equals,d.hash),this._layerCreated=!1}var f=a("../collections/Map");e.prototype.destroy=function(){this._flashElement.destroyLayer(this._layerId),this._flashElement=null,this._layerId=null,this._layerCreated=null,this._tileList=null,this._padSize=null},e.prototype.startLayer=function(a,b){this._flashElement.isReady&&(this._layerCreated||(this._flashElement.createLayer(this._layerId),this._layerCreated=!0),this._tileList.length=0,this._textureMap.clear())},e.prototype.renderTile=function(a,b){this._tileList.push(a),this._textureMap.set(a,b)},e.prototype.endLayer=function(a,b){if(this._flashElement.isReady){var c=this._tileList;c.sort(d),this._renderOnFlash(a,b)}},b.exports=e},{"../collections/Map":32}],63:[function(a,b,c){"use strict";function d(a,b,c){this.constructor.super_.call(this,a,b,c,f),this._flashTileList=[]}var e=a("./FlashBase"),f=a("../geometries/Cube").TileClass,g=a("../util/inherits"),h=a("../util/radToDeg");g(d,e),d.prototype._renderOnFlash=function(a,b){var c=this._flashElement,d=this._layerId,e=this._quirks.padSize,f=this._tileList,g=this._textureMap,i=this._flashTileList;i.length=0;for(var j=0;j<f.length;j++){var k=f[j],l=g.get(k);if(!l)throw new Error("Rendering tile with missing texture");var m=k.padTop()?e:0,n=k.padBottom()?e:0,o=k.padLeft()?e:0,p=k.padRight()?e:0;i.push({textureId:l._textureId,face:k.face,width:k.width(),height:k.height(),centerX:k.centerX(),centerY:k.centerY(),rotX:h(k.rotX()),rotY:h(k.rotY()),levelSize:k.levelWidth(),padTop:m,padBottom:n,padLeft:o,padRight:p})}var q=1,r=a.effects();r&&null!=r.opacity&&(q=r.opacity);var s=a.view(),t=s.yaw(),u=s.pitch(),v=s.roll(),w=s.fov();c.drawCubeTiles(d,b.width,b.height,b.left,b.top,q,t,u,v,w,i)},b.exports=d},{"../geometries/Cube":52,"../util/inherits":101,"../util/radToDeg":106,"./FlashBase":62}],64:[function(a,b,c){"use strict";function d(a,b,c){this.constructor.super_.call(this,a,b,c,f),this._flashTileList=[]}var e=a("./FlashBase"),f=a("../geometries/Flat").TileClass,g=a("../util/inherits");g(d,e),d.prototype._renderOnFlash=function(a,b){var c=this._flashElement,d=this._layerId,e=this._quirks.padSize,f=this._tileList,g=this._textureMap,h=this._flashTileList;h.length=0;for(var i=0;i<f.length;i++){var j=f[i],k=g.get(j);if(!k)throw new Error("Rendering tile with missing texture");var l=j.padTop()?e:0,m=j.padBottom()?e:0,n=j.padLeft()?e:0,o=j.padRight()?e:0;h.push({textureId:k._textureId,width:j.width(),height:j.height(),centerX:j.centerX(),centerY:j.centerY(),scaleX:j.scaleX(),scaleY:j.scaleY(),levelWidth:j.levelWidth(),levelHeight:j.levelHeight(),padTop:l,padBottom:m,padLeft:n,padRight:o})}var p=1,q=a.effects();q&&null!=q.opacity&&(p=q.opacity);var r=a.view(),s=r.x(),t=r.y(),u=r._zoomX(),v=r._zoomY();c.drawFlatTiles(d,b.width,b.height,b.left,b.top,p,s,t,u,v,h)},b.exports=d},{"../geometries/Flat":54,"../util/inherits":101,"./FlashBase":62}],65:[function(a,b,c){"use strict";function d(a){this.gl=a,this.vtMatrix=u.create(),this.vccMatrix=u.create(),this.translateVector=v.create(),this.scaleVector=v.create(),this.constantBuffers=f(this.gl,p,q,r),this.shaderProgram=h(this.gl,n,o,s,t)}var e=a("./WebGlCommon"),f=e.createConstantBuffers,g=e.destroyConstantBuffers,h=e.createShaderProgram,i=e.destroyShaderProgram,j=e.setViewport,k=e.setupPixelEffectUniforms,l=e.setDepth,m=e.setTexture,n='#define GLSLIFY 1\n/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\nuniform float uDepth;\nuniform mat4 vtMatrix;\nuniform mat4 vccMatrix;\n\nvoid main(void) {\n  gl_Position = vccMatrix * vtMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);\n  gl_Position.z = uDepth * gl_Position.w;\n  vTextureCoord = aTextureCoord;\n}\n',o='/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float uOpacity;\nuniform vec4 colorOffset;\nuniform mat4 colorMatrix;\n\nvoid main(void) {\n  vec4 color = texture2D(uSampler, vTextureCoord);\n  color = color * colorMatrix + colorOffset;\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}\n',p=[0,1,2,0,2,3],q=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],r=[0,0,1,0,1,1,0,1],s=["aVertexPosition","aTextureCoord"],t=["vtMatrix","vccMatrix","uDepth","uSampler","uOpacity","colorOffset","colorMatrix"],u=a("gl-matrix/src/gl-matrix/mat4"),v=a("gl-matrix/src/gl-matrix/vec3");d.prototype.destroy=function(){this.vtMatrix=null,this.vccMatrix=null,this.translateVector=null,this.scaleVector=null,g(this.gl,this.constantBuffers),this.constantBuffers=null,i(this.gl,this.shaderProgram),this.shaderProgram=null,this.gl=null},d.prototype.startLayer=function(a,b){var c=this.gl,d=this.shaderProgram,e=this.constantBuffers;c.useProgram(d),j(c,a,b,this.vccMatrix),c.uniformMatrix4fv(d.vccMatrix,!1,this.vccMatrix),c.bindBuffer(c.ARRAY_BUFFER,e.vertexPositions),c.vertexAttribPointer(d.aVertexPosition,3,c.FLOAT,c.FALSE,0,0),c.bindBuffer(c.ARRAY_BUFFER,e.textureCoords),c.vertexAttribPointer(d.aTextureCoord,2,c.FLOAT,c.FALSE,0,0),k(c,a.effects(),{opacity:d.uOpacity,colorOffset:d.colorOffset,colorMatrix:d.colorMatrix})},d.prototype.endLayer=function(){},d.prototype.renderTile=function(a,b,c,d){var e=this.gl,f=this.shaderProgram,g=this.constantBuffers,h=this.vtMatrix,i=this.translateVector,j=this.scaleVector;i[0]=a.centerX(),i[1]=a.centerY(),i[2]=-.5,j[0]=a.scaleX(),j[1]=a.scaleY(),j[2]=1,u.copy(h,c.view().projection()),u.rotateX(h,h,a.rotX()),u.rotateY(h,h,a.rotY()),u.translate(h,h,i),u.scale(h,h,j),e.uniformMatrix4fv(f.vtMatrix,!1,h),l(e,f,d,a.z),m(e,f,b),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,g.vertexIndices),e.drawElements(e.TRIANGLES,p.length,e.UNSIGNED_SHORT,0)},b.exports=d},{"./WebGlCommon":66,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec3":10}],66:[function(a,b,c){"use strict";function d(a,b,c){var d=a.createShader(b);if(a.shaderSource(d,c),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw a.getShaderInfoLog(d);return d}function e(a,b,c,e,f){var g=d(a,a.VERTEX_SHADER,b),h=d(a,a.FRAGMENT_SHADER,c),i=a.createProgram();if(a.attachShader(i,g),a.attachShader(i,h),a.linkProgram(i),!a.getProgramParameter(i,a.LINK_STATUS))throw a.getProgramInfoLog(i);for(var j=0;j<e.length;j++){var k=e[j];i[k]=a.getAttribLocation(i,k),a.enableVertexAttribArray(i[k])}for(var l=0;l<f.length;l++){var m=f[l];i[m]=a.getUniformLocation(i,m)}return i}function f(a,b){for(var c=a.getAttachedShaders(b),d=0;d<c.length;d++){var e=c[d];a.detachShader(b,e),a.deleteShader(e)}a.deleteProgram(b)}function g(a,b,c,d){var e=a.createBuffer();return a.bindBuffer(b,e),a.bufferData(b,d,c),e}function h(a,b,c,d){return{vertexIndices:g(a,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW,new Uint16Array(b)),vertexPositions:g(a,a.ARRAY_BUFFER,a.STATIC_DRAW,new Float32Array(c)),textureCoords:g(a,a.ARRAY_BUFFER,a.STATIC_DRAW,new Float32Array(d))}}function i(a,b){a.deleteBuffer(b.vertexIndices),a.deleteBuffer(b.vertexPositions),a.deleteBuffer(b.textureCoords)}function j(a,b,c){a.activeTexture(a.TEXTURE0),
a.bindTexture(a.TEXTURE_2D,c._texture),a.uniform1i(b.uSampler,0)}function k(a,b,c,d){var e=((c+1)*p-d)/(p*o);a.uniform1f(b.uDepth,e)}function l(a,b,c){var d=v;b&&null!=b.opacity&&(d=b.opacity),a.uniform1f(c.opacity,d);var e=w;b&&b.colorOffset&&(e=b.colorOffset),a.uniform4fv(c.colorOffset,e);var f=x;b&&b.colorMatrix&&(f=b.colorMatrix),a.uniformMatrix4fv(c.colorMatrix,!1,f)}function m(a,b,c,d){var e=q();n(c,y,d),a.viewport(e*y.offsetX,e*y.offsetY,e*y.width,e*y.height)}function n(a,b,c){var d=a.left,e=a.totalWidth,f=r(d,0,e),g=a.width-(f-d),h=e-f,i=r(g,0,h);b.offsetX=f,b.width=i;var j=a.totalHeight-a.bottom,k=a.totalHeight,l=r(j,0,k),m=a.height-(l-j),n=k-l,o=r(m,0,n);b.offsetY=l,b.height=o,A[0]=a.width/i,A[1]=a.height/o,A[2]=1;var p=f-d,q=d+a.width,s=f+i,t=q-s,v=l-j,w=j+a.height,x=l+o,y=w-x;z[0]=(t-p)/i,z[1]=(y-v)/o,z[2]=0;var B=c;u.identity(B),u.translate(B,B,z),u.scale(B,B,A)}var o=256,p=256,q=a("../util/pixelRatio"),r=a("../util/clamp"),s=a("gl-matrix/src/gl-matrix/vec4"),t=a("gl-matrix/src/gl-matrix/vec3"),u=a("gl-matrix/src/gl-matrix/mat4"),v=1,w=s.create(),x=u.create();u.identity(x);var y={},z=t.create(),A=t.create();b.exports={createShaderProgram:e,destroyShaderProgram:f,createConstantBuffers:h,destroyConstantBuffers:i,setTexture:j,setDepth:k,setViewport:m,setupPixelEffectUniforms:l}},{"../util/clamp":88,"../util/pixelRatio":105,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec3":10,"gl-matrix/src/gl-matrix/vec4":11}],67:[function(a,b,c){"use strict";var d=a("./WebGlBase");b.exports=d},{"./WebGlBase":65}],68:[function(a,b,c){"use strict";function d(a){this.gl=a,this.pMatrix=u.create(),this.vccMatrix=u.create(),this.constantBuffers=f(this.gl,p,q,r),this.shaderProgram=g(this.gl,n,o,s,t)}var e=a("./WebGlCommon"),f=e.createConstantBuffers,g=e.createShaderProgram,h=e.setViewport,i=e.destroyConstantBuffers,j=e.destroyShaderProgram,k=e.setupPixelEffectUniforms,l=e.setDepth,m=e.setTexture,n='#define GLSLIFY 1\n/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\nuniform float uDepth;\nuniform mat4 vccMatrix;\n\nvoid main(void) {\n  gl_Position = vccMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);\n  vTextureCoord = aTextureCoord;\n}\n',o='/*\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform sampler2D uSampler;\nuniform mat4 uPInvMatrix;\nuniform float uWidth;\nuniform float uHeight;\nuniform float uOpacity;\nvarying vec2 vTextureCoord;\nuniform vec4 colorOffset;\nuniform mat4 colorMatrix;\n\nuniform float textureX;\nuniform float textureY;\nuniform float textureWidth;\nuniform float textureHeight;\n\nconst float PI = 3.14159265358979323846264;\n\nvoid main(void) {\n  float x = 2.0 * vTextureCoord.x - 1.0;\n  float y = 2.0 * vTextureCoord.y - 1.0;\n  vec4 pos = uPInvMatrix * vec4(x, y, 1.0, 1.0);\n  float r = inversesqrt(pos.x * pos.x + pos.y * pos.y + pos.z * pos.z);\n  float phi  = acos(pos.y * r);\n  float theta = atan(pos.x, -1.0*pos.z);\n  float s = 0.5 + 0.5 * theta / PI;\n  float t = 1.0 - phi / PI;\n\n  s = s * textureWidth + textureX;\n  t = t * textureHeight + textureY;\n\n  vec4 color = texture2D(uSampler, vec2(s, t));\n  color = color * colorMatrix + colorOffset;\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}\n',p=[0,1,2,0,2,3],q=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],r=[0,0,1,0,1,1,0,1],s=["aVertexPosition","aTextureCoord"],t=["uPInvMatrix","uDepth","vccMatrix","uSampler","uOpacity","uWidth","uHeight","colorOffset","colorMatrix","textureX","textureY","textureWidth","textureHeight"],u=a("gl-matrix/src/gl-matrix/mat4");d.prototype.destroy=function(){this.pMatrix=null,i(this.gl,this.constantBuffers),this.constantBuffers=null,j(this.gl,this.shaderProgram),this.shaderProgram=null,this.gl=null},d.prototype.startLayer=function(a,b){var c=this.gl,d=this.shaderProgram,e=this.constantBuffers,f=this.pMatrix;c.useProgram(this.shaderProgram),h(c,a,b,this.vccMatrix),c.uniformMatrix4fv(d.vccMatrix,!1,this.vccMatrix),c.bindBuffer(c.ARRAY_BUFFER,e.vertexPositions),c.vertexAttribPointer(d.aVertexPosition,3,c.FLOAT,c.FALSE,0,0),c.bindBuffer(c.ARRAY_BUFFER,e.textureCoords),c.vertexAttribPointer(d.aTextureCoord,2,c.FLOAT,c.FALSE,0,0),u.copy(this.pMatrix,a.view().projection()),u.invert(f,f),c.uniformMatrix4fv(d.uPInvMatrix,!1,f),this.gl.uniform1f(this.shaderProgram.uWidth,b.width),this.gl.uniform1f(this.shaderProgram.uHeight,b.height);var g=a.effects().textureCrop||{},i=null!=g.x?g.x:0,j=null!=g.y?g.y:0,l=null!=g.width?g.width:1,m=null!=g.height?g.height:1;this.gl.uniform1f(this.shaderProgram.textureX,i),this.gl.uniform1f(this.shaderProgram.textureY,j),this.gl.uniform1f(this.shaderProgram.textureWidth,l),this.gl.uniform1f(this.shaderProgram.textureHeight,m),k(c,a.effects(),{opacity:d.uOpacity,colorOffset:d.colorOffset,colorMatrix:d.colorMatrix})},d.prototype.endLayer=function(){},d.prototype.renderTile=function(a,b,c,d){var e=this.gl,f=this.shaderProgram,g=this.constantBuffers;l(e,f,d,a.z),m(e,f,b),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,g.vertexIndices),e.drawElements(e.TRIANGLES,p.length,e.UNSIGNED_SHORT,0)},b.exports=d},{"./WebGlCommon":66,"gl-matrix/src/gl-matrix/mat4":7}],69:[function(a,b,c){arguments[4][67][0].apply(c,arguments)},{"./WebGlBase":65,dup:67}],70:[function(a,b,c){"use strict";function d(a){switch(a.type){case"webgl":a.registerRenderer("flat","flat",f),a.registerRenderer("cube","rectilinear",e),a.registerRenderer("equirect","rectilinear",g);break;case"css":a.registerRenderer("flat","flat",i),a.registerRenderer("cube","rectilinear",h);break;case"flash":a.registerRenderer("flat","flat",k),a.registerRenderer("cube","rectilinear",j);break;default:throw new Error("Unknown stage type: "+a.type)}}var e=a("./WebGlCube"),f=a("./WebGlFlat"),g=a("./WebGlEquirect"),h=a("./CssCube"),i=a("./CssFlat"),j=a("./FlashCube"),k=a("./FlashFlat");b.exports=d},{"./CssCube":60,"./CssFlat":61,"./FlashCube":63,"./FlashFlat":64,"./WebGlCube":67,"./WebGlEquirect":68,"./WebGlFlat":69}],71:[function(a,b,c){"use strict";function d(a,b){b=b?b:{},this._loadPool=new g({concurrency:b.concurrency||m}),this._retryDelay=b.retryDelay||n,this._retryMap={},this._sourceFromTile=a}function e(a){var b="\\{("+a+")\\}";return new RegExp(b,"g")}var f=a("../NetworkError"),g=a("../collections/WorkPool"),h=a("../util/chain"),i=a("../util/delay"),j=a("../util/clock"),k={x:"x",y:"y",z:"z",f:"face"},l="bdflru",m=4,n=1e4;d.prototype.loadAsset=function(a,b,c){var d,e=this,g=this._retryDelay,k=this._retryMap,l=this._sourceFromTile(b),m=l.url,n=l.rect,o=a.loadImage.bind(a,m,n),p=function(a){return e._loadPool.push(o,function(c,d){c?(c instanceof f&&(k[m]=j()),a(c,b)):(delete k[m],a(null,b,d))})},q=k[m];if(null!=q){var r=j(),s=r-q;g>s?d=g-s:(d=0,delete k[m])}var t=i.bind(null,d);return h(t,p)(c)},d.fromString=function(a,b){function c(b){var c=a;for(var d in k){var f=e(d),g=b[k[d]];c=c.replace(f,g)}return{url:c}}function f(a){return 0===a.z?g(a):c(a)}function g(a){var c=h.indexOf(a.face)/6;return{url:b.cubeMapPreviewUrl,rect:{x:0,y:c,width:1,height:1/6}}}b=b||{};var h=b&&b.cubeMapPreviewFaceOrder||l,i=b.cubeMapPreviewUrl?f:c;return new d(i)},d.stringHasFace=function(a){return d.stringHasProperty(a,"f")},d.stringHasX=function(a){return d.stringHasProperty(a,"x")},d.stringHasY=function(a){return d.stringHasProperty(a,"y")},d.stringHasLevel=function(a){return d.stringHasProperty(a,"z")},d.stringHasProperty=function(a,b){return!!a.match(e(b))},b.exports=d},{"../NetworkError":18,"../collections/WorkPool":34,"../util/chain":87,"../util/clock":89,"../util/delay":97}],72:[function(a,b,c){"use strict";function d(a){this._asset=a}d.prototype.asset=function(){return this._asset},d.prototype.loadAsset=function(a,b,c){function d(){clearTimeout(f),c.apply(null,arguments)}var e=this,f=setTimeout(function(){c(null,b,e._asset)},0);return d},b.exports=d},{}],73:[function(a,b,c){"use strict";function d(a){this.constructor.super_.call(this,a),this._domElement=document.createElement("div"),k(this._domElement),m(this._domElement)}function e(a,b,c){var d=document.createElement("canvas");k(d),n(d),this._canvas=d,this._timestamp=null,this.refresh(b,c)}var f=a("./Stage"),g=a("../support/Css"),h=a("bowser"),i=a("../util/inherits"),j=a("./loadImageHtml"),k=a("../util/dom").setAbsolute,l=a("../util/dom").setPixelSize,m=a("../util/dom").setFullSize,n=a("../util/dom").setNullTransformOrigin,o={padSize:h.ios?0:3,reverseLevelDepth:h.ios,useNullTransform:h.ios,perspectiveNudge:h.webkit||h.gecko?.001:0};i(d,f),d.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null},d.supported=function(){return g()},d.prototype._updateSize=function(){var a=this._domElement,b=this._width,c=this._height;l(a,b,c)},d.prototype.loadImage=j,d.prototype._validateLayer=function(a){},d.prototype.createRenderer=function(a){return new a(this._domElement,o)},d.prototype.destroyRenderer=function(a){a.destroy()},d.prototype.startFrame=function(){},d.prototype.endFrame=function(){},d.type=d.prototype.type="css",e.prototype.refresh=function(a,b){var c=b.timestamp();if(c!==this._timestamp){this._timestamp=c;var d=this._canvas,e=d.getContext("2d"),f=b.element(),g=a.width(),h=a.height(),i=o.padSize,j=a.padTop()?i:0,k=a.padBottom()?i:0,l=a.padLeft()?i:0,m=a.padRight()?i:0;d.width=l+g+m,d.height=j+h+k,e.drawImage(f,l,j,g,h);var n;for(n=0;j>n;n++)e.drawImage(d,l,j,g,1,l,n,g,1);for(n=0;l>n;n++)e.drawImage(d,l,j,1,h,n,j,1,h);for(n=0;k>n;n++)e.drawImage(d,l,j+h-1,g,1,l,j+h+n,g,1);for(n=0;m>n;n++)e.drawImage(d,l+g-1,j,1,h,l+g+n,j,1,h)}},e.prototype.destroy=function(){this._canvas=null,this._timestamp=null},d.TextureClass=d.prototype.TextureClass=e,b.exports=d},{"../support/Css":80,"../util/dom":98,"../util/inherits":101,"./Stage":76,"./loadImageHtml":79,bowser:1}],74:[function(a,b,c){"use strict";function d(){return window[t].__next++}function e(a){if(this.constructor.super_.call(this,a),this._wmode=a&&a.wmode||r,this._swfPath=a&&a.swfPath||s,!s)throw new Error("Missing SWF path");this._flashStageId=d(),this._callbacksObj=window[t][this._flashStageId]={},this._stageCallbacksObjVarName=t+"["+this._flashStageId+"]",this._callbackListeners={};for(var b=0;b<u.length;b++)this._callbacksObj[u[b]]=this._callListeners(u[b]);this._loadImageQueue=new j,this._loadImageQueue.pause(),this._flashReady=!1,this._nextLayerId=0;var c=f(this._swfPath,this._flashStageId,this._stageCallbacksObjVarName);this._domElement=c.root,this._blockingElement=c.blocking,this._flashElement=c.flash,this._checkReadyTimer=setInterval(this._checkReady.bind(this),50)}function f(a,b,c){var d=document.createElement("div");m(d),o(d);var e="marzipano-flash-stage-"+b,f='<object id="'+e+'" name="'+e+'" type="application/x-shockwave-flash" data="'+a+'">',g="";g+='<param name="movie" value="'+a+'" />',g+='<param name="allowscriptaccess" value="always" />',g+='<param name="flashvars" value="callbacksObjName='+c+'" />',g+='<param name="wmode" value="transparent" />',f+=g,f+="</object>";var h=document.createElement("div");h.innerHTML=f;var i=h.firstChild;m(i),o(i),d.appendChild(i);var j=document.createElement("div");return m(j),o(j),p(j),d.appendChild(j),{root:d,flash:i,blocking:j}}function g(a,b,c){var d=c.element(),e=b.width(),f=b.height(),g=v.padSize,h=b.padTop()?g:0,i=b.padBottom()?g:0,j=b.padLeft()?g:0,k=b.padRight()?g:0,l=a._flashElement.createTexture(d,e,f,h,i,j,k);this._stage=a,this._textureId=l}var h=a("./Stage"),i=a("../support/Flash"),j=a("../collections/WorkQueue"),k=a("../util/inherits"),l=a("../util/defer"),m=a("../util/dom").setAbsolute,n=a("../util/dom").setPixelSize,o=a("../util/dom").setFullSize,p=a("../util/dom").setBlocking,q=a("./loadImageFlash"),r="transparent",s=function(){var a=document.currentScript;if(!a){var b=document.getElementsByTagName("script");a=b.length?b[b.length-1]:null}if(!a)return null;var c=a.src,d=c.lastIndexOf("/");return c=d>=0?c.slice(0,d+1):"",c+"marzipano.swf"}(),t="MarzipanoFlashCallbackMap";t in window||(window[t]={__next:0});var u=["imageLoaded"],v={padSize:3};k(e,h),e.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null,this._blockingElement=null,this._flashElement=null,window[t][this._flashStageId]=null,this._callbacksObj=null,this._loadImageQueue=null,clearInterval(this._checkReadyTimer)},e.supported=function(){return i()},e.prototype._updateSize=function(){var a=this._domElement,b=this._width,c=this._height;n(a,b,c)},e.prototype.loadImage=function(a,b,c){var d=q.bind(null,this,a,b);return this._loadImageQueue.push(d,c)},e.prototype._validateLayer=function(a){},e.prototype._onCallback=function(a,b){this._callbackListeners[a]=this._callbackListeners[a]||[],this._callbackListeners[a].push(b)},e.prototype._offCallback=function(a,b){var c=this._callbackListeners[a]||[],d=c.indexOf(b);d>=0&&c.splice(d,1)},e.prototype._callListeners=function(a){var b=this;return function(){for(var c=b._callbackListeners[a]||[],d=0;d<c.length;d++){var e=c[d];l(e,arguments)}}},e.prototype._checkReady=function(){var a=this._flashElement.isReady;return!(!a||!a())&&(this._flashReady=!0,clearTimeout(this._checkReadyTimer),this._loadImageQueue.resume(),this.emitRenderInvalid(),!0)},e.prototype.createRenderer=function(a){return new a(this._flashElement,++this._nextLayerId,v)},e.prototype.destroyRenderer=function(a){a.destroy()},e.prototype.startFrame=function(){},e.prototype.endFrame=function(){},e.type=e.prototype.type="flash",g.prototype.refresh=function(a,b){},g.prototype.destroy=function(){var a=this._textureId,b=this._stage;b._flashElement.destroyTexture(a),this._stage=null,this._textureId=null},e.TextureClass=e.prototype.TextureClass=g,b.exports=e},{"../collections/WorkQueue":35,"../support/Flash":81,"../util/defer":95,"../util/dom":98,"../util/inherits":101,"./Stage":76,"./loadImageFlash":78}],75:[function(a,b,c){"use strict";function d(){this._renderers={}}d.prototype.set=function(a,b,c){this._renderers[a]||(this._renderers[a]={}),this._renderers[a][b]=c},d.prototype.get=function(a,b){var c=this._renderers[a]&&this._renderers[a][b];return c||null},b.exports=d},{}],76:[function(a,b,c){"use strict";function d(a,b){return-a.cmp(b)}function e(a){this._domElement=null,this._layers=[],this._renderers=[],this._visibleTiles=[],this._fallbackTiles={children:[],parents:[]},this._tmpTiles=[],this._width=null,this._height=null,this._rect={},this._createTextureWorkQueue=new g({delay:l}),this.emitRenderInvalid=this.emitRenderInvalid.bind(this),this._rendererRegistry=new k}var f=a("minimal-event-emitter"),g=a("../collections/WorkQueue"),h=a("../calcRect"),i=a("../util/async"),j=a("../util/cancelize"),k=a("./RendererRegistry"),l=20;f(e),e.prototype.destroy=function(){this.removeAllLayers(),this._layers=null,this._renderers=null,this._visibleTiles=null,this._fallbackTiles=null,this._tmpTiles=null,this._width=null,this._height=null,this._createTextureWorkQueue=null,this.emitRenderInvalid=null,this._rendererRegistry=null},e.prototype.registerRenderer=function(a,b,c){return this._rendererRegistry.set(a,b,c)},e.prototype.domElement=function(){return this._domElement},e.prototype.width=function(){return this._width},e.prototype.height=function(){return this._height},e.prototype.size=function(a){return a=a||{},a.width=this._width,a.height=this._height,a},e.prototype.updateSize=function(){this._width=this._domElement.parentElement.clientWidth,this._height=this._domElement.parentElement.clientHeight,this._updateSize(),this.emit("resize"),this.emitRenderInvalid()},e.prototype.emitRenderInvalid=function(){this.emit("renderInvalid")},e.prototype.addLayer=function(a){if(this._layers.indexOf(a)>=0)throw new Error("Layer already in stage");this._validateLayer(a),this._layers.push(a),this._renderers.push(null),a.addEventListener("viewChange",this.emitRenderInvalid),a.addEventListener("effectsChange",this.emitRenderInvalid),a.addEventListener("fixedLevelChange",this.emitRenderInvalid),a.addEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},e.prototype.removeLayer=function(a){var b=this._layers.indexOf(a);if(0>b)throw new Error("No such layer in stage");var c=this._layers.splice(b,1)[0],d=this._renderers.splice(b,1)[0];d&&this.destroyRenderer(d),c.removeEventListener("viewChange",this.emitRenderInvalid),c.removeEventListener("effectsChange",this.emitRenderInvalid),c.removeEventListener("fixedLevelChange",this.emitRenderInvalid),c.removeEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},e.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},e.prototype.listLayers=function(){return[].concat(this._layers)},e.prototype.hasLayer=function(a){return this._layers.indexOf(a)>=0},e.prototype.moveLayer=function(a,b){if(0>b||b>=this._layers.length)throw new Error("Cannot move layer out of bounds");var c=this._layers.indexOf(a);if(0>c)throw new Error("No such layer in stage");a=this._layers.splice(c,1)[0];var d=this._renderers.splice(c,1)[0];this._layers.splice(b,0,a),this._renderers.splice(b,0,d),this.emitRenderInvalid()},e.prototype.render=function(){var a,b=this._visibleTiles,c=this._fallbackTiles,e=this._width,f=this._height,g=this._rect;if(!(0>=e||0>=f)){for(this.startFrame(),a=0;a<this._layers.length;a++)this._layers[a].textureStore().startFrame();for(a=0;a<this._layers.length;a++){var i=this._layers[a],j=i.effects(),k=i.view(),l=this._updateRenderer(a),m=this._layers.length-a,n=i.textureStore();if(h(e,f,j&&j.rect,g),!(g.width<=0||g.height<=0)){k.setSize(g),b.length=0,i.visibleTiles(b),l.startLayer(i,g);var o=c.parents,p=c.children;p.length=0,o.length=0,this._renderTiles(b,n,l,i,m,!0),this._renderTiles(p,n,l,i,m,!1),o.sort(d),this._renderTiles(o,n,l,i,m,!1),l.endLayer(i,g)}}for(a=0;a<this._layers.length;a++)this._layers[a].textureStore().endFrame();this.endFrame()}},e.prototype._updateRenderer=function(a){var b=this._layers[a],c=this.type,d=b.geometry().type,e=b.view().type,f=this._rendererRegistry.get(d,e);if(!f)throw new Error("No "+c+" renderer avaiable for "+d+" geometry and "+e+" view");var g=this._renderers[a];return g?g instanceof f||(this._renderers[a]=this.createRenderer(f),this.destroyRenderer(g)):this._renderers[a]=this.createRenderer(f),this._renderers[a]},e.prototype._renderTiles=function(a,b,c,d,e,f){for(var g=0;g<a.length;g++){var h=a[g];b.markTile(h);var i=b.texture(h);i?c.renderTile(h,i,d,e,g):f&&this._fallback(h,b)}},e.prototype._fallback=function(a,b){return this._childrenFallback(a,b)||this._parentFallback(a,b)},e.prototype._parentFallback=function(a,b){for(var c=this._fallbackTiles.parents;null!=(a=a.parent());)if(a&&b.texture(a)){for(var d=0;d<c.length;d++)if(a.equals(c[d]))return!0;return c.push(a),!0}return!1},e.prototype._childrenFallback=function(a,b){var c=this._fallbackTiles.children,d=this._tmpTiles;if(d.length=0,!a.children(d))return!1;if(1===d.length&&!b.texture(d[0]))return this._childrenFallback(d[0],b,c);for(var e=!1,f=0;f<d.length;f++)b.texture(d[f])?c.push(d[f]):e=!0;return!e},e.prototype.createTexture=function(a,b,c){function d(){return new e.TextureClass(e,a,b)}var e=this,f=j(i(d));return this._createTextureWorkQueue.push(f,function(d,e){c(d,a,b,e)})},b.exports=e},{"../calcRect":29,"../collections/WorkQueue":35,"../util/async":85,"../util/cancelize":86,"./RendererRegistry":75,"minimal-event-emitter":13}],77:[function(a,b,c){"use strict";function d(a,b){var c={alpha:!0,preserveDrawingBuffer:b&&b.preserveDrawingBuffer};r&&"undefined"!=typeof WebGLDebugUtils&&(console.log("Using WebGL lost context simulator"),a=WebGLDebugUtils.makeLostContextSimulatingCanvas(a));var d=a.getContext&&(a.getContext("webgl",c)||a.getContext("experimental-webgl",c));if(!d)throw new Error("Could not get WebGL context");return r&&"undefined"!=typeof WebGLDebugUtils&&(d=WebGLDebugUtils.makeDebugContext(d),console.log("Using WebGL debug context")),d}function e(a){function b(a,b){return a===b}function c(a){return n(a.toString())}a=a||{};var e=this;this.constructor.super_.call(this,a),this._generateMipmaps=null!=a.generateMipmaps&&a.generateMipmaps,this._useTexSubImage2D=null==a.useTexSubImage2D||a.useTexSubImage2D,this._domElement=document.createElement("canvas"),o(this._domElement),q(this._domElement),this._gl=d(this._domElement,a),this._blendFuncStrings=a.blendFunc||["ONE","ONE_MINUS_SRC_ALPHA"],this._handleContextLoss=function(){e.emit("webglcontextlost"),e._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=new i(b,c)}function f(a,b,c){this._stage=a,this._gl=a._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(b,c)}var g=a("./Stage"),h=a("../support/WebGl"),i=a("../collections/Map"),j=a("./loadImageHtml"),k=a("../util/inherits"),l=a("../util/defer"),m=a("../util/pixelRatio"),n=a("../util/hash"),o=a("../util/dom").setAbsolute,p=a("../util/dom").setPixelSize,q=a("../util/dom").setFullSize,r="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.webGl;k(e,g),e.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this._domElement=null,this._rendererInstances=null,this._gl=null},e.supported=function(){return h()},e.prototype.webGlContext=function(){return this._gl},e.prototype._updateSize=function(){var a=this._domElement,b=this._width,c=this._height,d=m();this._domElement.width=d*b,this._domElement.height=d*c,l(p.bind(null,a,b,c))},e.prototype.loadImage=j,e.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},e.prototype._validateLayer=function(a){var b=a.geometry().maxTileSize(),c=this.maxTextureSize();if(b>c)throw new Error("Layer has level with tile size larger than maximum texture size ("+b+" vs. "+c+")")},e.prototype.createRenderer=function(a){if(this._rendererInstances.has(a))return this._rendererInstances.get(a);var b=new a(this._gl);return this._rendererInstances.set(a,b),b},e.prototype.destroyRenderer=function(a){this._renderers.indexOf(a)<0&&(a.destroy(),this._rendererInstances.del(a.constructor))},e.prototype.startFrame=function(){var a=this._gl;if(!a)throw new Error("Bad WebGL context - maybe context was lost?");var b=this._width,c=this._height,d=m();a.viewport(0,0,d*b,d*c),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a[this._blendFuncStrings[0]],a[this._blendFuncStrings[1]])},e.prototype.endFrame=function(){},e.type=e.prototype.type="webgl",f.prototype.refresh=function(a,b){var c,d=this._gl,e=this._stage,f=b.timestamp();if(f!==this._timestamp){var g=b.element(),h=b.width(),i=b.height();if(h!==this._width||i!==this._height){var j=e.maxTextureSize();if(h>j)throw new Error("Texture width larger than max size ("+h+" vs. "+j+")");if(i>j)throw new Error("Texture height larger than max size ("+i+" vs. "+j+")");this._texture&&d.deleteTexture(c),c=this._texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,c),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,g)}else c=this._texture,d.bindTexture(d.TEXTURE_2D,c),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0),e._useTexSubImage2D?d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,g):d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,g);e._generateMipmaps?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR),d.generateMipmap(d.TEXTURE_2D)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,null),this._timestamp=f,this._width=h,this._height=i}},f.prototype.destroy=function(){var a=this._texture,b=this._gl;a&&b.deleteTexture(a),this._stage=null,this._gl=null,this._texture=null,this._timestamp=null,this._width=this._height=null},e.TextureClass=e.prototype.TextureClass=f,b.exports=e},{"../collections/Map":32,"../support/WebGl":82,"../util/defer":95,"../util/dom":98,"../util/hash":100,"../util/inherits":101,"../util/pixelRatio":105,"./Stage":76,"./loadImageHtml":79}],78:[function(a,b,c){"use strict";function d(a,b,c,d){function h(c,f){f===o&&(a._offCallback("imageLoaded",h),c?d(new e("Network error: "+b)):d(null,new g(j,o)))}function i(){j.cancelImage(o),a._offCallback("imageLoaded",h),d.apply(null,arguments)}var j=a._flashElement,k=c&&c.x||0,l=c&&c.y||0,m=c&&c.width||1,n=c&&c.height||1,o=j.loadImage(b,m,n,k,l);return d=f(d),a._onCallback("imageLoaded",h),i}var e=a("../NetworkError"),f=a("../util/once"),g=a("../assets/FlashImage");b.exports=d},{"../NetworkError":18,"../assets/FlashImage":25,"../util/once":104}],79:[function(a,b,c){"use strict";function d(a,b,c){function d(){i.onload=i.onerror=null,i.src="",c.apply(null,arguments)}var i=new Image;i.crossOrigin="anonymous";var j=b&&b.x||0,k=b&&b.y||0,l=b&&b.width||1,m=b&&b.height||1;return c=f(c),i.onload=function(){if(0===j&&0===k&&1===l&&1===m)c(null,new g(i));else{j*=i.naturalWidth,k*=i.naturalHeight,l*=i.naturalWidth,m*=i.naturalHeight;var a=document.createElement("canvas");a.width=l,a.height=m;var b=a.getContext("2d");b.drawImage(i,j,k,l,m,0,0,l,m),c(null,new h(a))}},i.onerror=function(){c(new e("Network error: "+a))},i.src=a,d}var e=a("../NetworkError"),f=a("../util/once"),g=a("../assets/StaticImage"),h=a("../assets/StaticCanvas");b.exports=d},{"../NetworkError":18,"../assets/StaticCanvas":26,"../assets/StaticImage":27,"../util/once":104}],80:[function(a,b,c){"use strict";function d(){var a=g("perspective"),b=document.createElement("div"),c="undefined"!=typeof b.style[a];if(c&&"WebkitPerspective"===a){var d="__marzipano_test_css3d_support__",e=document.createElement("style");e.textContent="@media(-webkit-transform-3d){#"+d+"{height: 3px;})",document.getElementsByTagName("head")[0].appendChild(e),b.id=d,document.body.appendChild(b),c=b.offsetHeight>0,e.parentNode.removeChild(e),b.parentNode.removeChild(b)}return c}function e(){return void 0!==f?f:f=d()}var f,g=a("../util/dom").prefixProperty;b.exports=e},{"../util/dom":98}],81:[function(a,b,c){"use strict";function d(){var a=null,b=navigator.plugins,c=navigator.mimeTypes,d=null;if(b&&b["Shockwave Flash"]&&c&&c["application/x-shockwave-flash"]&&c["application/x-shockwave-flash"].enabledPlugin)d=b["Shockwave Flash"].description,d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a=[0,0,0],a[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;else if(window.ActiveXObject)try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");e&&(d=e.GetVariable("$version"))&&(d=d.split(" ")[1].split(","),a=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}catch(a){}return a}function e(){var a=d();return a&&(a[0]>=11||10===a[0]&&a[1]>=1)}function f(){return void 0!==g?g:g=e()}var g;b.exports=f},{}],82:[function(a,b,c){"use strict";function d(){var a=document.createElement("canvas"),b=a.getContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"));return!!b}function e(){return void 0!==f?f:f=d()}var f;b.exports=e},{}],83:[function(a,b,c){"use strict";function d(){var a=document.createElement("a").style;a.cssText="pointer-events:auto";var b="auto"===a.pointerEvents,c=g.msie&&parseFloat(g.version)<11;return b&&!c}function e(){return void 0!==f?f:f=d()}var f,g=a("bowser");b.exports=e},{bowser:1}],84:[function(a,b,c){"use strict";function d(){return!!chooseBestStage()}b.exports=d},{}],85:[function(a,b,c){"use strict";function d(a){return function(b){var c,d;try{d=a()}catch(a){c=a}finally{b(c||null,c?null:d)}}}b.exports=d},{}],86:[function(a,b,c){"use strict";function d(a){return function(){function b(){d.apply(null,arguments)}if(!arguments.length)throw new Error("cancelized: expected at least one argument");var c=Array.prototype.slice.call(arguments,0),d=c[c.length-1]=e(c[c.length-1]);return a.apply(null,c),b}}var e=a("./once");b.exports=d},{"./once":104}],87:[function(a,b,c){"use strict";function d(){var a=Array.prototype.slice.call(arguments,0);return function(){function b(){var a=arguments[0];if(a)return f=g=null,void i.apply(null,arguments);if(!d.length)return f=g=null,void i.apply(null,arguments);f=d.shift();var c=f,e=Array.prototype.slice.call(arguments,1);e.push(b);var h=f.apply(null,e);if(c===f){if("function"!=typeof h)throw new Error("chain: chaining on non-cancellable function");g=h}}function c(){g&&g.apply(null,arguments)}var d=a.slice(0),f=null,g=null,h=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],i=arguments.length?arguments[arguments.length-1]:e;return h.unshift(null),b.apply(null,h),c}}var e=a("./noop");b.exports=d},{"./noop":103}],88:[function(a,b,c){"use strict";function d(a,b,c){return Math.min(Math.max(a,b),c)}b.exports=d},{}],89:[function(a,b,c){"use strict";function d(){return window.performance&&window.performance.now?function(){return window.performance.now()}:null}function e(){return function(){return Date.now()}}var f=d()||e();b.exports=f},{}],90:[function(a,b,c){"use strict";function d(a,b){return b>a?-1:a>b?1:0}b.exports=d},{}],91:[function(a,b,c){"use strict";function d(){var a=arguments;return function(b){for(var c=b,d=0;d<a.length;d++){var e=a[d];c=e.call(null,c)}return c}}b.exports=d},{}],92:[function(a,b,c){"use strict";function d(a,b,c){return 2*Math.atan(c*Math.tan(a/2)/b)}function e(a,b,c){return d(a,b,c)}function f(a,b,c){return d(a,b,Math.sqrt(b*b+c*c))}function g(a,b,c){return d(a,c,b)}function h(a,b,c){return d(a,c,Math.sqrt(b*b+c*c))}function i(a,b,c){return d(a,Math.sqrt(b*b+c*c),b)}function j(a,b,c){return d(a,Math.sqrt(b*b+c*c),c)}b.exports={convert:d,htov:e,htod:f,vtoh:g,vtod:h,dtoh:i,dtov:j}},{}],93:[function(a,b,c){"use strict";function d(a){return a.toPrecision(15)}b.exports=d},{}],94:[function(a,b,c){"use strict";function d(a,b){for(var c in b)c in a||(a[c]=b[c]);return a}b.exports=d},{}],95:[function(a,b,c){"use strict";function d(a,b){function c(){b&&b.length>0?a.apply(null,b):a()}setTimeout(c,0)}b.exports=d},{}],96:[function(a,b,c){"use strict";function d(a){return a*Math.PI/180}b.exports=d},{}],97:[function(a,b,c){"use strict";function d(a,b){function c(){null!=e&&(e=null,b(null))}function d(){null!=e&&(clearTimeout(e),e=null,b.apply(null,arguments))}var e=null;return e=setTimeout(c,a),d}b.exports=d},{}],98:[function(a,b,c){"use strict";function d(a){for(var b=document.documentElement.style,c=["Moz","Webkit","Khtml","O","ms"],d=0;d<c.length;d++){var e=c[d],f=a[0].toUpperCase()+a.slice(1),g=e+f;
if(g in b)return g}return a}function e(a){var b=d(a);return function(a){return a.style[b]}}function f(a){var b=d(a);return function(a,c){return a.style[b]=c}}function g(a){r(a,"translateZ(0)")}function h(a){s(a,"0 0 0")}function i(a){a.style.position="absolute"}function j(a,b,c){a.style.left=b+"px",a.style.top=c+"px"}function k(a,b,c){a.style.width=b+"px",a.style.height=c+"px"}function l(a){a.style.width=a.style.height=0}function m(a){a.style.width=a.style.height="100%"}function n(a){a.style.overflow="hidden"}function o(a){a.style.overflow="visible"}function p(a){a.style.pointerEvents="none"}function q(a){a.style.backgroundColor="#000",a.style.opacity="0",a.style.filter="alpha(opacity=0)"}var r=f("transform"),s=f("transformOrigin");b.exports={prefixProperty:d,getWithVendorPrefix:e,setWithVendorPrefix:f,setTransform:r,setTransformOrigin:s,setNullTransform:g,setNullTransformOrigin:h,setAbsolute:i,setPixelPosition:j,setPixelSize:k,setNullSize:l,setFullSize:m,setOverflowHidden:n,setOverflowVisible:o,setNoPointerEvents:p,setBlocking:q}},{}],99:[function(a,b,c){"use strict";function d(a,b){for(var c in b)a[c]=b[c];return a}b.exports=d},{}],100:[function(a,b,c){"use strict";function d(){for(var a=0,b=0;b<arguments.length;b++){var c=arguments[b];a+=c,a+=c<<10,a^=c>>6}return a+=a<<3,a^=a>>11,a+=a<<15,a>=0?a:-a}b.exports=d},{}],101:[function(a,b,c){"use strict";function d(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}b.exports=d},{}],102:[function(a,b,c){"use strict";function d(a,b){return(+a%(b=+b)+b)%b}b.exports=d},{}],103:[function(a,b,c){"use strict";function d(){}b.exports=d},{}],104:[function(a,b,c){"use strict";function d(a){var b,c=!1;return function(){return c||(c=!0,b=a.apply(null,arguments)),b}}b.exports=d},{}],105:[function(a,b,c){"use strict";function d(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var a=window.screen;if(a&&a.deviceXDPI&&a.logicalXDPI)return a.deviceXDPI/a.logicalXDPI;if(a&&a.systemXDPI&&a.logicalXDPI)return a.systemXDPI/a.logicalXDPI}return e}var e=1;b.exports=d},{}],106:[function(a,b,c){"use strict";function d(a){return 180*a/Math.PI}b.exports=d},{}],107:[function(a,b,c){"use strict";function d(a){return"number"==typeof a&&isFinite(a)}b.exports=d},{}],108:[function(a,b,c){"use strict";function d(a){return function(){function b(){var b=arguments[0];!b||g?d.apply(null,arguments):f=a.apply(null,c)}var c=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],d=arguments.length?arguments[arguments.length-1]:e,f=null,g=!1;return c.push(b),b(!0),function(){g=!0,f.apply(null,arguments)}}}var e=a("./noop");b.exports=d},{"./noop":103}],109:[function(a,b,c){"use strict";function d(a,b,c,d,i){return f.copy(h,g),c&&f.rotateY(h,h,c),d&&f.rotateX(h,h,d),i&&f.rotateZ(h,h,i),e.transformMat4(a,b,h),a}var e=a("gl-matrix/src/gl-matrix/vec3"),f=a("gl-matrix/src/gl-matrix/mat4"),g=f.identity(f.create()),h=f.create();b.exports=d},{"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec3":10}],110:[function(a,b,c){"use strict";function d(a,b,c){function d(){if(!f){var h=(e()-g)/a;1>h?(b(h),requestAnimationFrame(d)):(b(1),c())}}var f=!1,g=e();return b(0),requestAnimationFrame(d),function(){f=!0,c.apply(null,arguments)}}var e=a("./clock");b.exports=d},{"./clock":89}],111:[function(a,b,c){"use strict";function d(a){var b=typeof a;if("object"===b){if(null===a)return"null";if("[object Array]"===Object.prototype.toString.call(a))return"array";if("[object RegExp]"===Object.prototype.toString.call(a))return"regexp"}return b}b.exports=d},{}],112:[function(a,b,c){"use strict";function d(a,b){if(!a||null==a.mediaAspectRatio)throw new Error("mediaAspectRatio must be defined");this._x=a&&null!=a.x?a.x:m,this._y=a&&null!=a.y?a.y:n,this._zoom=a&&null!=a.zoom?a.zoom:o,this._mediaAspectRatio=a.mediaAspectRatio,this._width=a&&null!=a.width?a.width:k,this._height=a&&null!=a.height?a.height:l,this._limiter=b||null,this._viewFrustum=[0,0,0,0],this._projectionMatrix=i.create(),this._projectionChanged=!0,this._params={},this._vertex=j.create(),this._invProj=i.create(),this._update()}var e=a("minimal-event-emitter"),f=a("../util/pixelRatio"),g=a("../util/real"),h=a("../util/clamp"),i=a("gl-matrix/src/gl-matrix/mat4"),j=a("gl-matrix/src/gl-matrix/vec4"),k=0,l=0,m=.5,n=.5,o=1,p=[1,0,1,0],q=[-1,-1,1,1],r=1e-9;e(d),d.prototype.destroy=function(){this._x=null,this._y=null,this._zoom=null,this._mediaAspectRatio=null,this._width=null,this._height=null,this._limiter=null,this._viewFrustum=null,this._projectionMatrix=null,this._projectionChanged=null,this._params=null,this._vertex=null,this._invProj=null},d.prototype.x=function(){return this._x},d.prototype.y=function(){return this._y},d.prototype.zoom=function(){return this._zoom},d.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},d.prototype.width=function(){return this._width},d.prototype.height=function(){return this._height},d.prototype.size=function(a){return a=a||{},a.width=this._width,a.height=this._height,a},d.prototype.parameters=function(a){return a=a||{},a.x=this._x,a.y=this._y,a.zoom=this._zoom,a.mediaAspectRatio=this._mediaAspectRatio,a},d.prototype.limiter=function(){return this._limiter},d.prototype.setX=function(a){this._resetParams(),this._params.x=a,this._update(this._params)},d.prototype.setY=function(a){this._resetParams(),this._params.y=a,this._update(this._params)},d.prototype.setZoom=function(a){this._resetParams(),this._params.zoom=a,this._update(this._params)},d.prototype.offsetX=function(a){this.setX(this._x+a)},d.prototype.offsetY=function(a){this.setY(this._y+a)},d.prototype.offsetZoom=function(a){this.setZoom(this._zoom+a)},d.prototype.setMediaAspectRatio=function(a){this._resetParams(),this._params.mediaAspectRatio=a,this._update(this._params)},d.prototype.setSize=function(a){this._resetParams(),this._params.width=a.width,this._params.height=a.height,this._update(this._params)},d.prototype.setParameters=function(a){this._resetParams();var b=this._params;b.x=a.x,b.y=a.y,b.zoom=a.zoom,b.mediaAspectRatio=a.mediaAspectRatio,this._update(b)},d.prototype.setLimiter=function(a){this._limiter=a||null,this._update()},d.prototype._resetParams=function(){var a=this._params;a.x=null,a.y=null,a.zoom=null,a.mediaAspectRatio=null,a.width=null,a.height=null},d.prototype._update=function(a){null==a&&(this._resetParams(),a=this._params);var b=this._x,c=this._y,d=this._zoom,e=this._mediaAspectRatio,f=this._width,i=this._height;if(a.x=null!=a.x?a.x:b,a.y=null!=a.y?a.y:c,a.zoom=null!=a.zoom?a.zoom:d,a.mediaAspectRatio=null!=a.mediaAspectRatio?a.mediaAspectRatio:e,a.width=null!=a.width?a.width:f,a.height=null!=a.height?a.height:i,this._limiter&&(a=this._limiter(a),!a))throw new Error("Bad view limiter");var j=a.x,k=a.y,l=a.zoom,m=a.mediaAspectRatio,n=a.width,o=a.height;if(!(g(j)&&g(k)&&g(l)&&g(m)&&g(n)&&g(o)))throw new Error("Bad view - suspect a broken limiter");l=h(l,r,1/0),this._x=j,this._y=k,this._zoom=l,this._mediaAspectRatio=m,this._width=n,this._height=o,j===b&&k===c&&l===d&&m===e&&n===f&&o===i||(this._projectionChanged=!0,this.emit("change")),n===f&&o===i||this.emit("resize")},d.prototype._zoomX=function(){return this._zoom},d.prototype._zoomY=function(){var a=this._mediaAspectRatio,b=this._width/this._height,c=this._zoom,d=c*a/b;return isNaN(d)&&(d=c),d},d.prototype.updateWithControlParameters=function(a){var b=this.zoom(),c=this._zoomX(),d=this._zoomY();this.offsetX(a.axisScaledX*c+a.x*b),this.offsetY(a.axisScaledY*d+a.y*b),this.offsetZoom(a.zoom*b)},d.prototype.projection=function(){var a=this._projectionMatrix;if(this._projectionChanged){var b=this._x,c=this._y,d=this._zoomX(),e=this._zoomY(),f=this._viewFrustum,g=f[0]=.5-c+.5*e,h=f[1]=b-.5+.5*d,j=f[2]=.5-c-.5*e,k=f[3]=b-.5-.5*d;i.ortho(a,k,h,j,g,-1,1),this._projectionChanged=!1}return a},d.prototype.intersects=function(a){var b=this._viewFrustum;this.projection();for(var c=0;c<b.length;c++){for(var d=b[c],e=p[c],f=q[c],g=!1,h=0;h<a.length;h++){var i=a[h];if(0>f&&i[e]<d||f>0&&i[e]>d){g=!0;break}}if(!g)return!1}return!0},d.prototype.selectLevel=function(a){for(var b=f()*this.width(),c=this._zoom,d=0;d<a.length;d++){var e=a[d];if(c*e.width()>=b)return e}return a[a.length-1]},d.prototype.coordinatesToScreen=function(a,b){var c=this._vertex;b||(b={});var d=this._width,e=this._height;if(0>=d||0>=e)return b.x=null,b.y=null,null;var f=a&&null!=a.x?a.x:m,g=a&&null!=a.y?a.y:n;j.set(c,f-.5,.5-g,-1,1),j.transformMat4(c,c,this.projection());for(var h=0;3>h;h++)c[h]/=c[3];return b.x=d*(c[0]+1)/2,b.y=e*(1-c[1])/2,b},d.prototype.screenToCoordinates=function(a,b){var c=this._vertex,d=this._invProj;b||(b={});var e=this._width,f=this._height;i.invert(d,this.projection());var g=2*a.x/e-1,h=1-2*a.y/f;return j.set(c,g,h,1,1),j.transformMat4(c,c,d),b.x=.5+c[0],b.y=.5-c[1],b},d.limit={x:function(a,b){return function(c){return c.x=h(c.x,a,b),c}},y:function(a,b){return function(c){return c.y=h(c.y,a,b),c}},zoom:function(a,b){return function(c){return c.zoom=h(c.zoom,a,b),c}},resolution:function(a){return function(b){if(b.width<=0||b.height<=0)return b;var c=b.width,d=f()*c/a;return b.zoom=h(b.zoom,d,1/0),b}},visibleX:function(a,b){return function(c){var d=b-a;c.zoom>d&&(c.zoom=d);var e=a+.5*c.zoom,f=b-.5*c.zoom;return c.x=h(c.x,e,f),c}},visibleY:function(a,b){return function(c){if(c.width<=0||c.height<=0)return c;var d=c.width/c.height,e=d/c.mediaAspectRatio,f=(b-a)*e;c.zoom>f&&(c.zoom=f);var g=a+.5*c.zoom/e,i=b-.5*c.zoom/e;return c.y=h(c.y,g,i),c}},letterbox:function(){return function(a){if(a.width<=0||a.height<=0)return a;var b=a.width/a.height,c=1,d=b/a.mediaAspectRatio;a.mediaAspectRatio>=b&&(a.zoom=Math.min(a.zoom,c)),a.mediaAspectRatio<=b&&(a.zoom=Math.min(a.zoom,d));var e,f;a.zoom>c?e=f=.5:(e=0+.5*a.zoom/c,f=1-.5*a.zoom/c);var g,i;return a.zoom>d?g=i=.5:(g=0+.5*a.zoom/d,i=1-.5*a.zoom/d),a.x=h(a.x,e,f),a.y=h(a.y,g,i),a}}},d.type=d.prototype.type="flat",b.exports=d},{"../util/clamp":88,"../util/pixelRatio":105,"../util/real":107,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec4":11,"minimal-event-emitter":13}],113:[function(a,b,c){"use strict";function d(a,b){this._yaw=a&&null!=a.yaw?a.yaw:s,this._pitch=a&&null!=a.pitch?a.pitch:t,this._roll=a&&null!=a.roll?a.roll:u,this._fov=a&&null!=a.fov?a.fov:v,this._width=a&&null!=a.width?a.width:q,this._height=a&&null!=a.height?a.height:r,this._projectionCenterX=a&&null!=a.projectionCenterX?a.projectionCenterX:w,this._projectionCenterY=a&&null!=a.projectionCenterY?a.projectionCenterY:x,this._limiter=b||null,this._projectionMatrix=o.create(),this._projectionChanged=!0,this._viewFrustum=[p.create(),p.create(),p.create(),p.create(),p.create()],this._params={},this._vertex=p.create(),this._invProj=o.create(),this._update()}var e=a("minimal-event-emitter"),f=a("../util/pixelRatio"),g=a("../util/convertFov"),h=a("../util/rotateVector"),i=a("../util/mod"),j=a("../util/real"),k=a("../util/clamp"),l=a("../util/decimal"),m=a("../util/compose"),n=a("./projectionCenter"),o=a("gl-matrix/src/gl-matrix/mat4"),p=a("gl-matrix/src/gl-matrix/vec4"),q=0,r=0,s=0,t=0,u=0,v=Math.PI/4,w=0,x=0,y=1e-9;e(d),d.prototype.destroy=function(){this._yaw=null,this._pitch=null,this._roll=null,this._fov=null,this._width=null,this._height=null,this._limiter=null,this._projectionChanged=null,this._projectionMatrix=null,this._viewFrustum=null,this._params=null,this._vertex=null,this._invProj=null},d.prototype.yaw=function(){return this._yaw},d.prototype.pitch=function(){return this._pitch},d.prototype.roll=function(){return this._roll},d.prototype.projectionCenterX=function(){return this._projectionCenterX},d.prototype.projectionCenterY=function(){return this._projectionCenterY},d.prototype.fov=function(){return this._fov},d.prototype.width=function(){return this._width},d.prototype.height=function(){return this._height},d.prototype.size=function(a){return a||(a={}),a.width=this._width,a.height=this._height,a},d.prototype.parameters=function(a){return a||(a={}),a.yaw=this._yaw,a.pitch=this._pitch,a.roll=this._roll,a.fov=this._fov,a},d.prototype.limiter=function(){return this._limiter},d.prototype.setYaw=function(a){this._resetParams(),this._params.yaw=a,this._update(this._params)},d.prototype.setPitch=function(a){this._resetParams(),this._params.pitch=a,this._update(this._params)},d.prototype.setRoll=function(a){this._resetParams(),this._params.roll=a,this._update(this._params)},d.prototype.setFov=function(a){this._resetParams(),this._params.fov=a,this._update(this._params)},d.prototype.setProjectionCenterX=function(a){this._resetParams(),this._params.projectionCenterX=a,this._update(this._params)},d.prototype.setProjectionCenterY=function(a){this._resetParams(),this._params.projectionCenterY=a,this._update(this._params)},d.prototype.offsetYaw=function(a){this.setYaw(this._yaw+a)},d.prototype.offsetPitch=function(a){this.setPitch(this._pitch+a)},d.prototype.offsetRoll=function(a){this.setRoll(this._roll+a)},d.prototype.offsetFov=function(a){this.setFov(this._fov+a)},d.prototype.setSize=function(a){this._resetParams(),this._params.width=a.width,this._params.height=a.height,this._update(this._params)},d.prototype.setParameters=function(a){this._resetParams();var b=this._params;b.yaw=a.yaw,b.pitch=a.pitch,b.roll=a.roll,b.fov=a.fov,b.projectionCenterX=a.projectionCenterX,b.projectionCenterY=a.projectionCenterY,this._update(b)},d.prototype.setLimiter=function(a){this._limiter=a||null,this._update()},d.prototype._resetParams=function(){var a=this._params;a.yaw=null,a.pitch=null,a.roll=null,a.fov=null,a.width=null,a.height=null},d.prototype._update=function(a){null==a&&(this._resetParams(),a=this._params);var b=this._yaw,c=this._pitch,d=this._roll,e=this._fov,f=this._projectionCenterX,g=this._projectionCenterY,h=this._width,i=this._height;if(a.yaw=null!=a.yaw?a.yaw:b,a.pitch=null!=a.pitch?a.pitch:c,a.roll=null!=a.roll?a.roll:d,a.fov=null!=a.fov?a.fov:e,a.width=null!=a.width?a.width:h,a.height=null!=a.height?a.height:i,a.projectionCenterX=null!=a.projectionCenterX?a.projectionCenterX:f,a.projectionCenterY=null!=a.projectionCenterY?a.projectionCenterY:g,this._limiter&&(a=this._limiter(a),!a))throw new Error("Bad view limiter");a=this._normalize(a);var k=a.yaw,l=a.pitch,m=a.roll,n=a.fov,o=a.width,p=a.height,q=a.projectionCenterX,r=a.projectionCenterY;if(!(j(k)&&j(l)&&j(m)&&j(n)&&j(o)&&j(p)&&j(q)&&j(r)))throw new Error("Bad view - suspect a broken limiter");this._yaw=k,this._pitch=l,this._roll=m,this._fov=n,this._width=o,this._height=p,this._projectionCenterX=q,this._projectionCenterY=r,k===b&&l===c&&m===d&&n===e&&o===h&&p===i&&q===f&&r===g||(this._projectionChanged=!0,this.emit("change")),o===h&&p===i||this.emit("resize")},d.prototype._normalize=function(a){this._normalizeCoordinates(a);var b=g.htov(Math.PI,a.width,a.height),c=isNaN(b)?Math.PI:Math.min(Math.PI,b);return a.fov=k(a.fov,y,c-y),a},d.prototype._normalizeCoordinates=function(a){return"yaw"in a&&(a.yaw=i(a.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in a&&(a.pitch=i(a.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in a&&(a.roll=i(a.roll-Math.PI,-2*Math.PI)+Math.PI),a},d.prototype.normalizeToClosest=function(a,b){var c=this._yaw,d=this._pitch,e=a.yaw,f=a.pitch,g=e-2*Math.PI,h=e+2*Math.PI;Math.abs(g-c)<Math.abs(e-c)?e=g:Math.abs(h-c)<Math.abs(e-c)&&(e=h);var i=f-2*Math.PI,j=f+2*Math.PI;return Math.abs(i-d)<Math.abs(f-d)?f=i:Math.abs(i-d)<Math.abs(f-d)&&(f=j),b=b||{},b.yaw=e,b.pitch=f,b},d.prototype.updateWithControlParameters=function(a){var b=this._fov,c=g.vtoh(b,this._width,this._height);isNaN(c)&&(c=b),this.offsetYaw(a.axisScaledX*c+2*a.x*c+a.yaw),this.offsetPitch(a.axisScaledY*b+2*a.y*c+a.pitch),this.offsetRoll(-a.roll),this.offsetFov(a.zoom*b)},d.prototype.projection=function(){var a=this._projectionMatrix,b=this._viewFrustum;if(this._projectionChanged){var c=this._fov,d=g.vtoh(c,this._width,this._height);n.viewParamsToProjectionMatrix(this._projectionCenterX,this._projectionCenterY,c,d,-1,1,a),o.rotateZ(a,a,this._roll),o.rotateX(a,a,this._pitch),o.rotateY(a,a,this._yaw),p.set(b[0],a[3]+a[0],a[7]+a[4],a[11]+a[8],0),p.set(b[1],a[3]-a[0],a[7]-a[4],a[11]-a[8],0),p.set(b[2],a[3]+a[1],a[7]+a[5],a[11]+a[9],0),p.set(b[3],a[3]-a[1],a[7]-a[5],a[11]-a[9],0),p.set(b[4],a[3]+a[2],a[7]+a[6],a[11]+a[10],0),this._projectionChanged=!1}return a},d.prototype.intersects=function(a){var b=this._viewFrustum,c=this._vertex;this.projection();for(var d=0;d<b.length;d++){for(var e=b[d],f=!1,g=0;g<a.length;g++){var h=a[g];p.set(c,h[0],h[1],h[2],0),p.dot(e,c)>=0&&(f=!0)}if(!f)return!1}return!0},d.prototype.selectLevel=function(a){for(var b=f()*this._height,c=Math.tan(.5*this._fov),d=0;d<a.length;d++){var e=a[d];if(c*e.height()>=b)return e}return a[a.length-1]},d.prototype.coordinatesToScreen=function(a,b){var c=this._vertex;b||(b={});var d=this._width,e=this._height;if(0>=d||0>=e)return b.x=null,b.y=null,null;var f=a&&null!=a.yaw?a.yaw:s,g=a&&null!=a.pitch?a.pitch:t,i=a&&null!=a.roll?a.roll:u;p.set(c,0,0,-1,1),h(c,c,-f,-g,-i),p.transformMat4(c,c,this.projection());for(var j=0;3>j;j++)c[j]/=c[3];return c[2]>=0?(b.x=d*(c[0]+1)/2,b.y=e*(1-c[1])/2,b):(b.x=null,b.y=null,null)},d.prototype.screenToCoordinates=function(a,b){var c=this._vertex,d=this._invProj;b||(b={});var e=this._width,f=this._height;o.invert(d,this.projection());var g=2*a.x/e-1,h=1-2*a.y/f;p.set(c,g,h,1,1),p.transformMat4(c,c,d);var i=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);return b.yaw=Math.atan2(c[0],-c[2]),b.pitch=Math.acos(c[1]/i)-Math.PI/2,this._normalizeCoordinates(b),b},d.prototype.coordinatesToPerspectiveTransform=function(a,b,c){c=c||"";var d=this._height,e=this._width,f=this._fov,g=.5*d/Math.tan(f/2),h="";return h+="translateX("+l(e/2)+"px) translateY("+l(d/2)+"px) ",h+="translateX(-50%) translateY(-50%) ",h+="perspective("+l(g)+"px) ",h+="translateZ("+l(g)+"px) ",h+="rotateZ("+l(-this._roll)+"rad) ",h+="rotateX("+l(-this._pitch)+"rad) ",h+="rotateY("+l(this._yaw)+"rad) ",h+="rotateY("+l(-a.yaw)+"rad) ",h+="rotateX("+l(a.pitch)+"rad) ",h+="translateZ("+l(-b)+"px) ",h+=c+" "},d.limit={yaw:function(a,b){return function(c){return c.yaw=k(c.yaw,a,b),c}},pitch:function(a,b){return function(c){return c.pitch=k(c.pitch,a,b),c}},roll:function(a,b){return function(c){return c.roll=k(c.roll,a,b),c}},hfov:function(a,b){return function(c){var d=c.width,e=c.height;if(d>0&&e>0){var f=g.htov(a,d,e),h=g.htov(b,d,e);c.fov=k(c.fov,f,h)}return c}},vfov:function(a,b){return function(c){return c.fov=k(c.fov,a,b),c}},resolution:function(a){return function(b){var c=b.height;if(c){var d=f()*c,e=2*Math.atan(d/a);b.fov=k(b.fov,e,1/0)}return b}},traditional:function(a,b,c){return c=null!=c?c:b,m(d.limit.resolution(a),d.limit.vfov(0,b),d.limit.hfov(0,c),d.limit.pitch(-Math.PI/2,Math.PI/2))}},d.projectionCenter=n,d.type=d.prototype.type="rectilinear",b.exports=d},{"../util/clamp":88,"../util/compose":91,"../util/convertFov":92,"../util/decimal":93,"../util/mod":102,"../util/pixelRatio":105,"../util/real":107,"../util/rotateVector":109,"./projectionCenter":114,"gl-matrix/src/gl-matrix/mat4":7,"gl-matrix/src/gl-matrix/vec4":11,"minimal-event-emitter":13}],114:[function(a,b,c){"use strict";function d(a,b,c,d,e){e=e||{};var f=Math.atan(2*b*Math.tan(c/2));e.up=c/2+f,e.down=c/2-f;var g=Math.atan(2*a*Math.tan(d/2));return e.left=d/2+g,e.right=d/2-g,e}function e(a,b,c,d,e){e=e||{};var f=a+b,g=a-f/2,h=Math.tan(g)/(2*Math.tan(f/2)),i=d+c,j=c-i/2,k=Math.tan(j)/(2*Math.tan(i/2));return e.vfov=f,e.hfov=i,e.projectionCenterX=k,e.projectionCenterY=h,e}function f(a,b,c,d,e,f,g){var h=Math.tan(a),i=Math.tan(b),j=Math.tan(c),k=Math.tan(d),l=2/(j+k),m=2/(h+i);g[0]=l,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=m,g[6]=0,g[7]=0,g[8]=-((j-k)*l*.5),g[9]=(h-i)*m*.5,g[10]=-(e+f)/(f-e),g[11]=-1,g[12]=0,g[13]=0,g[14]=-(2*f*e)/(f-e),g[15]=0}function g(a,b,c,e,g,i,j){d(a,b,c,e,h),f(h.up,h.down,h.left,h.right,g,i,j)}var h={};b.exports={viewParamsToVrFovs:d,vrFovsToViewParams:e,vrFovsToProjectionMatrix:f,viewParamsToProjectionMatrix:g}},{}],115:[function(a,b,c){b.exports="0.5.0"},{}]},{},[57])(57)});var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),mjh360=function(){function a(b,c){var d=this;_classCallCheck(this,a),this.viewport=b.querySelector(".vr-viewport"),this.goBackwardsInTime=b.querySelector(".vr-before"),this.goForwardsInTime=b.querySelector(".vr-after"),this.navigation=b.querySelector(".vr-nav"),this.goBackwardsInTime.addEventListener("click",function(a){return d.sceneGoToTime(a,"before")}),this.goForwardsInTime.addEventListener("click",function(a){return d.sceneGoToTime(a,"after")}),this.scenes=[],this.viewer=new Marzipano.Viewer(this.viewport),this.geometry=new Marzipano.EquirectGeometry([{width:4e3}]),this.limiter=Marzipano.RectilinearView.limit.traditional(1024,100*Math.PI/180),this.view=new Marzipano.RectilinearView({yaw:Math.PI},this.limiter);for(var e=function(){var a=c[f];a.beforeSrc=Marzipano.ImageUrlSource.fromString(a.before),a.afterSrc=Marzipano.ImageUrlSource.fromString(a.after),a.beforeScene=d.viewer.createScene({source:a.beforeSrc,geometry:d.geometry,view:d.view,pinFirstLevel:!0}),a.hasOwnProperty("after")?a.afterScene=d.viewer.createScene({source:a.afterSrc,geometry:d.geometry,view:d.view,pinFirstLevel:!0}):a.afterScene=!1,a.navButton=document.createElement("a"),a.navButton.className="nav-button";var b=document.createElement("img");b.src=a.thumb,g=d,function(b){var c=function(a){a.preventDefault(),g.sceneActivate(!1,b),this.classList.add("active")};a.navButton.addEventListener("click",c),a.navButton.addEventListener("touchstart",c)}(f),a.navButton.appendChild(b),d.navigation.appendChild(a.navButton),d.scenes.push(a),d.currentScene=0,d.currentTime="before"},f=0;f<c.length;f++){var g;e()}}return _createClass(a,[{key:"render",value:function(){return this.scenes.length<1?(console.error("There are no scenes to view."),!1):(this.navigation.classList.add("vr-nav-active"),this.scenes[0].navButton.classList.add("active"),void this.scenes[0].beforeScene.switchTo())}},{key:"sceneGoToTime",value:function(a,b){if("undefined"!=typeof a&&a&&a.preventDefault(),this.currentTime===b)return console.warn("Already on "+b+", not changing."),!1;var c=this.sceneTimeToSelector(b);return"after"===b&&this.scenes[this.currentScene][c]===!1?(this.sceneGoToTime(!1,"before"),!1):("before"===b?(this.goBackwardsInTime.classList.add("vr-button-active"),this.goForwardsInTime.classList.remove("vr-button-active")):"after"===b&&(this.goForwardsInTime.classList.add("vr-button-active"),this.goBackwardsInTime.classList.remove("vr-button-active")),this.scenes[this.currentScene][c].switchTo(),void(this.currentTime=b))}},{key:"sceneTimeToSelector",value:function(a){var b;return"before"===a?(b="beforeScene",this.goBackwardsInTime.classList.add("vr-button-active"),this.goForwardsInTime.classList.remove("vr-button-active")):"after"===a?(b="afterScene",this.goForwardsInTime.classList.add("vr-button-active"),this.goBackwardsInTime.classList.remove("vr-button-active")):b="before",b}},{key:"sceneActivate",value:function(a,b){"undefined"!=typeof a&&a&&a.preventDefault();var c=this.currentTime;return this.scenes[this.currentScene]?(this.scenes[this.currentScene].navButton.classList.remove("active"),this.currentScene=b,this.currentTime=!1,void this.sceneGoToTime(!1,c)):(console.warn("No scene found with this ID."),!1)}}]),a}();
//# sourceMappingURL=mjh360.min.js.map